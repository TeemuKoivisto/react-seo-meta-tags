{"version":3,"file":"develop-static-entry.js","names":["testRequireError","moduleName","err","regex","RegExp","firstLine","toString","split","test","Html","require","console","log","process","exit","__esModule","default","pagePath","headComponents","htmlAttributes","bodyAttributes","preBodyComponents","postBodyComponents","bodyProps","htmlStr","setHeadComponents","components","concat","setHtmlAttributes","attributes","setBodyAttributes","setPreBodyComponents","setPostBodyComponents","setBodyProps","props","getHeadComponents","replaceHeadComponents","getPreBodyComponents","replacePreBodyComponents","getPostBodyComponents","replacePostBodyComponents","apiRunner","pathname","htmlElement","React","createElement","body","BROWSER_ESM_ONLY","filter","Boolean","renderToStaticMarkup","getPageChunk","componentChunkName","asyncRequires"],"sources":["../develop-static-entry.js"],"sourcesContent":["/* global BROWSER_ESM_ONLY */\nimport React from \"react\"\nimport { renderToStaticMarkup } from \"react-dom/server\"\nimport { merge } from \"lodash\"\nimport { apiRunner } from \"./api-runner-ssr\"\nimport asyncRequires from \"$virtual/async-requires\"\n\nconst testRequireError = (moduleName, err) => {\n  const regex = new RegExp(`Error: Cannot find module\\\\s.${moduleName}`)\n  const firstLine = err.toString().split(`\\n`)[0]\n  return regex.test(firstLine)\n}\n\nlet Html\ntry {\n  Html = require(`../src/html`)\n} catch (err) {\n  if (testRequireError(`../src/html`, err)) {\n    Html = require(`./default-html`)\n  } else {\n    console.log(`There was an error requiring \"src/html.js\"\\n\\n`, err, `\\n\\n`)\n    process.exit()\n  }\n}\n\nHtml = Html && Html.__esModule ? Html.default : Html\n\nexport default ({ pagePath }) => {\n  let headComponents = [\n    <meta key=\"environment\" name=\"note\" content=\"environment=development\" />,\n  ]\n  let htmlAttributes = {}\n  let bodyAttributes = {}\n  let preBodyComponents = []\n  let postBodyComponents = []\n  let bodyProps = {}\n  let htmlStr\n\n  const setHeadComponents = components => {\n    headComponents = headComponents.concat(components)\n  }\n\n  const setHtmlAttributes = attributes => {\n    htmlAttributes = merge(htmlAttributes, attributes)\n  }\n\n  const setBodyAttributes = attributes => {\n    bodyAttributes = merge(bodyAttributes, attributes)\n  }\n\n  const setPreBodyComponents = components => {\n    preBodyComponents = preBodyComponents.concat(components)\n  }\n\n  const setPostBodyComponents = components => {\n    postBodyComponents = postBodyComponents.concat(components)\n  }\n\n  const setBodyProps = props => {\n    bodyProps = merge({}, bodyProps, props)\n  }\n\n  const getHeadComponents = () => headComponents\n\n  const replaceHeadComponents = components => {\n    headComponents = components\n  }\n\n  const getPreBodyComponents = () => preBodyComponents\n\n  const replacePreBodyComponents = components => {\n    preBodyComponents = components\n  }\n\n  const getPostBodyComponents = () => postBodyComponents\n\n  const replacePostBodyComponents = components => {\n    postBodyComponents = components\n  }\n\n  apiRunner(`onRenderBody`, {\n    setHeadComponents,\n    setHtmlAttributes,\n    setBodyAttributes,\n    setPreBodyComponents,\n    setPostBodyComponents,\n    setBodyProps,\n    pathname: pagePath,\n  })\n\n  apiRunner(`onPreRenderHTML`, {\n    getHeadComponents,\n    replaceHeadComponents,\n    getPreBodyComponents,\n    replacePreBodyComponents,\n    getPostBodyComponents,\n    replacePostBodyComponents,\n    pathname: pagePath,\n  })\n\n  const htmlElement = React.createElement(Html, {\n    ...bodyProps,\n    body: ``,\n    headComponents: headComponents.concat([\n      <script key={`io`} src=\"/socket.io/socket.io.js\" />,\n      <link key=\"styles\" rel=\"stylesheet\" href=\"/commons.css\" />,\n    ]),\n    htmlAttributes,\n    bodyAttributes,\n    preBodyComponents,\n    postBodyComponents: postBodyComponents.concat(\n      [\n        !BROWSER_ESM_ONLY && (\n          <script key={`polyfill`} src=\"/polyfill.js\" noModule={true} />\n        ),\n        <script key={`framework`} src=\"/framework.js\" />,\n        <script key={`commons`} src=\"/commons.js\" />,\n      ].filter(Boolean)\n    ),\n  })\n  htmlStr = renderToStaticMarkup(htmlElement)\n  htmlStr = `<!DOCTYPE html>${htmlStr}`\n\n  return htmlStr\n}\n\nexport function getPageChunk({ componentChunkName }) {\n  return asyncRequires.components[componentChunkName]()\n}\n"],"mappings":"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"}