{"version":3,"file":"handle-gatsby-cloud.js","names":["GATSBY_CLOUD_PLUGIN_NAME","GATSBY_PLUGIN_PREVIEW_NAME","addCloudPluginWhenInstalled","plugins","rootDir","name","cloudPluginLocation","resolveFromSilent","processedGatsbyCloudPlugin","processPlugin","resolve","options","push","addGatsbyPluginPreviewWhenInstalled","addGatsbyPluginCloudPluginWhenInstalled","incompatibleGatsbyCloudPlugin","plugin","find","semver","satisfies","version","includePrerelease"],"sources":["../../../../src/bootstrap/load-plugins/utils/handle-gatsby-cloud.ts"],"sourcesContent":["import { silent as resolveFromSilent } from \"resolve-from\"\nimport * as semver from \"semver\"\nimport { IPluginInfo } from \"../types\"\nimport { processPlugin } from \"../process-plugin\"\n\nexport const GATSBY_CLOUD_PLUGIN_NAME = `gatsby-plugin-gatsby-cloud`\nexport const GATSBY_PLUGIN_PREVIEW_NAME = `@gatsby-cloud-pkg/gatsby-plugin-preview`\n\nfunction addCloudPluginWhenInstalled(\n  plugins: Array<IPluginInfo>,\n  rootDir: string,\n  name: string\n): void {\n  const cloudPluginLocation = resolveFromSilent(rootDir, name)\n\n  if (cloudPluginLocation) {\n    const processedGatsbyCloudPlugin = processPlugin(\n      {\n        resolve: name,\n        options: {},\n      },\n      rootDir\n    )\n    plugins.push(processedGatsbyCloudPlugin)\n  }\n}\n\nexport function addGatsbyPluginPreviewWhenInstalled(\n  plugins: Array<IPluginInfo>,\n  rootDir: string\n): void {\n  addCloudPluginWhenInstalled(plugins, rootDir, GATSBY_PLUGIN_PREVIEW_NAME)\n}\n\nexport function addGatsbyPluginCloudPluginWhenInstalled(\n  plugins: Array<IPluginInfo>,\n  rootDir: string\n): void {\n  addCloudPluginWhenInstalled(plugins, rootDir, GATSBY_CLOUD_PLUGIN_NAME)\n}\n\nexport function incompatibleGatsbyCloudPlugin(\n  plugins: Array<IPluginInfo>\n): boolean {\n  const plugin = plugins.find(\n    plugin => plugin.name === GATSBY_CLOUD_PLUGIN_NAME\n  )\n\n  return !semver.satisfies(plugin!.version, `>=4.0.0-alpha`, {\n    includePrerelease: true,\n  })\n}\n"],"mappings":";;;;;;;AAAA;AACA;AAEA;AAAiD;AAAA;AAE1C,MAAMA,wBAAwB,GAAI,4BAA2B;AAAA;AAC7D,MAAMC,0BAA0B,GAAI,yCAAwC;AAAA;AAEnF,SAASC,2BAA2B,CAClCC,OAA2B,EAC3BC,OAAe,EACfC,IAAY,EACN;EACN,MAAMC,mBAAmB,GAAG,IAAAC,mBAAiB,EAACH,OAAO,EAAEC,IAAI,CAAC;EAE5D,IAAIC,mBAAmB,EAAE;IACvB,MAAME,0BAA0B,GAAG,IAAAC,4BAAa,EAC9C;MACEC,OAAO,EAAEL,IAAI;MACbM,OAAO,EAAE,CAAC;IACZ,CAAC,EACDP,OAAO,CACR;IACDD,OAAO,CAACS,IAAI,CAACJ,0BAA0B,CAAC;EAC1C;AACF;AAEO,SAASK,mCAAmC,CACjDV,OAA2B,EAC3BC,OAAe,EACT;EACNF,2BAA2B,CAACC,OAAO,EAAEC,OAAO,EAAEH,0BAA0B,CAAC;AAC3E;AAEO,SAASa,uCAAuC,CACrDX,OAA2B,EAC3BC,OAAe,EACT;EACNF,2BAA2B,CAACC,OAAO,EAAEC,OAAO,EAAEJ,wBAAwB,CAAC;AACzE;AAEO,SAASe,6BAA6B,CAC3CZ,OAA2B,EAClB;EACT,MAAMa,MAAM,GAAGb,OAAO,CAACc,IAAI,CACzBD,MAAM,IAAIA,MAAM,CAACX,IAAI,KAAKL,wBAAwB,CACnD;EAED,OAAO,CAACkB,MAAM,CAACC,SAAS,CAACH,MAAM,CAAEI,OAAO,EAAG,eAAc,EAAE;IACzDC,iBAAiB,EAAE;EACrB,CAAC,CAAC;AACJ"}