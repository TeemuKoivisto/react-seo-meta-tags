{"version":3,"file":"remove-stale-jobs.js","names":["removeStaleJobs","jobs","actions","complete","forEach","job","contentDigest","isJobStale","push","internalActions","removeStaleJob","incomplete","createJobV2FromInternalJob"],"sources":["../../src/bootstrap/remove-stale-jobs.ts"],"sourcesContent":["import {\n  IGatsbyState,\n  IRemoveStaleJobV2Action,\n  ICreateJobV2FromInternalAction,\n} from \"../redux/types\"\n\nimport { isJobStale } from \"../utils/jobs/manager\"\nimport { internalActions } from \"../redux/actions\"\n\nexport const removeStaleJobs = (\n  jobs: IGatsbyState[\"jobsV2\"]\n): Array<IRemoveStaleJobV2Action | ICreateJobV2FromInternalAction> => {\n  const actions: Array<\n    IRemoveStaleJobV2Action | ICreateJobV2FromInternalAction\n  > = []\n\n  // If any of our finished jobs are stale we remove them to keep our cache small\n  jobs.complete.forEach((job, contentDigest) => {\n    if (isJobStale(job)) {\n      actions.push(internalActions.removeStaleJob(contentDigest))\n    }\n  })\n\n  // If any of our pending jobs do not have an existing inputPath or the inputPath changed\n  // we remove it from the queue as they would fail anyway\n  jobs.incomplete.forEach(({ job }): void => {\n    if (isJobStale(job)) {\n      actions.push(internalActions.removeStaleJob(job.contentDigest))\n    } else {\n      actions.push(internalActions.createJobV2FromInternalJob(job))\n    }\n  })\n\n  return actions\n}\n"],"mappings":";;;;AAMA;AACA;AAEO,MAAMA,eAAe,GAC1BC,IAA4B,IACwC;EACpE,MAAMC,OAEL,GAAG,EAAE;;EAEN;EACAD,IAAI,CAACE,QAAQ,CAACC,OAAO,CAAC,CAACC,GAAG,EAAEC,aAAa,KAAK;IAC5C,IAAI,IAAAC,mBAAU,EAACF,GAAG,CAAC,EAAE;MACnBH,OAAO,CAACM,IAAI,CAACC,wBAAe,CAACC,cAAc,CAACJ,aAAa,CAAC,CAAC;IAC7D;EACF,CAAC,CAAC;;EAEF;EACA;EACAL,IAAI,CAACU,UAAU,CAACP,OAAO,CAAC,CAAC;IAAEC;EAAI,CAAC,KAAW;IACzC,IAAI,IAAAE,mBAAU,EAACF,GAAG,CAAC,EAAE;MACnBH,OAAO,CAACM,IAAI,CAACC,wBAAe,CAACC,cAAc,CAACL,GAAG,CAACC,aAAa,CAAC,CAAC;IACjE,CAAC,MAAM;MACLJ,OAAO,CAACM,IAAI,CAACC,wBAAe,CAACG,0BAA0B,CAACP,GAAG,CAAC,CAAC;IAC/D;EACF,CAAC,CAAC;EAEF,OAAOH,OAAO;AAChB,CAAC;AAAA"}