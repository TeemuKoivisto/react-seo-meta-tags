{"version":3,"file":"server-slice.js","names":["getSliceId","sliceName","sliceProps","Object","keys","length","propsString","createContentDigest","ServerSlice","allowEmpty","children","slicesMap","useContext","SlicesMapContext","slicesProps","SlicesPropsContext","concreteSliceName","Error","sliceId","sliceUsage","props","hasChildren"],"sources":["../../slice/server-slice.js"],"sourcesContent":["import React, { useContext } from \"react\"\nimport { createContentDigest } from \"gatsby-core-utils/create-content-digest\"\nimport { SlicesMapContext, SlicesPropsContext } from \"./context\"\nimport { ServerSliceRenderer } from \"./server-slice-renderer\"\n\nconst getSliceId = (sliceName, sliceProps) => {\n  if (!Object.keys(sliceProps).length) {\n    return sliceName\n  }\n\n  const propsString = createContentDigest(sliceProps)\n  return `${sliceName}-${propsString}`\n}\n\nexport const ServerSlice = ({\n  sliceName,\n  allowEmpty,\n  children,\n  ...sliceProps\n}) => {\n  const slicesMap = useContext(SlicesMapContext)\n  const slicesProps = useContext(SlicesPropsContext)\n  const concreteSliceName = slicesMap[sliceName]\n\n  if (!concreteSliceName) {\n    if (allowEmpty) {\n      return null\n    } else {\n      throw new Error(\n        `Slice \"${concreteSliceName}\" for \"${sliceName}\" slot not found`\n      )\n    }\n  }\n\n  const sliceId = getSliceId(concreteSliceName, sliceProps)\n\n  // set props on context object for static-entry to return\n  let sliceUsage = slicesProps[sliceId]\n  if (!sliceUsage) {\n    slicesProps[sliceId] = sliceUsage = {\n      props: sliceProps,\n      sliceName: concreteSliceName,\n      hasChildren: !!children,\n    }\n  } else {\n    if (children) {\n      sliceUsage.hasChildren = true\n    }\n  }\n\n  return <ServerSliceRenderer sliceId={sliceId}>{children}</ServerSliceRenderer>\n}\n"],"mappings":";;;;AAAA;AACA;AACA;AACA;AAA6D;AAAA;AAE7D,MAAMA,UAAU,GAAG,CAACC,SAAS,EAAEC,UAAU,KAAK;EAC5C,IAAI,CAACC,MAAM,CAACC,IAAI,CAACF,UAAU,CAAC,CAACG,MAAM,EAAE;IACnC,OAAOJ,SAAS;EAClB;EAEA,MAAMK,WAAW,GAAG,IAAAC,wCAAmB,EAACL,UAAU,CAAC;EACnD,OAAQ,GAAED,SAAU,IAAGK,WAAY,EAAC;AACtC,CAAC;AAEM,MAAME,WAAW,GAAG,CAAC;EAC1BP,SAAS;EACTQ,UAAU;EACVC,QAAQ;EACR,GAAGR;AACL,CAAC,KAAK;EACJ,MAAMS,SAAS,GAAG,IAAAC,iBAAU,EAACC,yBAAgB,CAAC;EAC9C,MAAMC,WAAW,GAAG,IAAAF,iBAAU,EAACG,2BAAkB,CAAC;EAClD,MAAMC,iBAAiB,GAAGL,SAAS,CAACV,SAAS,CAAC;EAE9C,IAAI,CAACe,iBAAiB,EAAE;IACtB,IAAIP,UAAU,EAAE;MACd,OAAO,IAAI;IACb,CAAC,MAAM;MACL,MAAM,IAAIQ,KAAK,CACZ,UAASD,iBAAkB,UAASf,SAAU,kBAAiB,CACjE;IACH;EACF;EAEA,MAAMiB,OAAO,GAAGlB,UAAU,CAACgB,iBAAiB,EAAEd,UAAU,CAAC;;EAEzD;EACA,IAAIiB,UAAU,GAAGL,WAAW,CAACI,OAAO,CAAC;EACrC,IAAI,CAACC,UAAU,EAAE;IACfL,WAAW,CAACI,OAAO,CAAC,GAAGC,UAAU,GAAG;MAClCC,KAAK,EAAElB,UAAU;MACjBD,SAAS,EAAEe,iBAAiB;MAC5BK,WAAW,EAAE,CAAC,CAACX;IACjB,CAAC;EACH,CAAC,MAAM;IACL,IAAIA,QAAQ,EAAE;MACZS,UAAU,CAACE,WAAW,GAAG,IAAI;IAC/B;EACF;EAEA,oBAAO,6BAAC,wCAAmB;IAAC,OAAO,EAAEH;EAAQ,GAAER,QAAQ,CAAuB;AAChF,CAAC;AAAA"}