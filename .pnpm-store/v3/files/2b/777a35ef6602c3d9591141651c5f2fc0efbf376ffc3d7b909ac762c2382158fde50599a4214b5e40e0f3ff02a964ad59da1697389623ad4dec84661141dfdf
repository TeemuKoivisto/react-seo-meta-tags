{"version":3,"file":"source-nodes.js","names":["sourceNodes","parentSpan","webhookBody","webhookSourcePluginName","store","deferNodeMutation","assertStore","activity","reporter","activityTimer","start","currentPages","Map","getState","pages","sourceNodesAndRemoveStaleNodes","span","pluginName","verbose","tim","changedPages","deletedPages","findChangedPages","length","end"],"sources":["../../src/services/source-nodes.ts"],"sourcesContent":["import sourceNodesAndRemoveStaleNodes from \"../utils/source-nodes\"\nimport reporter from \"gatsby-cli/lib/reporter\"\nimport { IDataLayerContext } from \"../state-machines/data-layer/types\"\nimport { assertStore } from \"../utils/assert-store\"\nimport { IGatsbyPage } from \"../redux/types\"\nimport { findChangedPages } from \"../utils/changed-pages\"\n\nexport async function sourceNodes({\n  parentSpan,\n  webhookBody,\n  webhookSourcePluginName,\n  store,\n  deferNodeMutation = false,\n}: Partial<IDataLayerContext>): Promise<{\n  deletedPages: Array<string>\n  changedPages: Array<string>\n}> {\n  assertStore(store)\n\n  const activity = reporter.activityTimer(`source and transform nodes`, {\n    parentSpan,\n  })\n  activity.start()\n  const currentPages = new Map<string, IGatsbyPage>(store.getState().pages)\n  await sourceNodesAndRemoveStaleNodes({\n    parentSpan: activity.span,\n    deferNodeMutation,\n    webhookBody,\n    pluginName: webhookSourcePluginName,\n  })\n\n  reporter.verbose(`Checking for deleted pages`)\n\n  const tim = reporter.activityTimer(`Checking for changed pages`, {\n    parentSpan,\n  })\n  tim.start()\n\n  const { changedPages, deletedPages } = findChangedPages(\n    currentPages,\n    store.getState().pages\n  )\n\n  reporter.verbose(\n    `Deleted ${deletedPages.length} page${deletedPages.length === 1 ? `` : `s`}`\n  )\n\n  reporter.verbose(\n    `Found ${changedPages.length} changed page${\n      changedPages.length === 1 ? `` : `s`\n    }`\n  )\n  tim.end()\n\n  activity.end()\n  return {\n    deletedPages,\n    changedPages,\n  }\n}\n"],"mappings":";;;;;AAAA;AACA;AAEA;AAEA;AAEO,eAAeA,WAAW,CAAC;EAChCC,UAAU;EACVC,WAAW;EACXC,uBAAuB;EACvBC,KAAK;EACLC,iBAAiB,GAAG;AACM,CAAC,EAG1B;EACD,IAAAC,wBAAW,EAACF,KAAK,CAAC;EAElB,MAAMG,QAAQ,GAAGC,iBAAQ,CAACC,aAAa,CAAE,4BAA2B,EAAE;IACpER;EACF,CAAC,CAAC;EACFM,QAAQ,CAACG,KAAK,EAAE;EAChB,MAAMC,YAAY,GAAG,IAAIC,GAAG,CAAsBR,KAAK,CAACS,QAAQ,EAAE,CAACC,KAAK,CAAC;EACzE,MAAM,IAAAC,oBAA8B,EAAC;IACnCd,UAAU,EAAEM,QAAQ,CAACS,IAAI;IACzBX,iBAAiB;IACjBH,WAAW;IACXe,UAAU,EAAEd;EACd,CAAC,CAAC;EAEFK,iBAAQ,CAACU,OAAO,CAAE,4BAA2B,CAAC;EAE9C,MAAMC,GAAG,GAAGX,iBAAQ,CAACC,aAAa,CAAE,4BAA2B,EAAE;IAC/DR;EACF,CAAC,CAAC;EACFkB,GAAG,CAACT,KAAK,EAAE;EAEX,MAAM;IAAEU,YAAY;IAAEC;EAAa,CAAC,GAAG,IAAAC,8BAAgB,EACrDX,YAAY,EACZP,KAAK,CAACS,QAAQ,EAAE,CAACC,KAAK,CACvB;EAEDN,iBAAQ,CAACU,OAAO,CACb,WAAUG,YAAY,CAACE,MAAO,QAAOF,YAAY,CAACE,MAAM,KAAK,CAAC,GAAI,EAAC,GAAI,GAAG,EAAC,CAC7E;EAEDf,iBAAQ,CAACU,OAAO,CACb,SAAQE,YAAY,CAACG,MAAO,gBAC3BH,YAAY,CAACG,MAAM,KAAK,CAAC,GAAI,EAAC,GAAI,GACnC,EAAC,CACH;EACDJ,GAAG,CAACK,GAAG,EAAE;EAETjB,QAAQ,CAACiB,GAAG,EAAE;EACd,OAAO;IACLH,YAAY;IACZD;EACF,CAAC;AACH"}