{"version":3,"file":"ensure-resources.js","names":["EnsureResources","React","Component","constructor","props","location","pageResources","state","loader","loadPageSync","pathname","search","withErrorDetails","getDerivedStateFromProps","prevState","href","loadResources","rawPath","loadPage","then","status","PageResourceStatus","Error","setState","window","history","replaceState","shouldComponentUpdate","nextProps","nextState","process","env","BUILD_STAGE","stale","component","json","key","page","matchPath","path","shallowCompare","render","NODE_ENV","message","error","console","children"],"sources":["../ensure-resources.js"],"sourcesContent":["import React from \"react\"\nimport loader, { PageResourceStatus } from \"./loader\"\nimport shallowCompare from \"shallow-compare\"\n\nclass EnsureResources extends React.Component {\n  constructor(props) {\n    super()\n    const { location, pageResources } = props\n    this.state = {\n      location: { ...location },\n      pageResources:\n        pageResources ||\n        loader.loadPageSync(location.pathname + location.search, {\n          withErrorDetails: true,\n        }),\n    }\n  }\n\n  static getDerivedStateFromProps({ location }, prevState) {\n    if (prevState.location.href !== location.href) {\n      const pageResources = loader.loadPageSync(\n        location.pathname + location.search,\n        {\n          withErrorDetails: true,\n        }\n      )\n\n      return {\n        pageResources,\n        location: { ...location },\n      }\n    }\n\n    return {\n      location: { ...location },\n    }\n  }\n\n  loadResources(rawPath) {\n    loader.loadPage(rawPath).then(pageResources => {\n      if (pageResources && pageResources.status !== PageResourceStatus.Error) {\n        this.setState({\n          location: { ...window.location },\n          pageResources,\n        })\n      } else {\n        window.history.replaceState({}, ``, location.href)\n        window.location = rawPath\n      }\n    })\n  }\n\n  shouldComponentUpdate(nextProps, nextState) {\n    // Always return false if we're missing resources.\n    if (!nextState.pageResources) {\n      this.loadResources(\n        nextProps.location.pathname + nextProps.location.search\n      )\n      return false\n    }\n\n    if (\n      process.env.BUILD_STAGE === `develop` &&\n      nextState.pageResources.stale\n    ) {\n      this.loadResources(\n        nextProps.location.pathname + nextProps.location.search\n      )\n      return false\n    }\n\n    // Check if the component or json have changed.\n    if (this.state.pageResources !== nextState.pageResources) {\n      return true\n    }\n    if (\n      this.state.pageResources.component !== nextState.pageResources.component\n    ) {\n      return true\n    }\n\n    if (this.state.pageResources.json !== nextState.pageResources.json) {\n      return true\n    }\n    // Check if location has changed on a page using internal routing\n    // via matchPath configuration.\n    if (\n      this.state.location.key !== nextState.location.key &&\n      nextState.pageResources.page &&\n      (nextState.pageResources.page.matchPath ||\n        nextState.pageResources.page.path)\n    ) {\n      return true\n    }\n    return shallowCompare(this, nextProps, nextState)\n  }\n\n  render() {\n    if (\n      process.env.NODE_ENV !== `production` &&\n      (!this.state.pageResources ||\n        this.state.pageResources.status === PageResourceStatus.Error)\n    ) {\n      const message = `EnsureResources was not able to find resources for path: \"${this.props.location.pathname}\"\nThis typically means that an issue occurred building components for that path.\nRun \\`gatsby clean\\` to remove any cached elements.`\n      if (this.state.pageResources?.error) {\n        console.error(message)\n        throw this.state.pageResources.error\n      }\n\n      throw new Error(message)\n    }\n\n    return this.props.children(this.state)\n  }\n}\n\nexport default EnsureResources\n"],"mappings":"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"}