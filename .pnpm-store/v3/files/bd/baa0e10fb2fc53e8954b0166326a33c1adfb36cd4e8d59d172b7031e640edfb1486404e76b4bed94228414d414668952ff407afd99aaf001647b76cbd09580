{"version":3,"file":"webpack.config.js","names":["crypto","require","fs","path","dotenv","CoreJSResolver","CacheFolderResolver","store","actions","getPublicPath","debug","reporter","apiRunnerNode","FRAMEWORK_BUNDLES","FRAMEWORK_BUNDLES_REGEX","RegExp","join","module","exports","program","directory","suppliedStage","port","parentSpan","fastRefreshPlugin","modulesThatUseGatsby","getGatsbyDependents","directoryPath","withBasePath","stage","rules","loaders","plugins","createWebpackUtils","assetPrefix","pathPrefix","trailingSlash","getState","config","publicPath","isPartialHydrationEnabled","process","env","GATSBY_PARTIAL_HYDRATION","processEnv","defaultNodeEnv","nodeEnv","NODE_ENV","configEnv","GATSBY_ACTIVE_ENV","envFile","cwd","parsed","parse","readFileSync","encoding","err","code","error","target","envObject","Object","keys","reduce","acc","key","JSON","stringify","gatsbyVarObject","match","PUBLIC_DIR","BUILD_STAGE","CYPRESS_SUPPORT","GATSBY_QUERY_ON_DEMAND","GATSBY_SOCKET_IO_DEFAULT_TRANSPORT","mergedEnvVars","assign","getOutput","filename","pathinfo","GATSBY_WEBPACK_PUBLICPATH","devtoolModuleFilenameTemplate","info","resolve","absoluteResourcePath","replace","crossOriginLoading","ROUTES_DIRECTORY","chunkFilename","library","type","withTrailingSlash","Error","getEntry","hasES6ModuleSupport","commons","polyfill","GATSBY_EXPERIMENTAL_DEV_SSR","app","getPlugins","configPlugins","moment","define","__BASE_PATH__","prefixPaths","__PATH_PREFIX__","__ASSET_PREFIX__","__TRAILING_SLASH__","BROWSER_ESM_ONLY","virtualModules","BabelConfigItemsCacheInvalidatorPlugin","GATSBY_WEBPACK_LOGGING","split","includes","WebpackLoggingPlugin","verbose","filter","Boolean","concat","fastRefresh","ForceCssHMRForEdgeCases","hotModuleReplacement","noEmitOnErrors","StaticQueryMapper","push","extractText","extractStats","isCustomEslint","hasLocalEslint","eslint","eslintRequired","PartialHydrationPlugin","provide","fetch","getDevtool","getMode","getModule","configRules","test","byDependency","esm","fullySpecified","descriptionData","js","yaml","fonts","images","media","miscAssets","use","loader","dependencies","oneOf","cssModules","css","null","getPackageRoot","pkg","dirname","getResolve","extensions","alias","gatsby$","$virtual","getAbsolutePathForVirtualModule","profile","getResolveLoader","root","userLoaderDirectoryPath","statSync","isDirectory","modules","__dirname","name","context","entry","output","devtool","performance","hints","mode","resolveLoader","isCssModule","optimization","splitChunks","chunks","cacheGroups","default","defaultVendors","framework","priority","enforce","styles","minimize","mangleExports","componentsCount","components","size","rawRequest","nameForCondition","lib","identifier","hash","createHash","libIdent","update","digest","substring","minChunks","reuseExistingChunk","Math","max","shared","chunkGraph","chunk","getModuleChunksIterable","canBeInitial","maxAsyncRequests","Infinity","maxInitialRequests","minSize","runtimeChunk","minimizer","noUglify","minifyJs","terserOptions","keep_classnames","keep_fnames","minifyCss","shouldMarkPackagesAsExternal","shouldGenerateEngines","shouldTrackBuiltins","externalsPresets","node","externals","userExternalList","checkItem","item","request","callback","resolver","dependencyType","some","newRequest","builtinModulesToTrack","builtinsExternalsDictionary","builtinModules","builtinModule","unshift","cacheLocation","pluginsPathsPromises","flattenedPlugins","plugin","nodeAPIs","map","resolvedCompiledGatsbyNode","resolveJSFilepath","rootDir","filePath","pluginsPaths","Promise","all","cacheConfig","buildDependencies","__filename","cache","dispatch","replaceWebpackConfig","getConfig","webpack","fastRefreshIncludes","babelLoaderLoc","rule","ruleLoaders","Array","isArray","useEntry","hasBabelLoader","includeRegex","modulePath","queryParamStartIndex","indexOf","slice","re","options","include"],"sources":["../../src/utils/webpack.config.js"],"sourcesContent":["const crypto = require(`crypto`)\nconst fs = require(`fs-extra`)\nconst path = require(`path`)\nconst dotenv = require(`dotenv`)\nconst { CoreJSResolver } = require(`./webpack/plugins/corejs-resolver`)\nconst {\n  CacheFolderResolver,\n} = require(`./webpack/plugins/cache-folder-resolver`)\nconst { store } = require(`../redux`)\nconst { actions } = require(`../redux/actions`)\nconst { getPublicPath } = require(`./get-public-path`)\nconst debug = require(`debug`)(`gatsby:webpack-config`)\nconst reporter = require(`gatsby-cli/lib/reporter`)\nimport { withBasePath, withTrailingSlash } from \"./path\"\nimport { getGatsbyDependents } from \"./gatsby-dependents\"\nconst apiRunnerNode = require(`./api-runner-node`)\nimport { createWebpackUtils } from \"./webpack-utils\"\nimport { hasLocalEslint } from \"./local-eslint-config-finder\"\nimport { getAbsolutePathForVirtualModule } from \"./gatsby-webpack-virtual-modules\"\nimport { StaticQueryMapper } from \"./webpack/plugins/static-query-mapper\"\nimport { ForceCssHMRForEdgeCases } from \"./webpack/plugins/force-css-hmr-for-edge-cases\"\nimport { WebpackLoggingPlugin } from \"./webpack/plugins/webpack-logging\"\nimport { hasES6ModuleSupport } from \"./browserslist\"\nimport { builtinModules } from \"module\"\nimport { shouldGenerateEngines } from \"./engines-helpers\"\nimport { ROUTES_DIRECTORY } from \"../constants\"\nimport { BabelConfigItemsCacheInvalidatorPlugin } from \"./babel-loader\"\nimport { PartialHydrationPlugin } from \"./webpack/plugins/partial-hydration\"\nimport { resolveJSFilepath } from \"../bootstrap/resolve-js-file-path\"\n\nconst FRAMEWORK_BUNDLES = [`react`, `react-dom`, `scheduler`, `prop-types`]\n\n// This regex ignores nested copies of framework libraries so they're bundled with their issuer\nconst FRAMEWORK_BUNDLES_REGEX = new RegExp(\n  `(?<!node_modules.*)[\\\\\\\\/]node_modules[\\\\\\\\/](${FRAMEWORK_BUNDLES.join(\n    `|`\n  )})[\\\\\\\\/]`\n)\n\n// Four stages or modes:\n//   1) develop: for `gatsby develop` command, hot reload and CSS injection into page\n//   2) develop-html: same as develop without react-hmre in the babel config for html renderer\n//   3) build-javascript: Build JS and CSS chunks for production\n//   4) build-html: build all HTML files\n\nmodule.exports = async (\n  program,\n  directory,\n  suppliedStage,\n  port,\n  { parentSpan } = {}\n) => {\n  let fastRefreshPlugin\n  const modulesThatUseGatsby = await getGatsbyDependents()\n  const directoryPath = withBasePath(directory)\n\n  // We combine develop & develop-html stages for purposes of generating the\n  // webpack config.\n  const stage = suppliedStage\n  const { rules, loaders, plugins } = createWebpackUtils(stage, program)\n\n  const { assetPrefix, pathPrefix, trailingSlash } = store.getState().config\n\n  const publicPath = getPublicPath({ assetPrefix, pathPrefix, ...program })\n  const isPartialHydrationEnabled =\n    (process.env.GATSBY_PARTIAL_HYDRATION === `true` ||\n      process.env.GATSBY_PARTIAL_HYDRATION === `1`) &&\n    _CFLAGS_.GATSBY_MAJOR === `5`\n\n  function processEnv(stage, defaultNodeEnv) {\n    debug(`Building env for \"${stage}\"`)\n    // node env should be DEVELOPMENT | PRODUCTION as these are commonly used in node land\n    // this variable is used inside webpack\n    const nodeEnv = process.env.NODE_ENV || `${defaultNodeEnv}`\n    // config env is dependent on the env that it's run, this can be anything from staging-production\n    // this allows you to set use different .env environments or conditions in gatsby files\n    const configEnv = process.env.GATSBY_ACTIVE_ENV || nodeEnv\n    const envFile = path.join(process.cwd(), `./.env.${configEnv}`)\n    let parsed = {}\n    try {\n      parsed = dotenv.parse(fs.readFileSync(envFile, { encoding: `utf8` }))\n    } catch (err) {\n      if (err.code !== `ENOENT`) {\n        reporter.error(\n          `There was a problem processing the .env file (${envFile})`,\n          err\n        )\n      }\n    }\n\n    const target =\n      stage === `build-html` || stage === `develop-html` ? `node` : `web`\n\n    const envObject = Object.keys(parsed).reduce((acc, key) => {\n      acc[key] = JSON.stringify(parsed[key])\n      return acc\n    }, {})\n\n    const gatsbyVarObject = Object.keys(process.env).reduce((acc, key) => {\n      if (target === `node` || key.match(/^GATSBY_/)) {\n        acc[key] = JSON.stringify(process.env[key])\n      }\n      return acc\n    }, {})\n\n    // Don't allow overwriting of NODE_ENV, PUBLIC_DIR as to not break gatsby things\n    envObject.NODE_ENV = JSON.stringify(nodeEnv)\n    envObject.PUBLIC_DIR = JSON.stringify(`${process.cwd()}/public`)\n    envObject.BUILD_STAGE = JSON.stringify(stage)\n    envObject.CYPRESS_SUPPORT = JSON.stringify(process.env.CYPRESS_SUPPORT)\n    envObject.GATSBY_QUERY_ON_DEMAND = JSON.stringify(\n      !!process.env.GATSBY_QUERY_ON_DEMAND\n    )\n\n    if (stage === `develop`) {\n      envObject.GATSBY_SOCKET_IO_DEFAULT_TRANSPORT = JSON.stringify(\n        process.env.GATSBY_SOCKET_IO_DEFAULT_TRANSPORT || `websocket`\n      )\n    }\n\n    const mergedEnvVars = Object.assign(envObject, gatsbyVarObject)\n\n    return Object.keys(mergedEnvVars).reduce(\n      (acc, key) => {\n        acc[`process.env.${key}`] = mergedEnvVars[key]\n        return acc\n      },\n      {\n        \"process.env\": `({})`,\n      }\n    )\n  }\n\n  debug(`Loading webpack config for stage \"${stage}\"`)\n  function getOutput() {\n    switch (stage) {\n      case `develop`:\n        return {\n          path: directory,\n          filename: `[name].js`,\n          // Add /* filename */ comments to generated require()s in the output.\n          pathinfo: true,\n          // Point sourcemap entries to original disk location (format as URL on Windows)\n          publicPath: process.env.GATSBY_WEBPACK_PUBLICPATH || `/`,\n          devtoolModuleFilenameTemplate: info =>\n            path.resolve(info.absoluteResourcePath).replace(/\\\\/g, `/`),\n          // Avoid React cross-origin errors\n          // See https://reactjs.org/docs/cross-origin-errors.html\n          crossOriginLoading: `anonymous`,\n        }\n      case `build-html`:\n      case `develop-html`:\n        // Generate the file needed to SSR pages.\n        // Deleted by build-html.js, since it's not needed for production.\n        return {\n          path: directoryPath(ROUTES_DIRECTORY),\n          filename: `[name].js`,\n          chunkFilename: `[name].js`,\n          library: {\n            type: `commonjs`,\n          },\n          publicPath: withTrailingSlash(publicPath),\n        }\n      case `build-javascript`:\n        return {\n          filename: `[name]-[contenthash].js`,\n          chunkFilename: `[name]-[contenthash].js`,\n          path: directoryPath(`public`),\n          publicPath: withTrailingSlash(publicPath),\n        }\n      default:\n        throw new Error(`The state requested ${stage} doesn't exist.`)\n    }\n  }\n\n  function getEntry() {\n    switch (stage) {\n      case `develop`:\n        return hasES6ModuleSupport(directory)\n          ? {\n              commons: [directoryPath(`.cache/app`)],\n            }\n          : {\n              polyfill: directoryPath(`.cache/polyfill-entry`),\n              commons: [directoryPath(`.cache/app`)],\n            }\n      case `develop-html`:\n        return {\n          \"render-page\": process.env.GATSBY_EXPERIMENTAL_DEV_SSR\n            ? directoryPath(`.cache/ssr-develop-static-entry`)\n            : directoryPath(`.cache/develop-static-entry`),\n        }\n      case `build-html`: {\n        return {\n          \"render-page\": directoryPath(`.cache/static-entry`),\n        }\n      }\n      case `build-javascript`:\n        return hasES6ModuleSupport(directory)\n          ? {\n              app: directoryPath(`.cache/production-app`),\n            }\n          : {\n              polyfill: directoryPath(`.cache/polyfill-entry`),\n              app: directoryPath(`.cache/production-app`),\n            }\n      default:\n        throw new Error(`The state requested ${stage} doesn't exist.`)\n    }\n  }\n\n  function getPlugins() {\n    let configPlugins = [\n      plugins.moment(),\n\n      // Add a few global variables. Set NODE_ENV to production (enables\n      // optimizations for React) and what the link prefix is (__PATH_PREFIX__).\n      plugins.define({\n        ...processEnv(stage, `development`),\n        __BASE_PATH__: JSON.stringify(program.prefixPaths ? pathPrefix : ``),\n        __PATH_PREFIX__: JSON.stringify(program.prefixPaths ? publicPath : ``),\n        __ASSET_PREFIX__: JSON.stringify(\n          program.prefixPaths ? assetPrefix : ``\n        ),\n        __TRAILING_SLASH__: JSON.stringify(trailingSlash),\n        // TODO Improve asset passing to pages\n        BROWSER_ESM_ONLY: JSON.stringify(hasES6ModuleSupport(directory)),\n        \"global.hasPartialHydration\": isPartialHydrationEnabled,\n      }),\n\n      plugins.virtualModules(),\n      new BabelConfigItemsCacheInvalidatorPlugin(),\n      process.env.GATSBY_WEBPACK_LOGGING?.split(`,`)?.includes(stage) &&\n        new WebpackLoggingPlugin(program.directory, reporter, program.verbose),\n    ].filter(Boolean)\n\n    switch (stage) {\n      case `develop`: {\n        configPlugins = configPlugins\n          .concat([\n            (fastRefreshPlugin = plugins.fastRefresh({ modulesThatUseGatsby })),\n            new ForceCssHMRForEdgeCases(),\n            plugins.hotModuleReplacement(),\n            plugins.noEmitOnErrors(),\n            new StaticQueryMapper(store),\n          ])\n          .filter(Boolean)\n\n        configPlugins.push(\n          plugins.extractText({\n            filename: `[name].css`,\n            chunkFilename: `[id].css`,\n          })\n        )\n\n        if (process.env.GATSBY_EXPERIMENTAL_DEV_SSR) {\n          configPlugins.push(plugins.extractStats())\n        }\n\n        const isCustomEslint = hasLocalEslint(program.directory)\n\n        // if no local eslint config, then add gatsby config\n        if (!isCustomEslint) {\n          configPlugins.push(plugins.eslint())\n        }\n\n        // Enforce fast-refresh rules even with local eslint config\n        if (isCustomEslint) {\n          configPlugins.push(plugins.eslintRequired())\n        }\n\n        break\n      }\n      case `build-javascript`: {\n        configPlugins = configPlugins\n          .concat([\n            plugins.extractText({\n              filename: `[name].[contenthash].css`,\n              chunkFilename: `[name].[contenthash].css`,\n            }),\n            // Write out stats object mapping named dynamic imports (aka page\n            // components) to all their async chunks.\n            plugins.extractStats(),\n            new StaticQueryMapper(store),\n            isPartialHydrationEnabled\n              ? new PartialHydrationPlugin(\n                  path.join(\n                    directory,\n                    `.cache`,\n                    `partial-hydration`,\n                    `manifest.json`\n                  ),\n                  reporter\n                )\n              : null,\n          ])\n          .filter(Boolean)\n        break\n      }\n      case `develop-html`:\n      case `build-html`: {\n        // Add global fetch in node environments\n        configPlugins.push(\n          plugins.provide({\n            fetch: require.resolve(`node-fetch`),\n            \"global.fetch\": require.resolve(`node-fetch`),\n          })\n        )\n        break\n      }\n    }\n\n    return configPlugins\n  }\n\n  function getDevtool() {\n    switch (stage) {\n      case `develop`:\n        return `eval-cheap-module-source-map`\n      // use a normal `source-map` for the html phases since\n      // it gives better line and column numbers\n      case `develop-html`:\n      case `build-html`:\n      case `build-javascript`:\n        return `source-map`\n      default:\n        return false\n    }\n  }\n\n  function getMode() {\n    switch (stage) {\n      case `develop`:\n      case `develop-html`:\n        return `development`\n      case `build-javascript`:\n      case `build-html`:\n      default:\n        return `production`\n    }\n  }\n\n  function getModule() {\n    // Common config for every env.\n    // prettier-ignore\n    let configRules = [\n      // Webpack expects extensions when importing ESM modules as that's what the spec describes.\n      // Not all libraries have adapted so we don't enforce its behaviour\n      // @see https://github.com/webpack/webpack/issues/11467\n      {\n        test: /\\.mjs$/i,\n        resolve: {\n          byDependency: {\n            esm: {\n              fullySpecified: false,\n            },\n          },\n        },\n      },\n      {\n        test: /\\.js$/i,\n        descriptionData: {\n          type: `module`,\n        },\n        resolve: {\n          byDependency: {\n            esm: {\n              fullySpecified: false,\n            },\n          },\n        },\n      },\n      rules.js({\n        modulesThatUseGatsby,\n      }),\n      rules.yaml(),\n      rules.fonts(),\n      rules.images(),\n      rules.media(),\n      rules.miscAssets(),\n    ]\n\n    // TODO(v5): Remove since this is only useful during Gatsby 4 publishes\n    if (_CFLAGS_.GATSBY_MAJOR !== `5`) {\n      configRules.push({\n        test: require.resolve(`@gatsbyjs/reach-router/es/index`),\n        type: `javascript/auto`,\n        use: [\n          {\n            loader: require.resolve(\n              `./reach-router-add-basecontext-export-loader`\n            ),\n          },\n        ],\n      })\n    }\n\n    // Speedup ðŸŽï¸ðŸ’¨ the build! We only include transpilation of node_modules on javascript production builds\n    // TODO create gatsby plugin to enable this behaviour on develop (only when people are requesting this feature)\n    if (stage === `build-javascript` && !hasES6ModuleSupport(directory)) {\n      configRules.push(\n        rules.dependencies({\n          modulesThatUseGatsby,\n        })\n      )\n    }\n\n    switch (stage) {\n      case `develop`: {\n        configRules = configRules.concat([\n          {\n            oneOf: [rules.cssModules(), rules.css()],\n          },\n        ])\n\n        break\n      }\n      case `build-html`:\n      case `develop-html`:\n        // We don't deal with CSS at all when building the HTML.\n        // The 'null' loader is used to prevent 'module not found' errors.\n        // On the other hand CSS modules loaders are necessary.\n\n        // prettier-ignore\n        configRules = configRules.concat([\n          {\n            oneOf: [\n              rules.cssModules(),\n              {\n                ...rules.css(),\n                use: [loaders.null()],\n              },\n            ],\n          },\n        ])\n        break\n\n      case `build-javascript`:\n        // We don't deal with CSS at all when building JavaScript but we still\n        // need to process the CSS so offline-plugin knows about the various\n        // assets referenced in your CSS.\n        //\n        // It's also necessary to process CSS Modules so your JS knows the\n        // classNames to use.\n        configRules = configRules.concat([\n          {\n            oneOf: [rules.cssModules(), rules.css()],\n          },\n        ])\n\n        break\n    }\n\n    // TODO(v5): Remove since this is only useful during Gatsby 4 publishes\n    // Removes it from the client payload as it's not used there\n    if (_CFLAGS_.GATSBY_MAJOR !== `5`) {\n      configRules.push({\n        test: /react-server-dom-webpack/,\n        use: loaders.null(),\n      })\n    }\n\n    return { rules: configRules }\n  }\n\n  function getPackageRoot(pkg) {\n    return path.dirname(require.resolve(`${pkg}/package.json`))\n  }\n\n  function getResolve(stage) {\n    const { program } = store.getState()\n    const resolve = {\n      // Use the program's extension list (generated via the\n      // 'resolvableExtensions' API hook).\n      extensions: [...program.extensions],\n      alias: {\n        gatsby$: directoryPath(path.join(`.cache`, `gatsby-browser-entry.js`)),\n        // Using directories for module resolution is mandatory because\n        // relative path imports are used sometimes\n        // See https://stackoverflow.com/a/49455609/6420957 for more details\n        \"@babel/runtime\": getPackageRoot(`@babel/runtime`),\n        \"@reach/router\": getPackageRoot(`@gatsbyjs/reach-router`),\n        \"react-lifecycles-compat\": directoryPath(\n          `.cache/react-lifecycles-compat.js`\n        ),\n        \"react-server-dom-webpack\": getPackageRoot(`react-server-dom-webpack`),\n        \"@pmmmwh/react-refresh-webpack-plugin\": getPackageRoot(\n          `@pmmmwh/react-refresh-webpack-plugin`\n        ),\n        \"socket.io-client\": getPackageRoot(`socket.io-client`),\n        \"webpack-hot-middleware\": getPackageRoot(\n          `@gatsbyjs/webpack-hot-middleware`\n        ),\n        $virtual: getAbsolutePathForVirtualModule(`$virtual`),\n      },\n      plugins: [\n        new CoreJSResolver(),\n        new CacheFolderResolver(path.join(program.directory, `.cache`)),\n      ],\n    }\n\n    const target =\n      stage === `build-html` || stage === `develop-html` ? `node` : `web`\n    if (target === `web`) {\n      // TODO(v5): Remove since this is only useful during Gatsby 4 publishes\n      if (_CFLAGS_.GATSBY_MAJOR !== `5`) {\n        resolve.alias[`@reach/router`] = path.join(\n          getPackageRoot(`@gatsbyjs/reach-router`),\n          `es`\n        )\n      }\n\n      resolve.alias[`gatsby-core-utils/create-content-digest`] = directoryPath(\n        `.cache/create-content-digest-browser-shim`\n      )\n    }\n\n    if (stage === `build-javascript` && program.profile) {\n      resolve.alias[`react-dom$`] = `react-dom/profiling`\n      resolve.alias[`scheduler/tracing`] = `scheduler/tracing-profiling`\n    }\n\n    // SSR can have many react versions as some packages use their own version. React works best with 1 version.\n    // By resolving react,react-dom from gatsby we'll get the site versions of react & react-dom because it's specified as a peerdependency.\n    //\n    // we need to put this below our resolve.alias for profiling as webpack picks the first one that matches\n    // @see https://github.com/gatsbyjs/gatsby/issues/31098\n    resolve.alias[`react`] = getPackageRoot(`react`)\n    resolve.alias[`react-dom`] = getPackageRoot(`react-dom`)\n\n    return resolve\n  }\n\n  function getResolveLoader() {\n    const root = [path.resolve(directory, `node_modules`)]\n\n    const userLoaderDirectoryPath = path.resolve(directory, `loaders`)\n\n    try {\n      if (fs.statSync(userLoaderDirectoryPath).isDirectory()) {\n        root.push(userLoaderDirectoryPath)\n      }\n    } catch (err) {\n      debug(`Error resolving user loaders directory`, err)\n    }\n\n    return {\n      modules: [...root, path.join(__dirname, `../loaders`), `node_modules`],\n    }\n  }\n\n  const config = {\n    name: stage,\n    // Context is the base directory for resolving the entry option.\n    context: directory,\n    entry: getEntry(),\n    output: getOutput(),\n\n    module: getModule(),\n    plugins: getPlugins(),\n\n    devtool: getDevtool(),\n    // Turn off performance hints as we (for now) don't want to show the normal\n    // webpack output anywhere.\n    performance: {\n      hints: false,\n    },\n    mode: getMode(),\n\n    resolveLoader: getResolveLoader(),\n    resolve: getResolve(stage),\n  }\n\n  if (stage === `build-html` || stage === `develop-html`) {\n    config.target = `node14.15`\n  } else {\n    config.target = [`web`, `es5`]\n  }\n\n  const isCssModule = module => module.type === `css/mini-extract`\n\n  if (stage === `develop`) {\n    config.optimization = {\n      splitChunks: {\n        chunks: `all`,\n        cacheGroups: {\n          default: false,\n          defaultVendors: false,\n          framework: {\n            chunks: `all`,\n            name: `framework`,\n            test: FRAMEWORK_BUNDLES_REGEX,\n            priority: 40,\n            // Don't let webpack eliminate this chunk (prevents this chunk from becoming a part of the commons chunk)\n            enforce: true,\n          },\n          // Bundle all css & lazy css into one stylesheet to make sure lazy components do not break\n          // TODO make an exception for css-modules\n          styles: {\n            test(module) {\n              return isCssModule(module)\n            },\n\n            name: `commons`,\n            priority: 40,\n            enforce: true,\n          },\n        },\n      },\n      minimize: false,\n    }\n  }\n\n  if (stage === `build-html` || stage === `develop-html`) {\n    config.optimization = {\n      // TODO fix our partial hydration manifest\n      mangleExports: !isPartialHydrationEnabled,\n      splitChunks: {\n        cacheGroups: {\n          default: false,\n          defaultVendors: false,\n        },\n      },\n      minimize: false,\n    }\n  }\n\n  if (stage === `build-javascript`) {\n    const componentsCount = store.getState().components.size\n\n    const splitChunks = {\n      chunks: `all`,\n      cacheGroups: {\n        default: false,\n        defaultVendors: false,\n        framework: {\n          chunks: `all`,\n          name: `framework`,\n          // Important: If you change something here, also update \"gatsby-plugin-preact\"\n          test: module => {\n            // Packages like gatsby-plugin-image might import from \"react-dom/server\". We don't want to include react-dom-server in the framework bundle.\n            // A rawRequest might look like these:\n            // - \"react-dom/server\"\n            // - \"node_modules/react-dom/cjs/react-dom-server-legacy.browser.production.min.js\"\n            // Use a \"/\" before \"react-dom-server\" so that we don't match packages that contain \"react-dom-server\" in their name\n            if (\n              module?.rawRequest === `react-dom/server` ||\n              module?.rawRequest?.includes(`/react-dom-server`)\n            ) {\n              return false\n            }\n\n            return FRAMEWORK_BUNDLES_REGEX.test(module.nameForCondition())\n          },\n          priority: 40,\n          // Don't let webpack eliminate this chunk (prevents this chunk from becoming a part of the commons chunk)\n          enforce: true,\n        },\n        // if a module is bigger than 160kb from node_modules we make a separate chunk for it\n        lib: {\n          test(module) {\n            return (\n              !isCssModule(module) &&\n              module.size() > 160000 &&\n              /node_modules[/\\\\]/.test(module.identifier())\n            )\n          },\n          name(module) {\n            const hash = crypto.createHash(`sha1`)\n            if (!module.libIdent) {\n              throw new Error(\n                `Encountered unknown module type: ${module.type}. Please open an issue.`\n              )\n            }\n\n            hash.update(module.libIdent({ context: program.directory }))\n\n            return hash.digest(`hex`).substring(0, 8)\n          },\n          priority: 30,\n          minChunks: 1,\n          reuseExistingChunk: true,\n        },\n        commons: {\n          name: `commons`,\n          // if a chunk is used on all components we put it in commons (we need at least 2 components)\n          minChunks: Math.max(componentsCount, 2),\n          priority: 20,\n        },\n        // If a chunk is used in at least 2 components we create a separate chunk\n        shared: {\n          test(module, { chunkGraph }) {\n            for (const chunk of chunkGraph.getModuleChunksIterable(module)) {\n              if (chunk.canBeInitial()) {\n                return false\n              }\n            }\n\n            return !isCssModule(module)\n          },\n          name(module, chunks) {\n            const hash = crypto\n              .createHash(`sha1`)\n              .update(chunks.reduce((acc, chunk) => acc + chunk.name, ``))\n              .digest(`hex`)\n\n            return hash\n          },\n          priority: 10,\n          minChunks: 2,\n          reuseExistingChunk: true,\n        },\n\n        // Bundle all css & lazy css into one stylesheet to make sure lazy components do not break\n        // TODO make an exception for css-modules\n        styles: {\n          test(module) {\n            return isCssModule(module)\n          },\n\n          name: `styles`,\n          priority: 40,\n          enforce: true,\n        },\n      },\n      // We load our pages async through async-requires, maxInitialRequests doesn't have an effect on chunks derived from page components.\n      // By default webpack has set maxAsyncRequests to 6, in some cases this isn't enough an actually makes the bundle size blow up.\n      // We've set maxAsyncRequests to Infinity to negate this. This could potentionally exceed the 25 initial requests that we set before\n      // sadly I do not have a better solution.\n      maxAsyncRequests: Infinity,\n      maxInitialRequests: 25,\n      minSize: 20000,\n    }\n\n    config.optimization = {\n      runtimeChunk: {\n        name: `webpack-runtime`,\n      },\n      // TODO fix our partial hydration manifest\n      mangleExports: !isPartialHydrationEnabled,\n      splitChunks,\n      minimizer: [\n        // TODO: maybe this option should be noMinimize?\n        !program.noUglify &&\n          plugins.minifyJs(\n            program.profile\n              ? {\n                  terserOptions: {\n                    keep_classnames: true,\n                    keep_fnames: true,\n                  },\n                }\n              : {}\n          ),\n        plugins.minifyCss(),\n      ].filter(Boolean),\n    }\n  }\n\n  if (stage === `build-html` || stage === `develop-html`) {\n    // externalize react, react-dom when develop-html or build-html(when not generating engines)\n    const shouldMarkPackagesAsExternal =\n      stage === `develop-html` || !shouldGenerateEngines()\n\n    // tracking = build-html (when not generating engines)\n    const shouldTrackBuiltins =\n      stage === `build-html` && !shouldGenerateEngines()\n\n    // removes node internals from bundle\n    // https://webpack.js.org/configuration/externals/#externalspresets\n    config.externalsPresets = {\n      // use it only when not tracking builtins (tracking builtins provide their own fallbacks)\n      node: !shouldTrackBuiltins,\n    }\n    config.externals = []\n\n    if (shouldMarkPackagesAsExternal) {\n      // Packages we want to externalize to save some build time\n      // https://github.com/gatsbyjs/gatsby/pull/14208#pullrequestreview-240178728\n      // const externalList = [`common-tags`, `lodash`, `semver`, /^lodash\\//]\n\n      // Packages we want to externalize because meant to be user-provided\n      const userExternalList = [`react`, /^react-dom\\//]\n\n      const checkItem = (item, request) => {\n        if (typeof item === `string` && item === request) {\n          return true\n        } else if (item instanceof RegExp && item.test(request)) {\n          return true\n        }\n\n        return false\n      }\n\n      config.externals.push(function (\n        { context, getResolve, request },\n        callback\n      ) {\n        // allows us to resolve webpack aliases from our config\n        // helpful for when react is aliased to preact-compat\n        // Force commonjs as we're in node land\n        const resolver = getResolve({\n          dependencyType: `commonjs`,\n        })\n\n        // User modules that do not need to be part of the bundle\n        if (userExternalList.some(item => checkItem(item, request))) {\n          // TODO figure out to make preact work with this too\n\n          resolver(context, request, (err, newRequest) => {\n            if (err) {\n              callback(err)\n              return\n            }\n\n            callback(null, newRequest)\n          })\n          return\n        }\n        // TODO look into re-enabling, breaks builds right now because of esm\n        // User modules that do not need to be part of the bundle\n        // if (externalList.some(item => checkItem(item, request))) {\n        //   resolver(context, request, (err, request) => {\n        //     if (err) {\n        //       callback(err)\n        //       return\n        //     }\n\n        //     callback(null, `commonjs2 ${request}`)\n        //   })\n        //   return\n        // }\n\n        callback()\n      })\n    }\n\n    if (shouldTrackBuiltins) {\n      if (stage === `build-html`) {\n        const builtinModulesToTrack = [\n          `fs`,\n          `http`,\n          `http2`,\n          `https`,\n          `child_process`,\n        ]\n        const builtinsExternalsDictionary = builtinModules.reduce(\n          (acc, builtinModule) => {\n            if (builtinModulesToTrack.includes(builtinModule)) {\n              acc[builtinModule] = `commonjs ${path.join(\n                program.directory,\n                `.cache`,\n                `ssr-builtin-trackers`,\n                builtinModule\n              )}`\n            } else {\n              acc[builtinModule] = `commonjs ${builtinModule}`\n            }\n            return acc\n          },\n          {}\n        )\n\n        config.externals.unshift(builtinsExternalsDictionary)\n      }\n    }\n  }\n\n  if (stage === `develop`) {\n    config.externals = {\n      \"socket.io-client\": `io`,\n    }\n  }\n\n  if (\n    stage === `build-javascript` ||\n    stage === `build-html` ||\n    stage === `develop` ||\n    stage === `develop-html`\n  ) {\n    const cacheLocation = path.join(\n      program.directory,\n      `.cache`,\n      `webpack`,\n      `stage-` + stage\n    )\n    const pluginsPathsPromises = store\n      .getState()\n      .flattenedPlugins.filter(plugin =>\n        plugin.nodeAPIs.includes(`onCreateWebpackConfig`)\n      )\n      .map(\n        async plugin =>\n          plugin.resolvedCompiledGatsbyNode ??\n          (await resolveJSFilepath({\n            rootDir: plugin.resolve,\n            filePath: path.join(plugin.resolve, `gatsby-node`),\n          }))\n      )\n    const pluginsPaths = await Promise.all(pluginsPathsPromises)\n\n    const cacheConfig = {\n      type: `filesystem`,\n      name: stage,\n      cacheLocation,\n      buildDependencies: {\n        config: [__filename, ...pluginsPaths],\n      },\n    }\n\n    config.cache = cacheConfig\n  }\n\n  store.dispatch(actions.replaceWebpackConfig(config))\n  const getConfig = () => store.getState().webpack\n\n  await apiRunnerNode(`onCreateWebpackConfig`, {\n    getConfig,\n    // we will converge to build-html later on but for now this was the fastest way to get SSR to work\n    stage,\n    rules,\n    loaders,\n    plugins,\n    parentSpan,\n  })\n\n  if (fastRefreshPlugin) {\n    // Fast refresh plugin has `include` option that determines\n    // wether HMR code gets injected. We need to make sure all custom loaders\n    // (like .ts or .mdx) that use our babel-loader will be taken into account\n    // when deciding which modules get fast-refresh HMR addition.\n    const fastRefreshIncludes = []\n    const babelLoaderLoc = require.resolve(`./babel-loader`)\n    for (const rule of getConfig().module.rules) {\n      if (!rule.use && !rule.loader) {\n        continue\n      }\n\n      let use = rule.use\n\n      if (typeof use === `function`) {\n        use = rule.use({})\n      }\n\n      const ruleLoaders = Array.isArray(use)\n        ? use.map(useEntry =>\n            typeof useEntry === `string` ? useEntry : useEntry.loader\n          )\n        : [use?.loader ?? rule.loader]\n\n      const hasBabelLoader = ruleLoaders.some(\n        loader => loader === babelLoaderLoc\n      )\n\n      if (hasBabelLoader) {\n        fastRefreshIncludes.push(rule.test)\n      }\n    }\n\n    // start with default include of fast refresh plugin\n    const includeRegex = /\\.([jt]sx?|flow)$/i\n    includeRegex.test = modulePath => {\n      // drop query param from request (i.e. ?type=component for mdx-loader)\n      // so loader rule test work well\n      const queryParamStartIndex = modulePath.indexOf(`?`)\n      if (queryParamStartIndex !== -1) {\n        modulePath = modulePath.slice(0, queryParamStartIndex)\n      }\n\n      return fastRefreshIncludes.some(re => re.test(modulePath))\n    }\n\n    fastRefreshPlugin.options.include = includeRegex\n  }\n\n  return getConfig()\n}\n"],"mappings":"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"}