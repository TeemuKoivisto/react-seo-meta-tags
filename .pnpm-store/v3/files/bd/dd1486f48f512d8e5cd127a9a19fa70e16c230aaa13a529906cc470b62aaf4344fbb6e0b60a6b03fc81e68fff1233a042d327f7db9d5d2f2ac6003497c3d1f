{"version":3,"file":"nodes-by-type.js","names":["getNodesOfType","node","state","type","internal","has","set","Map","nodeByType","get","Error","nodesByTypeReducer","action","payload","nodesOfType","id","delete","size"],"sources":["../../../src/redux/reducers/nodes-by-type.ts"],"sourcesContent":["import { IGatsbyNode, IGatsbyState, ActionsUnion } from \"../types\"\n\nconst getNodesOfType = (\n  node: IGatsbyNode,\n  state: IGatsbyState[\"nodesByType\"]\n): Map<string, IGatsbyNode> => {\n  const { type } = node.internal\n  if (!state.has(type)) {\n    state.set(type, new Map())\n  }\n  const nodeByType = state.get(type)\n\n  if (!nodeByType) {\n    throw new Error(\n      `An error occurred finding a node by it's type. This is likely a bug in gatsby. If you experience this error please open an issue.`\n    )\n  }\n\n  return nodeByType\n}\n\nexport const nodesByTypeReducer = (\n  state: IGatsbyState[\"nodesByType\"] = new Map(),\n  action: ActionsUnion\n): IGatsbyState[\"nodesByType\"] => {\n  switch (action.type) {\n    case `DELETE_CACHE`:\n      return new Map()\n\n    case `CREATE_NODE`: {\n      const node = action.payload\n      const nodesOfType = getNodesOfType(node, state)\n      nodesOfType.set(node.id, node)\n      return state\n    }\n\n    case `ADD_FIELD_TO_NODE`:\n    case `ADD_CHILD_NODE_TO_PARENT_NODE`: {\n      const node = action.payload\n      const nodesOfType = getNodesOfType(node, state)\n      nodesOfType.set(node.id, node)\n      return state\n    }\n\n    case `DELETE_NODE`: {\n      const node = action.payload\n      if (!node) return state\n      const nodesOfType = getNodesOfType(node, state)\n      nodesOfType.delete(node.id)\n      if (!nodesOfType.size) {\n        state.delete(node.internal.type)\n      }\n      return state\n    }\n\n    default:\n      return state\n  }\n}\n"],"mappings":";;;;AAEA,MAAMA,cAAc,GAAG,CACrBC,IAAiB,EACjBC,KAAkC,KACL;EAC7B,MAAM;IAAEC;EAAK,CAAC,GAAGF,IAAI,CAACG,QAAQ;EAC9B,IAAI,CAACF,KAAK,CAACG,GAAG,CAACF,IAAI,CAAC,EAAE;IACpBD,KAAK,CAACI,GAAG,CAACH,IAAI,EAAE,IAAII,GAAG,EAAE,CAAC;EAC5B;EACA,MAAMC,UAAU,GAAGN,KAAK,CAACO,GAAG,CAACN,IAAI,CAAC;EAElC,IAAI,CAACK,UAAU,EAAE;IACf,MAAM,IAAIE,KAAK,CACZ,mIAAkI,CACpI;EACH;EAEA,OAAOF,UAAU;AACnB,CAAC;AAEM,MAAMG,kBAAkB,GAAG,CAChCT,KAAkC,GAAG,IAAIK,GAAG,EAAE,EAC9CK,MAAoB,KACY;EAChC,QAAQA,MAAM,CAACT,IAAI;IACjB,KAAM,cAAa;MACjB,OAAO,IAAII,GAAG,EAAE;IAElB,KAAM,aAAY;MAAE;QAClB,MAAMN,IAAI,GAAGW,MAAM,CAACC,OAAO;QAC3B,MAAMC,WAAW,GAAGd,cAAc,CAACC,IAAI,EAAEC,KAAK,CAAC;QAC/CY,WAAW,CAACR,GAAG,CAACL,IAAI,CAACc,EAAE,EAAEd,IAAI,CAAC;QAC9B,OAAOC,KAAK;MACd;IAEA,KAAM,mBAAkB;IACxB,KAAM,+BAA8B;MAAE;QACpC,MAAMD,IAAI,GAAGW,MAAM,CAACC,OAAO;QAC3B,MAAMC,WAAW,GAAGd,cAAc,CAACC,IAAI,EAAEC,KAAK,CAAC;QAC/CY,WAAW,CAACR,GAAG,CAACL,IAAI,CAACc,EAAE,EAAEd,IAAI,CAAC;QAC9B,OAAOC,KAAK;MACd;IAEA,KAAM,aAAY;MAAE;QAClB,MAAMD,IAAI,GAAGW,MAAM,CAACC,OAAO;QAC3B,IAAI,CAACZ,IAAI,EAAE,OAAOC,KAAK;QACvB,MAAMY,WAAW,GAAGd,cAAc,CAACC,IAAI,EAAEC,KAAK,CAAC;QAC/CY,WAAW,CAACE,MAAM,CAACf,IAAI,CAACc,EAAE,CAAC;QAC3B,IAAI,CAACD,WAAW,CAACG,IAAI,EAAE;UACrBf,KAAK,CAACc,MAAM,CAACf,IAAI,CAACG,QAAQ,CAACD,IAAI,CAAC;QAClC;QACA,OAAOD,KAAK;MACd;IAEA;MACE,OAAOA,KAAK;EAAA;AAElB,CAAC;AAAA"}