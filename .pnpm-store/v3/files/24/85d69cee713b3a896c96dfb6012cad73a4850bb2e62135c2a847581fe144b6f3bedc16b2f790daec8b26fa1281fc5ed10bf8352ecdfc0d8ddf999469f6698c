{"version":3,"file":"actions.js","names":["concatUnique","array1","array2","Array","from","Set","concat","assignChangedPages","assign","context","event","pagesToBuild","data","changedPages","pagesToDelete","deletedPages","assignGraphQLRunners","store","program","assertStore","gatsbyNodeGraphQLFunction","createGraphQLRunner","reporter","graphqlRunner","GraphQLRunner","collectStats","graphqlTracing","dataLayerActions"],"sources":["../../../src/state-machines/data-layer/actions.ts"],"sourcesContent":["import { assign, DoneInvokeEvent, ActionFunctionMap } from \"xstate\"\nimport { createGraphQLRunner } from \"../../bootstrap/create-graphql-runner\"\nimport reporter from \"gatsby-cli/lib/reporter\"\nimport { IDataLayerContext } from \"./types\"\nimport { assertStore } from \"../../utils/assert-store\"\nimport { GraphQLRunner } from \"../../query/graphql-runner\"\n\nconst concatUnique = <T>(\n  array1: Array<T> = [],\n  array2: Array<T> = []\n): Array<T> => Array.from(new Set(array1.concat(array2)))\n\nexport const assignChangedPages = assign<\n  IDataLayerContext,\n  DoneInvokeEvent<{\n    changedPages: Array<string>\n    deletedPages: Array<string>\n  }>\n>((context, event) => {\n  return {\n    pagesToBuild: concatUnique(context.pagesToBuild, event.data.changedPages),\n    pagesToDelete: concatUnique(context.pagesToDelete, event.data.deletedPages),\n  }\n})\n\nexport const assignGraphQLRunners = assign<IDataLayerContext>(\n  ({ store, program }) => {\n    assertStore(store)\n    return {\n      gatsbyNodeGraphQLFunction: createGraphQLRunner(store, reporter),\n      graphqlRunner: new GraphQLRunner(store, {\n        collectStats: true,\n        graphqlTracing: program?.graphqlTracing,\n      }),\n    }\n  }\n)\n\nexport const dataLayerActions: ActionFunctionMap<IDataLayerContext, any> = {\n  assignChangedPages,\n  assignGraphQLRunners,\n}\n"],"mappings":";;;;;AAAA;AACA;AACA;AAEA;AACA;AAEA,MAAMA,YAAY,GAAG,CACnBC,MAAgB,GAAG,EAAE,EACrBC,MAAgB,GAAG,EAAE,KACRC,KAAK,CAACC,IAAI,CAAC,IAAIC,GAAG,CAACJ,MAAM,CAACK,MAAM,CAACJ,MAAM,CAAC,CAAC,CAAC;AAElD,MAAMK,kBAAkB,GAAG,IAAAC,cAAM,EAMtC,CAACC,OAAO,EAAEC,KAAK,KAAK;EACpB,OAAO;IACLC,YAAY,EAAEX,YAAY,CAACS,OAAO,CAACE,YAAY,EAAED,KAAK,CAACE,IAAI,CAACC,YAAY,CAAC;IACzEC,aAAa,EAAEd,YAAY,CAACS,OAAO,CAACK,aAAa,EAAEJ,KAAK,CAACE,IAAI,CAACG,YAAY;EAC5E,CAAC;AACH,CAAC,CAAC;AAAA;AAEK,MAAMC,oBAAoB,GAAG,IAAAR,cAAM,EACxC,CAAC;EAAES,KAAK;EAAEC;AAAQ,CAAC,KAAK;EACtB,IAAAC,wBAAW,EAACF,KAAK,CAAC;EAClB,OAAO;IACLG,yBAAyB,EAAE,IAAAC,wCAAmB,EAACJ,KAAK,EAAEK,iBAAQ,CAAC;IAC/DC,aAAa,EAAE,IAAIC,4BAAa,CAACP,KAAK,EAAE;MACtCQ,YAAY,EAAE,IAAI;MAClBC,cAAc,EAAER,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEQ;IAC3B,CAAC;EACH,CAAC;AACH,CAAC,CACF;AAAA;AAEM,MAAMC,gBAA2D,GAAG;EACzEpB,kBAAkB;EAClBS;AACF,CAAC;AAAA"}