/*!
 * hash-wasm (https://www.npmjs.com/package/hash-wasm)
 * (c) Dani Biro
 * @license MIT
 */

!function(e,A){"object"==typeof exports&&"undefined"!=typeof module?A(exports):"function"==typeof define&&define.amd?define(["exports"],A):A((e="undefined"!=typeof globalThis?globalThis:e||self).hashwasm=e.hashwasm||{})}(this,(function(e){"use strict";function A(e,A,t,n){return new(t||(t=Promise))((function(r,o){function i(e){try{a(n.next(e))}catch(e){o(e)}}function s(e){try{a(n.throw(e))}catch(e){o(e)}}function a(e){var A;e.done?r(e.value):(A=e.value,A instanceof t?A:new t((function(e){e(A)}))).then(i,s)}a((n=n.apply(e,A||[])).next())}))}class t{constructor(){this.mutex=Promise.resolve()}lock(){let e=()=>{};return this.mutex=this.mutex.then((()=>new Promise(e))),new Promise((A=>{e=A}))}dispatch(e){return A(this,void 0,void 0,(function*(){const A=yield this.lock();try{return yield Promise.resolve(e())}finally{A()}}))}}var n;const r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,o=null!==(n=r.Buffer)&&void 0!==n?n:null,i=r.TextEncoder?new r.TextEncoder:null;function s(e,A){return(15&e)+(e>>6|e>>3&8)<<4|(15&A)+(A>>6|A>>3&8)}const a="a".charCodeAt(0)-10,c="0".charCodeAt(0);function f(e,A,t){let n=0;for(let r=0;r<t;r++){let t=A[r]>>>4;e[n++]=t>9?t+a:t+c,t=15&A[r],e[n++]=t>9?t+a:t+c}return String.fromCharCode.apply(null,e)}const l=null!==o?e=>{if("string"==typeof e){const A=o.from(e,"utf8");return new Uint8Array(A.buffer,A.byteOffset,A.length)}if(o.isBuffer(e))return new Uint8Array(e.buffer,e.byteOffset,e.length);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Invalid data type!")}:e=>{if("string"==typeof e)return i.encode(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Invalid data type!")},B="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=new Uint8Array(256);for(let e=0;e<B.length;e++)h[B.charCodeAt(e)]=e;function g(e){const A=function(e){let A=Math.floor(.75*e.length);const t=e.length;return"="===e[t-1]&&(A-=1,"="===e[t-2]&&(A-=1)),A}(e),t=e.length,n=new Uint8Array(A);let r=0;for(let A=0;A<t;A+=4){const t=h[e.charCodeAt(A)],o=h[e.charCodeAt(A+1)],i=h[e.charCodeAt(A+2)],s=h[e.charCodeAt(A+3)];n[r]=t<<2|o>>4,r+=1,n[r]=(15&o)<<4|i>>2,r+=1,n[r]=(3&i)<<6|63&s,r+=1}return n}const u=16384,Q=new t,d=new Map;function I(e,t){return A(this,void 0,void 0,(function*(){let n=null,r=null,o=!1;if("undefined"==typeof WebAssembly)throw new Error("WebAssembly is not supported in this environment!");const i=()=>new DataView(n.exports.memory.buffer).getUint32(n.exports.STATE_SIZE,!0),a=Q.dispatch((()=>A(this,void 0,void 0,(function*(){if(!d.has(e.name)){const A=g(e.data),t=WebAssembly.compile(A);d.set(e.name,t)}const A=yield d.get(e.name);n=yield WebAssembly.instantiate(A,{})})))),c=(e=null)=>{o=!0,n.exports.Hash_Init(e)},B=e=>{if(!o)throw new Error("update() called before init()");(e=>{let A=0;for(;A<e.length;){const t=e.subarray(A,A+u);A+=t.length,r.set(t),n.exports.Hash_Update(t.length)}})(l(e))},h=new Uint8Array(2*t),I=(e,A=null)=>{if(!o)throw new Error("digest() called before init()");return o=!1,n.exports.Hash_Final(A),"binary"===e?r.slice(0,t):f(h,r,t)},y=e=>"string"==typeof e?e.length<4096:e.byteLength<u;let C=y;switch(e.name){case"argon2":case"scrypt":C=()=>!0;break;case"blake2b":case"blake2s":C=(e,A)=>A<=512&&y(e);break;case"blake3":C=(e,A)=>0===A&&y(e);break;case"xxhash64":case"xxhash3":case"xxhash128":C=()=>!1}return yield(()=>A(this,void 0,void 0,(function*(){n||(yield a);const e=n.exports.Hash_GetBuffer(),A=n.exports.memory.buffer;r=new Uint8Array(A,e,u)})))(),{getMemory:()=>r,writeMemory:(e,A=0)=>{r.set(e,A)},getExports:()=>n.exports,setMemorySize:e=>{n.exports.Hash_SetMemorySize(e);const A=n.exports.Hash_GetBuffer(),t=n.exports.memory.buffer;r=new Uint8Array(t,A,e)},init:c,update:B,digest:I,save:()=>{if(!o)throw new Error("save() can only be called after init() and before digest()");const A=n.exports.Hash_GetState(),t=i(),r=n.exports.memory.buffer,a=new Uint8Array(r,A,t),c=new Uint8Array(4+t);return function(e,A){const t=A.length>>1;for(let n=0;n<t;n++){const t=n<<1;e[n]=s(A.charCodeAt(t),A.charCodeAt(t+1))}}(c,e.hash),c.set(a,4),c},load:A=>{if(!(A instanceof Uint8Array))throw new Error("load() expects an Uint8Array generated by save()");const t=n.exports.Hash_GetState(),r=i(),a=4+r,c=n.exports.memory.buffer;if(A.length!==a)throw new Error(`Bad state length (expected ${a} bytes, got ${A.length})`);if(!function(e,A){if(e.length!==2*A.length)return!1;for(let t=0;t<A.length;t++){const n=t<<1;if(A[t]!==s(e.charCodeAt(n),e.charCodeAt(n+1)))return!1}return!0}(e.hash,A.subarray(0,4)))throw new Error("This state was written by an incompatible hash implementation");const f=A.subarray(4);new Uint8Array(c,t,r).set(f),o=!0},calculate:(e,A=null,o=null)=>{if(!C(e,A))return c(A),B(e),I("hex",o);const i=l(e);return r.set(i),n.exports.Hash_Calculate(i.length,A,o),f(h,r,t)},hashLength:t}}))}var y={name:"crc32",data:"AGFzbQEAAAABEQRgAAF/YAF/AGAAAGACf38AAwgHAAEBAQIAAwQFAXABAQEFBAEBAgIGDgJ/AUGQyQULfwBBgAgLB3AIBm1lbW9yeQIADkhhc2hfR2V0QnVmZmVyAAAJSGFzaF9Jbml0AAILSGFzaF9VcGRhdGUAAwpIYXNoX0ZpbmFsAAQNSGFzaF9HZXRTdGF0ZQAFDkhhc2hfQ2FsY3VsYXRlAAYKU1RBVEVfU0laRQMBCq0HBwUAQYAJC8MDAQN/QYCJASEBQQAhAgNAIAFBAEEAQQBBAEEAQQBBAEEAIAJBAXFrIABxIAJBAXZzIgNBAXFrIABxIANBAXZzIgNBAXFrIABxIANBAXZzIgNBAXFrIABxIANBAXZzIgNBAXFrIABxIANBAXZzIgNBAXFrIABxIANBAXZzIgNBAXFrIABxIANBAXZzIgNBAXFrIABxIANBAXZzNgIAIAFBBGohASACQQFqIgJBgAJHDQALQQAhAANAIABBhJEBaiAAQYSJAWooAgAiAkH/AXFBAnRBgIkBaigCACACQQh2cyICNgIAIABBhJkBaiACQf8BcUECdEGAiQFqKAIAIAJBCHZzIgI2AgAgAEGEoQFqIAJB/wFxQQJ0QYCJAWooAgAgAkEIdnMiAjYCACAAQYSpAWogAkH/AXFBAnRBgIkBaigCACACQQh2cyICNgIAIABBhLEBaiACQf8BcUECdEGAiQFqKAIAIAJBCHZzIgI2AgAgAEGEuQFqIAJB/wFxQQJ0QYCJAWooAgAgAkEIdnMiAjYCACAAQYTBAWogAkH/AXFBAnRBgIkBaigCACACQQh2czYCACAAQQRqIgBB/AdHDQALCycAAkBBACgCgMkBIABGDQAgABABQQAgADYCgMkBC0EAQQA2AoTJAQuhAgEDf0EAKAKEyQFBf3MhAUGACSECAkAgAEEISQ0AQYAJIQIDQCACQQRqKAIAIgNBDnZB/AdxQYCRAWooAgAgA0EWdkH8B3FBgIkBaigCAHMgA0EGdkH8B3FBgJkBaigCAHMgA0H/AXFBAnRBgKEBaigCAHMgAigCACABcyIBQRZ2QfwHcUGAqQFqKAIAcyABQQ52QfwHcUGAsQFqKAIAcyABQQZ2QfwHcUGAuQFqKAIAcyABQf8BcUECdEGAwQFqKAIAcyEBIAJBCGohAiAAQXhqIgBBB0sNAAsLAkAgAEUNAANAIAFB/wFxIAItAABzQQJ0QYCJAWooAgAgAUEIdnMhASACQQFqIQIgAEF/aiIADQALC0EAIAFBf3M2AoTJAQszAQF/QQBBACgChMkBIgBBGHQgAEEIdEGAgPwHcXIgAEEIdkGA/gNxIABBGHZycjYCgAkLBgBBhMkBC1oAAkBBACgCgMkBIAFGDQAgARABQQAgATYCgMkBC0EAQQA2AoTJASAAEANBAEEAKAKEyQEiAUEYdCABQQh0QYCA/AdxciABQQh2QYD+A3EgAUEYdnJyNgKACQsLCwEAQYAICwQEAAAA",hash:"749723dc"};const C=new t;let E=null;e.crc32c=function(e){if(null===E)return function(e,t,n){return A(this,void 0,void 0,(function*(){const A=yield e.lock(),r=yield I(t,n);return A(),r}))}(C,y,4).then((A=>(E=A,E.calculate(e,2197175160))));try{const A=E.calculate(e,2197175160);return Promise.resolve(A)}catch(e){return Promise.reject(e)}},e.createCRC32C=function(){return I(y,4).then((e=>{e.init(2197175160);const A={init:()=>(e.init(2197175160),A),update:t=>(e.update(t),A),digest:A=>e.digest(A),save:()=>e.save(),load:t=>(e.load(t),A),blockSize:4,digestSize:4};return A}))},Object.defineProperty(e,"__esModule",{value:!0})}));
