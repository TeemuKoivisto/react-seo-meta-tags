{"version":3,"file":"register-service-worker.js","names":["window","location","protocol","hostname","console","error","navigator","serviceWorker","register","__BASE_PATH__","then","reg","addEventListener","apiRunner","installingWorker","installing","log","state","controller","___swUpdated","___failedResources","reload","catch","e"],"sources":["../register-service-worker.js"],"sourcesContent":["import { apiRunner } from \"./api-runner-browser\"\n\nif (\n  window.location.protocol !== `https:` &&\n  window.location.hostname !== `localhost`\n) {\n  console.error(\n    `Service workers can only be used over HTTPS, or on localhost for development`\n  )\n} else if (`serviceWorker` in navigator) {\n  navigator.serviceWorker\n    .register(`${__BASE_PATH__}/sw.js`)\n    .then(function (reg) {\n      reg.addEventListener(`updatefound`, () => {\n        apiRunner(`onServiceWorkerUpdateFound`, { serviceWorker: reg })\n        // The updatefound event implies that reg.installing is set; see\n        // https://w3c.github.io/ServiceWorker/#service-worker-registration-updatefound-event\n        const installingWorker = reg.installing\n        console.log(`installingWorker`, installingWorker)\n        installingWorker.addEventListener(`statechange`, () => {\n          switch (installingWorker.state) {\n            case `installed`:\n              if (navigator.serviceWorker.controller) {\n                // At this point, the old content will have been purged and the fresh content will\n                // have been added to the cache.\n\n                // We set a flag so Gatsby Link knows to refresh the page on next navigation attempt\n                window.___swUpdated = true\n                // We call the onServiceWorkerUpdateReady API so users can show update prompts.\n                apiRunner(`onServiceWorkerUpdateReady`, { serviceWorker: reg })\n\n                // If resources failed for the current page, reload.\n                if (window.___failedResources) {\n                  console.log(`resources failed, SW updated - reloading`)\n                  window.location.reload()\n                }\n              } else {\n                // At this point, everything has been precached.\n                // It's the perfect time to display a \"Content is cached for offline use.\" message.\n                console.log(`Content is now available offline!`)\n\n                // Post to service worker that install is complete.\n                // Delay to allow time for the event listener to be added --\n                // otherwise fetch is called too soon and resources aren't cached.\n                apiRunner(`onServiceWorkerInstalled`, { serviceWorker: reg })\n              }\n              break\n\n            case `redundant`:\n              console.error(`The installing service worker became redundant.`)\n              apiRunner(`onServiceWorkerRedundant`, { serviceWorker: reg })\n              break\n\n            case `activated`:\n              apiRunner(`onServiceWorkerActive`, { serviceWorker: reg })\n              break\n          }\n        })\n      })\n    })\n    .catch(function (e) {\n      console.error(`Error during service worker registration:`, e)\n    })\n}\n"],"mappings":";;AAAA;AAEA,IACEA,MAAM,CAACC,QAAQ,CAACC,QAAQ,KAAM,QAAO,IACrCF,MAAM,CAACC,QAAQ,CAACE,QAAQ,KAAM,WAAU,EACxC;EACAC,OAAO,CAACC,KAAK,CACV,8EAA6E,CAC/E;AACH,CAAC,MAAM,IAAK,eAAc,IAAIC,SAAS,EAAE;EACvCA,SAAS,CAACC,aAAa,CACpBC,QAAQ,CAAE,GAAEC,aAAc,QAAO,CAAC,CAClCC,IAAI,CAAC,UAAUC,GAAG,EAAE;IACnBA,GAAG,CAACC,gBAAgB,CAAE,aAAY,EAAE,MAAM;MACxC,IAAAC,2BAAS,EAAE,4BAA2B,EAAE;QAAEN,aAAa,EAAEI;MAAI,CAAC,CAAC;MAC/D;MACA;MACA,MAAMG,gBAAgB,GAAGH,GAAG,CAACI,UAAU;MACvCX,OAAO,CAACY,GAAG,CAAE,kBAAiB,EAAEF,gBAAgB,CAAC;MACjDA,gBAAgB,CAACF,gBAAgB,CAAE,aAAY,EAAE,MAAM;QACrD,QAAQE,gBAAgB,CAACG,KAAK;UAC5B,KAAM,WAAU;YACd,IAAIX,SAAS,CAACC,aAAa,CAACW,UAAU,EAAE;cACtC;cACA;;cAEA;cACAlB,MAAM,CAACmB,YAAY,GAAG,IAAI;cAC1B;cACA,IAAAN,2BAAS,EAAE,4BAA2B,EAAE;gBAAEN,aAAa,EAAEI;cAAI,CAAC,CAAC;;cAE/D;cACA,IAAIX,MAAM,CAACoB,kBAAkB,EAAE;gBAC7BhB,OAAO,CAACY,GAAG,CAAE,0CAAyC,CAAC;gBACvDhB,MAAM,CAACC,QAAQ,CAACoB,MAAM,EAAE;cAC1B;YACF,CAAC,MAAM;cACL;cACA;cACAjB,OAAO,CAACY,GAAG,CAAE,mCAAkC,CAAC;;cAEhD;cACA;cACA;cACA,IAAAH,2BAAS,EAAE,0BAAyB,EAAE;gBAAEN,aAAa,EAAEI;cAAI,CAAC,CAAC;YAC/D;YACA;UAEF,KAAM,WAAU;YACdP,OAAO,CAACC,KAAK,CAAE,iDAAgD,CAAC;YAChE,IAAAQ,2BAAS,EAAE,0BAAyB,EAAE;cAAEN,aAAa,EAAEI;YAAI,CAAC,CAAC;YAC7D;UAEF,KAAM,WAAU;YACd,IAAAE,2BAAS,EAAE,uBAAsB,EAAE;cAAEN,aAAa,EAAEI;YAAI,CAAC,CAAC;YAC1D;QAAK;MAEX,CAAC,CAAC;IACJ,CAAC,CAAC;EACJ,CAAC,CAAC,CACDW,KAAK,CAAC,UAAUC,CAAC,EAAE;IAClBnB,OAAO,CAACC,KAAK,CAAE,2CAA0C,EAAEkB,CAAC,CAAC;EAC/D,CAAC,CAAC;AACN"}