{"version":3,"file":"writable-as-promise.js","names":["WritableAsPromise","Writable","constructor","_output","_deferred","promise","resolve","reject","Promise","_write","chunk","_","next","toString","_destroy","error","Error","end","destroy","then"],"sources":["../../server-utils/writable-as-promise.js"],"sourcesContent":["import { Writable } from \"stream\"\n\nexport class WritableAsPromise extends Writable {\n  constructor() {\n    super()\n\n    this._output = ``\n    this._deferred = {\n      promise: null,\n      resolve: null,\n      reject: null,\n    }\n    this._deferred.promise = new Promise((resolve, reject) => {\n      this._deferred.resolve = resolve\n      this._deferred.reject = reject\n    })\n  }\n\n  _write(chunk, _, next) {\n    this._output += chunk.toString()\n    next()\n  }\n\n  _destroy(error, next) {\n    if (error instanceof Error) {\n      this._deferred.reject(error)\n    } else {\n      next()\n    }\n  }\n\n  end() {\n    this._deferred.resolve(this._output)\n    this.destroy()\n  }\n\n  // disguise us as a promise\n  then(resolve, reject) {\n    return this._deferred.promise.then(resolve, reject)\n  }\n}\n"],"mappings":";;;;AAAA;AAEO,MAAMA,iBAAiB,SAASC,gBAAQ,CAAC;EAC9CC,WAAW,GAAG;IACZ,KAAK,EAAE;IAEP,IAAI,CAACC,OAAO,GAAI,EAAC;IACjB,IAAI,CAACC,SAAS,GAAG;MACfC,OAAO,EAAE,IAAI;MACbC,OAAO,EAAE,IAAI;MACbC,MAAM,EAAE;IACV,CAAC;IACD,IAAI,CAACH,SAAS,CAACC,OAAO,GAAG,IAAIG,OAAO,CAAC,CAACF,OAAO,EAAEC,MAAM,KAAK;MACxD,IAAI,CAACH,SAAS,CAACE,OAAO,GAAGA,OAAO;MAChC,IAAI,CAACF,SAAS,CAACG,MAAM,GAAGA,MAAM;IAChC,CAAC,CAAC;EACJ;EAEAE,MAAM,CAACC,KAAK,EAAEC,CAAC,EAAEC,IAAI,EAAE;IACrB,IAAI,CAACT,OAAO,IAAIO,KAAK,CAACG,QAAQ,EAAE;IAChCD,IAAI,EAAE;EACR;EAEAE,QAAQ,CAACC,KAAK,EAAEH,IAAI,EAAE;IACpB,IAAIG,KAAK,YAAYC,KAAK,EAAE;MAC1B,IAAI,CAACZ,SAAS,CAACG,MAAM,CAACQ,KAAK,CAAC;IAC9B,CAAC,MAAM;MACLH,IAAI,EAAE;IACR;EACF;EAEAK,GAAG,GAAG;IACJ,IAAI,CAACb,SAAS,CAACE,OAAO,CAAC,IAAI,CAACH,OAAO,CAAC;IACpC,IAAI,CAACe,OAAO,EAAE;EAChB;;EAEA;EACAC,IAAI,CAACb,OAAO,EAAEC,MAAM,EAAE;IACpB,OAAO,IAAI,CAACH,SAAS,CAACC,OAAO,CAACc,IAAI,CAACb,OAAO,EAAEC,MAAM,CAAC;EACrD;AACF;AAAC"}