{"version":3,"file":"get-latest-apis.js","names":["API_FILE","ROOT","path","join","__dirname","OUTPUT_FILE","getLatestAPIs","data","axios","get","timeout","fs","writeFile","JSON","stringify","e","pathExists","readJSON","catch","browser","node","ssr"],"sources":["../../src/utils/get-latest-apis.ts"],"sourcesContent":["import path from \"path\"\nimport fs from \"fs-extra\"\nimport axios from \"axios\"\n\nconst API_FILE = `https://unpkg.com/gatsby/apis.json`\nconst ROOT = path.join(__dirname, `..`, `..`)\nconst OUTPUT_FILE = path.join(ROOT, `latest-apis.json`)\n\nexport interface IAPIResponse {\n  browser: Record<string, any>\n  node: Record<string, any>\n  ssr: Record<string, any>\n}\n\nexport const getLatestAPIs = async (): Promise<IAPIResponse> => {\n  try {\n    const { data } = await axios.get(API_FILE, { timeout: 5000 })\n\n    await fs.writeFile(OUTPUT_FILE, JSON.stringify(data, null, 2), `utf8`)\n\n    return data\n  } catch (e) {\n    if (await fs.pathExists(OUTPUT_FILE)) {\n      return fs.readJSON(OUTPUT_FILE)\n    }\n    // possible offline/network issue\n    return fs.readJSON(path.join(ROOT, `apis.json`)).catch(() => {\n      return {\n        browser: {},\n        node: {},\n        ssr: {},\n      }\n    })\n  }\n}\n"],"mappings":";;;;;AAAA;AACA;AACA;AAEA,MAAMA,QAAQ,GAAI,oCAAmC;AACrD,MAAMC,IAAI,GAAGC,aAAI,CAACC,IAAI,CAACC,SAAS,EAAG,IAAG,EAAG,IAAG,CAAC;AAC7C,MAAMC,WAAW,GAAGH,aAAI,CAACC,IAAI,CAACF,IAAI,EAAG,kBAAiB,CAAC;AAQhD,MAAMK,aAAa,GAAG,YAAmC;EAC9D,IAAI;IACF,MAAM;MAAEC;IAAK,CAAC,GAAG,MAAMC,cAAK,CAACC,GAAG,CAACT,QAAQ,EAAE;MAAEU,OAAO,EAAE;IAAK,CAAC,CAAC;IAE7D,MAAMC,gBAAE,CAACC,SAAS,CAACP,WAAW,EAAEQ,IAAI,CAACC,SAAS,CAACP,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC,EAAG,MAAK,CAAC;IAEtE,OAAOA,IAAI;EACb,CAAC,CAAC,OAAOQ,CAAC,EAAE;IACV,IAAI,MAAMJ,gBAAE,CAACK,UAAU,CAACX,WAAW,CAAC,EAAE;MACpC,OAAOM,gBAAE,CAACM,QAAQ,CAACZ,WAAW,CAAC;IACjC;IACA;IACA,OAAOM,gBAAE,CAACM,QAAQ,CAACf,aAAI,CAACC,IAAI,CAACF,IAAI,EAAG,WAAU,CAAC,CAAC,CAACiB,KAAK,CAAC,MAAM;MAC3D,OAAO;QACLC,OAAO,EAAE,CAAC,CAAC;QACXC,IAAI,EAAE,CAAC,CAAC;QACRC,GAAG,EAAE,CAAC;MACR,CAAC;IACH,CAAC,CAAC;EACJ;AACF,CAAC;AAAA"}