{"version":3,"file":"check-local-plugin.js","names":["checkLocalPlugin","plugin","rootDir","pluginName","resolve","existsSync","validLocalPlugin","resolvedPath","slash","path","join","resolvedPackageJson","Error","localPluginPath"],"sources":["../../../../src/bootstrap/load-plugins/utils/check-local-plugin.ts"],"sourcesContent":["import { PluginRef } from \"../types\"\nimport { sync as existsSync } from \"fs-exists-cached\"\nimport { slash } from \"gatsby-core-utils\"\nimport path from \"path\"\n\n/**\n * Checks if a plugin is a valid local plugin and returns the resolved path if it is.\n */\nexport function checkLocalPlugin(\n  plugin: PluginRef,\n  rootDir: string\n): { validLocalPlugin: boolean; localPluginPath?: string } {\n  const pluginName = typeof plugin === `string` ? plugin : plugin.resolve\n\n  // Make sure the plugin exists relatively\n  if (existsSync(pluginName) || !rootDir) {\n    return {\n      validLocalPlugin: false,\n    }\n  }\n\n  const resolvedPath = slash(path.join(rootDir, `plugins/${pluginName}`))\n\n  if (!existsSync(resolvedPath)) {\n    return {\n      validLocalPlugin: false,\n    }\n  }\n\n  const resolvedPackageJson = existsSync(`${resolvedPath}/package.json`)\n\n  // package.json is a requirement for local plugins\n  if (!resolvedPackageJson) {\n    throw new Error(`Local plugin ${pluginName} requires a package.json file`)\n  }\n\n  return {\n    validLocalPlugin: true,\n    localPluginPath: resolvedPath,\n  }\n}\n"],"mappings":";;;;;AACA;AACA;AACA;AAEA;AACA;AACA;AACO,SAASA,gBAAgB,CAC9BC,MAAiB,EACjBC,OAAe,EAC0C;EACzD,MAAMC,UAAU,GAAG,OAAOF,MAAM,KAAM,QAAO,GAAGA,MAAM,GAAGA,MAAM,CAACG,OAAO;;EAEvE;EACA,IAAI,IAAAC,oBAAU,EAACF,UAAU,CAAC,IAAI,CAACD,OAAO,EAAE;IACtC,OAAO;MACLI,gBAAgB,EAAE;IACpB,CAAC;EACH;EAEA,MAAMC,YAAY,GAAG,IAAAC,sBAAK,EAACC,aAAI,CAACC,IAAI,CAACR,OAAO,EAAG,WAAUC,UAAW,EAAC,CAAC,CAAC;EAEvE,IAAI,CAAC,IAAAE,oBAAU,EAACE,YAAY,CAAC,EAAE;IAC7B,OAAO;MACLD,gBAAgB,EAAE;IACpB,CAAC;EACH;EAEA,MAAMK,mBAAmB,GAAG,IAAAN,oBAAU,EAAE,GAAEE,YAAa,eAAc,CAAC;;EAEtE;EACA,IAAI,CAACI,mBAAmB,EAAE;IACxB,MAAM,IAAIC,KAAK,CAAE,gBAAeT,UAAW,+BAA8B,CAAC;EAC5E;EAEA,OAAO;IACLG,gBAAgB,EAAE,IAAI;IACtBO,eAAe,EAAEN;EACnB,CAAC;AACH"}