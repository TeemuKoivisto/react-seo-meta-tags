/*!
 * hash-wasm (https://www.npmjs.com/package/hash-wasm)
 * (c) Dani Biro
 * @license MIT
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).hashwasm=e.hashwasm||{})}(this,(function(e){"use strict";function t(e,t,A,n){return new(A||(A=Promise))((function(r,i){function o(e){try{a(n.next(e))}catch(e){i(e)}}function s(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof A?t:new A((function(e){e(t)}))).then(o,s)}a((n=n.apply(e,t||[])).next())}))}class A{constructor(){this.mutex=Promise.resolve()}lock(){let e=()=>{};return this.mutex=this.mutex.then((()=>new Promise(e))),new Promise((t=>{e=t}))}dispatch(e){return t(this,void 0,void 0,(function*(){const t=yield this.lock();try{return yield Promise.resolve(e())}finally{t()}}))}}var n;const r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,i=null!==(n=r.Buffer)&&void 0!==n?n:null,o=r.TextEncoder?new r.TextEncoder:null;function s(e,t){return(15&e)+(e>>6|e>>3&8)<<4|(15&t)+(t>>6|t>>3&8)}const a="a".charCodeAt(0)-10,Q="0".charCodeAt(0);function f(e,t,A){let n=0;for(let r=0;r<A;r++){let A=t[r]>>>4;e[n++]=A>9?A+a:A+Q,A=15&t[r],e[n++]=A>9?A+a:A+Q}return String.fromCharCode.apply(null,e)}const h=null!==i?e=>{if("string"==typeof e){const t=i.from(e,"utf8");return new Uint8Array(t.buffer,t.byteOffset,t.length)}if(i.isBuffer(e))return new Uint8Array(e.buffer,e.byteOffset,e.length);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Invalid data type!")}:e=>{if("string"==typeof e)return o.encode(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Invalid data type!")},C="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=new Uint8Array(256);for(let e=0;e<C.length;e++)l[C.charCodeAt(e)]=e;function g(e){const t=function(e){let t=Math.floor(.75*e.length);const A=e.length;return"="===e[A-1]&&(t-=1,"="===e[A-2]&&(t-=1)),t}(e),A=e.length,n=new Uint8Array(t);let r=0;for(let t=0;t<A;t+=4){const A=l[e.charCodeAt(t)],i=l[e.charCodeAt(t+1)],o=l[e.charCodeAt(t+2)],s=l[e.charCodeAt(t+3)];n[r]=A<<2|i>>4,r+=1,n[r]=(15&i)<<4|o>>2,r+=1,n[r]=(3&o)<<6|63&s,r+=1}return n}const u=16384,c=new A,B=new Map;function I(e,A){return t(this,void 0,void 0,(function*(){let n=null,r=null,i=!1;if("undefined"==typeof WebAssembly)throw new Error("WebAssembly is not supported in this environment!");const o=()=>new DataView(n.exports.memory.buffer).getUint32(n.exports.STATE_SIZE,!0),a=c.dispatch((()=>t(this,void 0,void 0,(function*(){if(!B.has(e.name)){const t=g(e.data),A=WebAssembly.compile(t);B.set(e.name,A)}const t=yield B.get(e.name);n=yield WebAssembly.instantiate(t,{})})))),Q=(e=null)=>{i=!0,n.exports.Hash_Init(e)},C=e=>{if(!i)throw new Error("update() called before init()");(e=>{let t=0;for(;t<e.length;){const A=e.subarray(t,t+u);t+=A.length,r.set(A),n.exports.Hash_Update(A.length)}})(h(e))},l=new Uint8Array(2*A),I=(e,t=null)=>{if(!i)throw new Error("digest() called before init()");return i=!1,n.exports.Hash_Final(t),"binary"===e?r.slice(0,A):f(l,r,A)},y=e=>"string"==typeof e?e.length<4096:e.byteLength<u;let d=y;switch(e.name){case"argon2":case"scrypt":d=()=>!0;break;case"blake2b":case"blake2s":d=(e,t)=>t<=512&&y(e);break;case"blake3":d=(e,t)=>0===t&&y(e);break;case"xxhash64":case"xxhash3":case"xxhash128":d=()=>!1}return yield(()=>t(this,void 0,void 0,(function*(){n||(yield a);const e=n.exports.Hash_GetBuffer(),t=n.exports.memory.buffer;r=new Uint8Array(t,e,u)})))(),{getMemory:()=>r,writeMemory:(e,t=0)=>{r.set(e,t)},getExports:()=>n.exports,setMemorySize:e=>{n.exports.Hash_SetMemorySize(e);const t=n.exports.Hash_GetBuffer(),A=n.exports.memory.buffer;r=new Uint8Array(A,t,e)},init:Q,update:C,digest:I,save:()=>{if(!i)throw new Error("save() can only be called after init() and before digest()");const t=n.exports.Hash_GetState(),A=o(),r=n.exports.memory.buffer,a=new Uint8Array(r,t,A),Q=new Uint8Array(4+A);return function(e,t){const A=t.length>>1;for(let n=0;n<A;n++){const A=n<<1;e[n]=s(t.charCodeAt(A),t.charCodeAt(A+1))}}(Q,e.hash),Q.set(a,4),Q},load:t=>{if(!(t instanceof Uint8Array))throw new Error("load() expects an Uint8Array generated by save()");const A=n.exports.Hash_GetState(),r=o(),a=4+r,Q=n.exports.memory.buffer;if(t.length!==a)throw new Error(`Bad state length (expected ${a} bytes, got ${t.length})`);if(!function(e,t){if(e.length!==2*t.length)return!1;for(let A=0;A<t.length;A++){const n=A<<1;if(t[A]!==s(e.charCodeAt(n),e.charCodeAt(n+1)))return!1}return!0}(e.hash,t.subarray(0,4)))throw new Error("This state was written by an incompatible hash implementation");const f=t.subarray(4);new Uint8Array(Q,A,r).set(f),i=!0},calculate:(e,t=null,i=null)=>{if(!d(e,t))return Q(t),C(e),I("hex",i);const o=h(e);return r.set(o),n.exports.Hash_Calculate(o.length,t,i),f(l,r,A)},hashLength:A}}))}var y={name:"xxhash64",data:"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",hash:"bc315b2a"};const d=new A;let E=null;const w=new ArrayBuffer(8);function b(e){return!Number.isInteger(e)||e<0||e>4294967295?new Error("Seed must be given as two valid 32-bit long unsigned integers (lo + high)."):null}function p(e,t,A){const n=new DataView(e);n.setUint32(0,t,!0),n.setUint32(4,A,!0)}e.createXXHash64=function(e=0,t=0){return b(e)?Promise.reject(b(e)):b(t)?Promise.reject(b(t)):I(y,8).then((A=>{const n=new ArrayBuffer(8);p(n,e,t),A.writeMemory(new Uint8Array(n)),A.init();const r={init:()=>(A.writeMemory(new Uint8Array(n)),A.init(),r),update:e=>(A.update(e),r),digest:e=>A.digest(e),save:()=>A.save(),load:e=>(A.load(e),r),blockSize:32,digestSize:8};return r}))},e.xxhash64=function(e,A=0,n=0){if(b(A))return Promise.reject(b(A));if(b(n))return Promise.reject(b(n));if(null===E)return function(e,A,n){return t(this,void 0,void 0,(function*(){const t=yield e.lock(),r=yield I(A,n);return t(),r}))}(d,y,8).then((t=>(E=t,p(w,A,n),E.writeMemory(new Uint8Array(w)),E.calculate(e))));try{p(w,A,n),E.writeMemory(new Uint8Array(w));const t=E.calculate(e);return Promise.resolve(t)}catch(e){return Promise.reject(e)}},Object.defineProperty(e,"__esModule",{value:!0})}));
