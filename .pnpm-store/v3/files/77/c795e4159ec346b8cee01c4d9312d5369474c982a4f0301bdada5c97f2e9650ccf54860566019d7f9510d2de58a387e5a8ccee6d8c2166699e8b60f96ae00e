/*!
 * hash-wasm (https://www.npmjs.com/package/hash-wasm)
 * (c) Dani Biro
 * @license MIT
 */

!function(e,A){"object"==typeof exports&&"undefined"!=typeof module?A(exports):"function"==typeof define&&define.amd?define(["exports"],A):A((e="undefined"!=typeof globalThis?globalThis:e||self).hashwasm=e.hashwasm||{})}(this,(function(e){"use strict";function A(e,A,t,n){return new(t||(t=Promise))((function(r,o){function i(e){try{a(n.next(e))}catch(e){o(e)}}function s(e){try{a(n.throw(e))}catch(e){o(e)}}function a(e){var A;e.done?r(e.value):(A=e.value,A instanceof t?A:new t((function(e){e(A)}))).then(i,s)}a((n=n.apply(e,A||[])).next())}))}class t{constructor(){this.mutex=Promise.resolve()}lock(){let e=()=>{};return this.mutex=this.mutex.then((()=>new Promise(e))),new Promise((A=>{e=A}))}dispatch(e){return A(this,void 0,void 0,(function*(){const A=yield this.lock();try{return yield Promise.resolve(e())}finally{A()}}))}}var n;const r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,o=null!==(n=r.Buffer)&&void 0!==n?n:null,i=r.TextEncoder?new r.TextEncoder:null;function s(e,A){return(15&e)+(e>>6|e>>3&8)<<4|(15&A)+(A>>6|A>>3&8)}const a="a".charCodeAt(0)-10,Q="0".charCodeAt(0);function l(e,A,t){let n=0;for(let r=0;r<t;r++){let t=A[r]>>>4;e[n++]=t>9?t+a:t+Q,t=15&A[r],e[n++]=t>9?t+a:t+Q}return String.fromCharCode.apply(null,e)}const f=null!==o?e=>{if("string"==typeof e){const A=o.from(e,"utf8");return new Uint8Array(A.buffer,A.byteOffset,A.length)}if(o.isBuffer(e))return new Uint8Array(e.buffer,e.byteOffset,e.length);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Invalid data type!")}:e=>{if("string"==typeof e)return i.encode(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Invalid data type!")},h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=new Uint8Array(256);for(let e=0;e<h.length;e++)c[h.charCodeAt(e)]=e;function B(e){const A=function(e){let A=Math.floor(.75*e.length);const t=e.length;return"="===e[t-1]&&(A-=1,"="===e[t-2]&&(A-=1)),A}(e),t=e.length,n=new Uint8Array(A);let r=0;for(let A=0;A<t;A+=4){const t=c[e.charCodeAt(A)],o=c[e.charCodeAt(A+1)],i=c[e.charCodeAt(A+2)],s=c[e.charCodeAt(A+3)];n[r]=t<<2|o>>4,r+=1,n[r]=(15&o)<<4|i>>2,r+=1,n[r]=(3&i)<<6|63&s,r+=1}return n}const u=16384,g=new t,C=new Map;function d(e,t){return A(this,void 0,void 0,(function*(){let n=null,r=null,o=!1;if("undefined"==typeof WebAssembly)throw new Error("WebAssembly is not supported in this environment!");const i=()=>new DataView(n.exports.memory.buffer).getUint32(n.exports.STATE_SIZE,!0),a=g.dispatch((()=>A(this,void 0,void 0,(function*(){if(!C.has(e.name)){const A=B(e.data),t=WebAssembly.compile(A);C.set(e.name,t)}const A=yield C.get(e.name);n=yield WebAssembly.instantiate(A,{})})))),Q=(e=null)=>{o=!0,n.exports.Hash_Init(e)},h=e=>{if(!o)throw new Error("update() called before init()");(e=>{let A=0;for(;A<e.length;){const t=e.subarray(A,A+u);A+=t.length,r.set(t),n.exports.Hash_Update(t.length)}})(f(e))},c=new Uint8Array(2*t),d=(e,A=null)=>{if(!o)throw new Error("digest() called before init()");return o=!1,n.exports.Hash_Final(A),"binary"===e?r.slice(0,t):l(c,r,t)},E=e=>"string"==typeof e?e.length<4096:e.byteLength<u;let I=E;switch(e.name){case"argon2":case"scrypt":I=()=>!0;break;case"blake2b":case"blake2s":I=(e,A)=>A<=512&&E(e);break;case"blake3":I=(e,A)=>0===A&&E(e);break;case"xxhash64":case"xxhash3":case"xxhash128":I=()=>!1}return yield(()=>A(this,void 0,void 0,(function*(){n||(yield a);const e=n.exports.Hash_GetBuffer(),A=n.exports.memory.buffer;r=new Uint8Array(A,e,u)})))(),{getMemory:()=>r,writeMemory:(e,A=0)=>{r.set(e,A)},getExports:()=>n.exports,setMemorySize:e=>{n.exports.Hash_SetMemorySize(e);const A=n.exports.Hash_GetBuffer(),t=n.exports.memory.buffer;r=new Uint8Array(t,A,e)},init:Q,update:h,digest:d,save:()=>{if(!o)throw new Error("save() can only be called after init() and before digest()");const A=n.exports.Hash_GetState(),t=i(),r=n.exports.memory.buffer,a=new Uint8Array(r,A,t),Q=new Uint8Array(4+t);return function(e,A){const t=A.length>>1;for(let n=0;n<t;n++){const t=n<<1;e[n]=s(A.charCodeAt(t),A.charCodeAt(t+1))}}(Q,e.hash),Q.set(a,4),Q},load:A=>{if(!(A instanceof Uint8Array))throw new Error("load() expects an Uint8Array generated by save()");const t=n.exports.Hash_GetState(),r=i(),a=4+r,Q=n.exports.memory.buffer;if(A.length!==a)throw new Error(`Bad state length (expected ${a} bytes, got ${A.length})`);if(!function(e,A){if(e.length!==2*A.length)return!1;for(let t=0;t<A.length;t++){const n=t<<1;if(A[t]!==s(e.charCodeAt(n),e.charCodeAt(n+1)))return!1}return!0}(e.hash,A.subarray(0,4)))throw new Error("This state was written by an incompatible hash implementation");const l=A.subarray(4);new Uint8Array(Q,t,r).set(l),o=!0},calculate:(e,A=null,o=null)=>{if(!I(e,A))return Q(A),h(e),d("hex",o);const i=f(e);return r.set(i),n.exports.Hash_Calculate(i.length,A,o),l(c,r,t)},hashLength:t}}))}var E={name:"xxhash32",data:"AGFzbQEAAAABEQRgAAF/YAF/AGAAAGACf38AAwcGAAEBAgADBAUBcAEBAQUEAQECAgYOAn8BQbCJBQt/AEGACAsHcAgGbWVtb3J5AgAOSGFzaF9HZXRCdWZmZXIAAAlIYXNoX0luaXQAAQtIYXNoX1VwZGF0ZQACCkhhc2hfRmluYWwAAw1IYXNoX0dldFN0YXRlAAQOSGFzaF9DYWxjdWxhdGUABQpTVEFURV9TSVpFAwEKswkGBQBBgAkLTQBBAEIANwOoiQFBACAANgKIiQFBACAAQc+Moo4GajYCjIkBQQAgAEH3lK+veGo2AoSJAUEAIABBqIiNoQJqNgKAiQFBAEEANgKgiQELswUBBn8CQCAARQ0AQQBBACkDqIkBIACtfDcDqIkBAkBBACgCoIkBIgEgAGpBD0sNAEEAIAFBAWo2AqCJASABQZCJAWpBAC0AgAk6AAAgAEEBRg0BQQEhAgNAQQBBACgCoIkBIgFBAWo2AqCJASABQZCJAWogAkGACWotAAA6AAAgACACQQFqIgJHDQAMAgsLIABB8AhqIQMCQAJAIAENAEEAKAKMiQEhAUEAKAKIiQEhBEEAKAKEiQEhBUEAKAKAiQEhBkGACSECDAELQYAJIQICQCABQQ9LDQBBgAkhAgNAIAItAAAhBEEAIAFBAWo2AqCJASABQZCJAWogBDoAACACQQFqIQJBACgCoIkBIgFBEEkNAAsLQQBBACgCkIkBQfeUr694bEEAKAKAiQFqQQ13QbHz3fF5bCIGNgKAiQFBAEEAKAKUiQFB95Svr3hsQQAoAoSJAWpBDXdBsfPd8XlsIgU2AoSJAUEAQQAoApiJAUH3lK+veGxBACgCiIkBakENd0Gx893xeWwiBDYCiIkBQQBBACgCnIkBQfeUr694bEEAKAKMiQFqQQ13QbHz3fF5bCIBNgKMiQELIABBgAlqIQACQCACIANLDQADQCACKAIAQfeUr694bCAGakENd0Gx893xeWwhBiACQQxqKAIAQfeUr694bCABakENd0Gx893xeWwhASACQQhqKAIAQfeUr694bCAEakENd0Gx893xeWwhBCACQQRqKAIAQfeUr694bCAFakENd0Gx893xeWwhBSACQRBqIgIgA00NAAsLQQAgATYCjIkBQQAgBDYCiIkBQQAgBTYChIkBQQAgBjYCgIkBQQAgACACayIBNgKgiQEgAUUNAEEAIQEDQCABQZCJAWogAiABai0AADoAACABQQFqIgFBACgCoIkBSQ0ACwsLzAICAX4Gf0EAKQOoiQEiAKchAQJAAkAgAEIQVA0AQQAoAoSJAUEHd0EAKAKAiQFBAXdqQQAoAoiJAUEMd2pBACgCjIkBQRJ3aiECDAELQQAoAoiJAUGxz9myAWohAgsgAiABaiECQZCJASEBQQAoAqCJASIDQZCJAWohBAJAIANBBEgNAEGQiQEhBQNAIAUoAgBBvdzKlXxsIAJqQRF3Qa/W074CbCECIAVBCGohBiAFQQRqIgEhBSAGIARNDQALCwJAIAEgBEYNACADQZCJAWohBQNAIAEtAABBsc/ZsgFsIAJqQQt3QbHz3fF5bCECIAUgAUEBaiIBRw0ACwtBACACQQ92IAJzQfeUr694bCIBQQ12IAFzQb3cypV8bCIBQRB2IAFzIgFBGHQgAUEIdEGAgPwHcXIgAUEIdkGA/gNxIAFBGHZycq03A4AJCwYAQYCJAQtTAEEAQgA3A6iJAUEAIAE2AoiJAUEAIAFBz4yijgZqNgKMiQFBACABQfeUr694ajYChIkBQQAgAUGoiI2hAmo2AoCJAUEAQQA2AqCJASAAEAIQAwsLCwEAQYAICwQwAAAA",hash:"5b6a5062"};const I=new t;let y=null;function w(e){return!Number.isInteger(e)||e<0||e>4294967295?new Error("Seed must be a valid 32-bit long unsigned integer."):null}e.createXXHash32=function(e=0){return w(e)?Promise.reject(w(e)):d(E,4).then((A=>{A.init(e);const t={init:()=>(A.init(e),t),update:e=>(A.update(e),t),digest:e=>A.digest(e),save:()=>A.save(),load:e=>(A.load(e),t),blockSize:16,digestSize:4};return t}))},e.xxhash32=function(e,t=0){if(w(t))return Promise.reject(w(t));if(null===y)return function(e,t,n){return A(this,void 0,void 0,(function*(){const A=yield e.lock(),r=yield d(t,n);return A(),r}))}(I,E,4).then((A=>(y=A,y.calculate(e,t))));try{const A=y.calculate(e,t);return Promise.resolve(A)}catch(e){return Promise.reject(e)}},Object.defineProperty(e,"__esModule",{value:!0})}));
