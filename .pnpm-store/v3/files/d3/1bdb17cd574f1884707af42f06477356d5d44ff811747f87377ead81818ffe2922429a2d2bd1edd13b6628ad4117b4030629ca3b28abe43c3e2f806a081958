{"version":3,"file":"api-runner-browser.js","names":["plugins","require","getResourceURLsForPathname","loadPage","loadPageSync","publicLoader","exports","apiRunner","api","args","defaultReturn","argTransform","process","env","CYPRESS_SUPPORT","window","___apiHandler","___resolvedAPIs","push","results","map","plugin","undefined","result","options","filter","length","apiRunnerAsync","reduce","previous","next","then","Promise","resolve"],"sources":["../api-runner-browser.js"],"sourcesContent":["const plugins = require(`./api-runner-browser-plugins`)\nconst { getResourceURLsForPathname, loadPage, loadPageSync } =\n  require(`./loader`).publicLoader\n\nexports.apiRunner = (api, args = {}, defaultReturn, argTransform) => {\n  // Hooks for gatsby-cypress's API handler\n  if (process.env.CYPRESS_SUPPORT) {\n    if (window.___apiHandler) {\n      window.___apiHandler(api)\n    } else if (window.___resolvedAPIs) {\n      window.___resolvedAPIs.push(api)\n    } else {\n      window.___resolvedAPIs = [api]\n    }\n  }\n\n  let results = plugins.map(plugin => {\n    if (!plugin.plugin[api]) {\n      return undefined\n    }\n\n    args.getResourceURLsForPathname = getResourceURLsForPathname\n    args.loadPage = loadPage\n    args.loadPageSync = loadPageSync\n\n    const result = plugin.plugin[api](args, plugin.options)\n    if (result && argTransform) {\n      args = argTransform({ args, result, plugin })\n    }\n    return result\n  })\n\n  // Filter out undefined results.\n  results = results.filter(result => typeof result !== `undefined`)\n\n  if (results.length > 0) {\n    return results\n  } else if (defaultReturn) {\n    return [defaultReturn]\n  } else {\n    return []\n  }\n}\n\nexports.apiRunnerAsync = (api, args, defaultReturn) =>\n  plugins.reduce(\n    (previous, next) =>\n      next.plugin[api]\n        ? previous.then(() => next.plugin[api](args, next.options))\n        : previous,\n    Promise.resolve()\n  )\n"],"mappings":";;AAAA,MAAMA,OAAO,GAAGC,OAAO,CAAE,8BAA6B,CAAC;AACvD,MAAM;EAAEC,0BAA0B;EAAEC,QAAQ;EAAEC;AAAa,CAAC,GAC1DH,OAAO,CAAE,UAAS,CAAC,CAACI,YAAY;AAElCC,OAAO,CAACC,SAAS,GAAG,CAACC,GAAG,EAAEC,IAAI,GAAG,CAAC,CAAC,EAAEC,aAAa,EAAEC,YAAY,KAAK;EACnE;EACA,IAAIC,OAAO,CAACC,GAAG,CAACC,eAAe,EAAE;IAC/B,IAAIC,MAAM,CAACC,aAAa,EAAE;MACxBD,MAAM,CAACC,aAAa,CAACR,GAAG,CAAC;IAC3B,CAAC,MAAM,IAAIO,MAAM,CAACE,eAAe,EAAE;MACjCF,MAAM,CAACE,eAAe,CAACC,IAAI,CAACV,GAAG,CAAC;IAClC,CAAC,MAAM;MACLO,MAAM,CAACE,eAAe,GAAG,CAACT,GAAG,CAAC;IAChC;EACF;EAEA,IAAIW,OAAO,GAAGnB,OAAO,CAACoB,GAAG,CAACC,MAAM,IAAI;IAClC,IAAI,CAACA,MAAM,CAACA,MAAM,CAACb,GAAG,CAAC,EAAE;MACvB,OAAOc,SAAS;IAClB;IAEAb,IAAI,CAACP,0BAA0B,GAAGA,0BAA0B;IAC5DO,IAAI,CAACN,QAAQ,GAAGA,QAAQ;IACxBM,IAAI,CAACL,YAAY,GAAGA,YAAY;IAEhC,MAAMmB,MAAM,GAAGF,MAAM,CAACA,MAAM,CAACb,GAAG,CAAC,CAACC,IAAI,EAAEY,MAAM,CAACG,OAAO,CAAC;IACvD,IAAID,MAAM,IAAIZ,YAAY,EAAE;MAC1BF,IAAI,GAAGE,YAAY,CAAC;QAAEF,IAAI;QAAEc,MAAM;QAAEF;MAAO,CAAC,CAAC;IAC/C;IACA,OAAOE,MAAM;EACf,CAAC,CAAC;;EAEF;EACAJ,OAAO,GAAGA,OAAO,CAACM,MAAM,CAACF,MAAM,IAAI,OAAOA,MAAM,KAAM,WAAU,CAAC;EAEjE,IAAIJ,OAAO,CAACO,MAAM,GAAG,CAAC,EAAE;IACtB,OAAOP,OAAO;EAChB,CAAC,MAAM,IAAIT,aAAa,EAAE;IACxB,OAAO,CAACA,aAAa,CAAC;EACxB,CAAC,MAAM;IACL,OAAO,EAAE;EACX;AACF,CAAC;AAEDJ,OAAO,CAACqB,cAAc,GAAG,CAACnB,GAAG,EAAEC,IAAI,EAAEC,aAAa,KAChDV,OAAO,CAAC4B,MAAM,CACZ,CAACC,QAAQ,EAAEC,IAAI,KACbA,IAAI,CAACT,MAAM,CAACb,GAAG,CAAC,GACZqB,QAAQ,CAACE,IAAI,CAAC,MAAMD,IAAI,CAACT,MAAM,CAACb,GAAG,CAAC,CAACC,IAAI,EAAEqB,IAAI,CAACN,OAAO,CAAC,CAAC,GACzDK,QAAQ,EACdG,OAAO,CAACC,OAAO,EAAE,CAClB"}