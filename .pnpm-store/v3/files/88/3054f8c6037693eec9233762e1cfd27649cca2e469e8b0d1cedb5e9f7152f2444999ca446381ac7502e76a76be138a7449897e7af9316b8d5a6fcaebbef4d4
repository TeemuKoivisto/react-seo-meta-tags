{"version":3,"file":"create-normalized-module-key.js","names":["createNormalizedModuleKey","resourcePath","rootContext","rootRelativeFilePath","replace","rootRelativeDir","potentialModuleName","split","path","sep","filter","Boolean","normalizedModuleKey","join","slice","slash"],"sources":["../../../../src/utils/webpack/utils/create-normalized-module-key.ts"],"sourcesContent":["import path from \"path\"\nimport { slash } from \"gatsby-core-utils\"\n\n/**\n * Create a normalized module key that is referenced in both the partial hydration webpack loader and plugin.\n * This solves for module imports that may be differently bundled for different environments (e.g. browser, node).\n *\n * If the module is a local module, the key is the relative path from the project root (e.g. `file://src/components/index.js`).\n * If the module is a node module, the key is the relative path to the module name in `node_modules` (e.g. `file://node_modules/react`).\n *\n * @param resourcePath Absolute path to the resource\n * @param rootContext Absolute path to project root\n * @returns Normalized module key\n */\nexport function createNormalizedModuleKey(\n  resourcePath: string,\n  rootContext: string\n): string {\n  const rootRelativeFilePath = resourcePath.replace(rootContext, ``)\n  const [rootRelativeDir, potentialModuleName] = rootRelativeFilePath\n    .split(path.sep)\n    .filter(Boolean)\n  const normalizedModuleKey =\n    rootRelativeDir === `node_modules`\n      ? `file://${path.join(rootRelativeDir, potentialModuleName)}`\n      : `file://${rootRelativeFilePath.slice(1)}`\n  return slash(normalizedModuleKey)\n}\n"],"mappings":";;;;;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASA,yBAAyB,CACvCC,YAAoB,EACpBC,WAAmB,EACX;EACR,MAAMC,oBAAoB,GAAGF,YAAY,CAACG,OAAO,CAACF,WAAW,EAAG,EAAC,CAAC;EAClE,MAAM,CAACG,eAAe,EAAEC,mBAAmB,CAAC,GAAGH,oBAAoB,CAChEI,KAAK,CAACC,aAAI,CAACC,GAAG,CAAC,CACfC,MAAM,CAACC,OAAO,CAAC;EAClB,MAAMC,mBAAmB,GACvBP,eAAe,KAAM,cAAa,GAC7B,UAASG,aAAI,CAACK,IAAI,CAACR,eAAe,EAAEC,mBAAmB,CAAE,EAAC,GAC1D,UAASH,oBAAoB,CAACW,KAAK,CAAC,CAAC,CAAE,EAAC;EAC/C,OAAO,IAAAC,sBAAK,EAACH,mBAAmB,CAAC;AACnC"}