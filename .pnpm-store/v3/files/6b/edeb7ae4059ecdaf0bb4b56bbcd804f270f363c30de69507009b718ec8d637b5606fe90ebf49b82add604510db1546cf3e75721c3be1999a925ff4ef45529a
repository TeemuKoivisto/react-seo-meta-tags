{"version":3,"file":"flatten-plugins.js","names":["flattenPlugins","plugins","flattened","extractPlugins","plugin","subPluginPaths","subPluginPath","segments","split","roots","pluginOptions","segment","flat","map","root","forEach","subPlugin","push"],"sources":["../../../../src/bootstrap/load-plugins/utils/flatten-plugins.ts"],"sourcesContent":["import { IPluginInfo } from \"../types\"\n\n// Create a \"flattened\" array of plugins with all subplugins\n// brought to the top-level. This simplifies running gatsby-* files\n// for subplugins.\nexport const flattenPlugins = (\n  plugins: Array<IPluginInfo>\n): Array<IPluginInfo> => {\n  const flattened: Array<IPluginInfo> = []\n  const extractPlugins = (plugin: IPluginInfo): void => {\n    if (plugin.subPluginPaths) {\n      for (const subPluginPath of plugin.subPluginPaths) {\n        // @pieh:\n        // subPluginPath can look like someOption.randomFieldThatIsMarkedAsSubplugins\n        // Reason for doing stringified path with . separator was that it was just easier to prevent duplicates\n        // in subPluginPaths array (as each subplugin in the gatsby-config would add subplugin path).\n        const segments = subPluginPath.split(`.`)\n        let roots: Array<any> = [plugin.pluginOptions]\n        for (const segment of segments) {\n          if (segment === `[]`) {\n            roots = roots.flat()\n          } else {\n            roots = roots.map(root => root[segment])\n          }\n        }\n        roots = roots.flat()\n\n        roots.forEach(subPlugin => {\n          flattened.push(subPlugin)\n          extractPlugins(subPlugin)\n        })\n      }\n    }\n  }\n\n  plugins.forEach(plugin => {\n    flattened.push(plugin)\n    extractPlugins(plugin)\n  })\n\n  return flattened\n}\n"],"mappings":";;;;AAEA;AACA;AACA;AACO,MAAMA,cAAc,GACzBC,OAA2B,IACJ;EACvB,MAAMC,SAA6B,GAAG,EAAE;EACxC,MAAMC,cAAc,GAAIC,MAAmB,IAAW;IACpD,IAAIA,MAAM,CAACC,cAAc,EAAE;MACzB,KAAK,MAAMC,aAAa,IAAIF,MAAM,CAACC,cAAc,EAAE;QACjD;QACA;QACA;QACA;QACA,MAAME,QAAQ,GAAGD,aAAa,CAACE,KAAK,CAAE,GAAE,CAAC;QACzC,IAAIC,KAAiB,GAAG,CAACL,MAAM,CAACM,aAAa,CAAC;QAC9C,KAAK,MAAMC,OAAO,IAAIJ,QAAQ,EAAE;UAC9B,IAAII,OAAO,KAAM,IAAG,EAAE;YACpBF,KAAK,GAAGA,KAAK,CAACG,IAAI,EAAE;UACtB,CAAC,MAAM;YACLH,KAAK,GAAGA,KAAK,CAACI,GAAG,CAACC,IAAI,IAAIA,IAAI,CAACH,OAAO,CAAC,CAAC;UAC1C;QACF;QACAF,KAAK,GAAGA,KAAK,CAACG,IAAI,EAAE;QAEpBH,KAAK,CAACM,OAAO,CAACC,SAAS,IAAI;UACzBd,SAAS,CAACe,IAAI,CAACD,SAAS,CAAC;UACzBb,cAAc,CAACa,SAAS,CAAC;QAC3B,CAAC,CAAC;MACJ;IACF;EACF,CAAC;EAEDf,OAAO,CAACc,OAAO,CAACX,MAAM,IAAI;IACxBF,SAAS,CAACe,IAAI,CAACb,MAAM,CAAC;IACtBD,cAAc,CAACC,MAAM,CAAC;EACxB,CAAC,CAAC;EAEF,OAAOF,SAAS;AAClB,CAAC;AAAA"}