{"version":3,"file":"gatsby-node.js","names":["exports","onPreBootstrap","store","program","getState","copyLibFiles","path","join","directory","createPages","actions","createRedirect","config","partytownProxiedURLs","host","encodedURL","encodeURIComponent","fromPath","thirdPartyProxyPath","toPath","statusCode","onCreateDevServer","app","use","partytownProxy"],"sources":["../../../src/internal-plugins/partytown/gatsby-node.ts"],"sourcesContent":["import path from \"path\"\nimport { copyLibFiles } from \"@builder.io/partytown/utils\"\nimport { CreateDevServerArgs } from \"gatsby\"\nimport { thirdPartyProxyPath, partytownProxy } from \"./proxy\"\n\n/**\n * Copy Partytown library files to public.\n * @see {@link https://partytown.builder.io/copy-library-files}\n */\nexports.onPreBootstrap = async ({ store }): Promise<void> => {\n  const { program } = store.getState()\n  await copyLibFiles(path.join(program.directory, `public`, `~partytown`))\n}\n\n/**\n * Implement reverse proxy so scripts can fetch in web workers without CORS errors.\n * @see {@link https://partytown.builder.io/proxying-requests}\n */\nexports.createPages = ({ actions, store }): void => {\n  const { createRedirect } = actions\n\n  const { config = {} } = store.getState()\n  const { partytownProxiedURLs = [] } = config\n\n  for (const host of partytownProxiedURLs) {\n    const encodedURL: string = encodeURIComponent(host)\n\n    createRedirect({\n      fromPath: `${thirdPartyProxyPath}?url=${encodedURL}`,\n      toPath: host,\n      statusCode: 200,\n    })\n  }\n}\n\nexport async function onCreateDevServer({\n  app,\n  store,\n}: CreateDevServerArgs): Promise<void> {\n  const { config } = store.getState()\n  const { partytownProxiedURLs = [] } = config || {}\n\n  app.use(thirdPartyProxyPath, partytownProxy(partytownProxiedURLs))\n}\n"],"mappings":";;;;;AAAA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACAA,OAAO,CAACC,cAAc,GAAG,OAAO;EAAEC;AAAM,CAAC,KAAoB;EAC3D,MAAM;IAAEC;EAAQ,CAAC,GAAGD,KAAK,CAACE,QAAQ,EAAE;EACpC,MAAM,IAAAC,mBAAY,EAACC,aAAI,CAACC,IAAI,CAACJ,OAAO,CAACK,SAAS,EAAG,QAAO,EAAG,YAAW,CAAC,CAAC;AAC1E,CAAC;;AAED;AACA;AACA;AACA;AACAR,OAAO,CAACS,WAAW,GAAG,CAAC;EAAEC,OAAO;EAAER;AAAM,CAAC,KAAW;EAClD,MAAM;IAAES;EAAe,CAAC,GAAGD,OAAO;EAElC,MAAM;IAAEE,MAAM,GAAG,CAAC;EAAE,CAAC,GAAGV,KAAK,CAACE,QAAQ,EAAE;EACxC,MAAM;IAAES,oBAAoB,GAAG;EAAG,CAAC,GAAGD,MAAM;EAE5C,KAAK,MAAME,IAAI,IAAID,oBAAoB,EAAE;IACvC,MAAME,UAAkB,GAAGC,kBAAkB,CAACF,IAAI,CAAC;IAEnDH,cAAc,CAAC;MACbM,QAAQ,EAAG,GAAEC,0BAAoB,QAAOH,UAAW,EAAC;MACpDI,MAAM,EAAEL,IAAI;MACZM,UAAU,EAAE;IACd,CAAC,CAAC;EACJ;AACF,CAAC;AAEM,eAAeC,iBAAiB,CAAC;EACtCC,GAAG;EACHpB;AACmB,CAAC,EAAiB;EACrC,MAAM;IAAEU;EAAO,CAAC,GAAGV,KAAK,CAACE,QAAQ,EAAE;EACnC,MAAM;IAAES,oBAAoB,GAAG;EAAG,CAAC,GAAGD,MAAM,IAAI,CAAC,CAAC;EAElDU,GAAG,CAACC,GAAG,CAACL,0BAAmB,EAAE,IAAAM,qBAAc,EAACX,oBAAoB,CAAC,CAAC;AACpE"}