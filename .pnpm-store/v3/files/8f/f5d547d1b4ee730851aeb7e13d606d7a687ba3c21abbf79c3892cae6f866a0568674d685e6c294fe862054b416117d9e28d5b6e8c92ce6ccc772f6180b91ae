{"version":3,"file":"index.js","names":["reducer","state","event","action","buildError","errors","devSsrError","payload","concat","getServerDataError","graphqlErrors","initialState","DevOverlay","children","dispatch","React","useReducer","useEffect","gatsbyEvents","window","_gatsbyEvents","push","channel","forEach","dismiss","hasBuildError","hasRuntimeErrors","Boolean","length","hasGetServerDataError","hasGraphqlErrors","hasDevSsrError","hasErrors","ErrorComponent","undefined"],"sources":["../../fast-refresh-overlay/index.js"],"sourcesContent":["import * as React from \"react\"\nimport { ErrorBoundary } from \"./components/error-boundary\"\nimport { ShadowPortal } from \"../shadow-portal\"\nimport { Style } from \"./style\"\nimport { BuildError } from \"./components/build-error\"\nimport { RuntimeErrors } from \"./components/runtime-errors\"\nimport { GraphqlErrors } from \"./components/graphql-errors\"\nimport { DevSsrError } from \"./components/dev-ssr-error\"\nimport { GetServerDataError } from \"./components/getserverdata-error\"\n\nconst reducer = (state, event) => {\n  switch (event.action) {\n    case `CLEAR_COMPILE_ERROR`: {\n      return { ...state, buildError: null }\n    }\n    case `CLEAR_RUNTIME_ERRORS`: {\n      return { ...state, errors: [] }\n    }\n    case `CLEAR_DEV_SSR_ERROR`: {\n      return { ...state, devSsrError: null }\n    }\n    case `SHOW_COMPILE_ERROR`: {\n      return { ...state, buildError: event.payload }\n    }\n    case `SHOW_DEV_SSR_ERROR`: {\n      return { ...state, devSsrError: event.payload }\n    }\n    case `HANDLE_RUNTIME_ERROR`:\n    case `SHOW_RUNTIME_ERRORS`: {\n      return { ...state, errors: state.errors.concat(event.payload) }\n    }\n    case `SHOW_GETSERVERDATA_ERROR`: {\n      return {\n        ...state,\n        getServerDataError: event.payload,\n      }\n    }\n    case `SHOW_GRAPHQL_ERRORS`: {\n      return {\n        ...state,\n        graphqlErrors: event.payload,\n      }\n    }\n    case `CLEAR_GRAPHQL_ERRORS`: {\n      return { ...state, graphqlErrors: [] }\n    }\n    case `DISMISS`: {\n      return {\n        ...state,\n        buildError: null,\n        errors: [],\n        graphqlErrors: [],\n        getServerDataError: null,\n      }\n    }\n    default: {\n      return state\n    }\n  }\n}\n\nconst initialState = {\n  errors: [],\n  buildError: null,\n  devSsrError: null,\n  getServerDataError: null,\n  graphqlErrors: [],\n}\n\nfunction DevOverlay({ children }) {\n  const [state, dispatch] = React.useReducer(reducer, initialState)\n\n  React.useEffect(() => {\n    const gatsbyEvents = window._gatsbyEvents || []\n    window._gatsbyEvents = {\n      push: ([channel, event]) => {\n        if (channel === `FAST_REFRESH`) {\n          dispatch(event)\n        }\n      },\n    }\n\n    gatsbyEvents.forEach(([channel, event]) => {\n      if (channel === `FAST_REFRESH`) {\n        dispatch(event)\n      }\n    })\n    return () => {\n      window._gatsbyEvents = []\n    }\n  }, [dispatch])\n\n  const dismiss = () => {\n    dispatch({ action: `DISMISS` })\n    // Setting gatsbyEvents = [] is necessary for the runtime errors to correctly clear\n    // However, using this for serverData errors doesn't work and results in the overlay not showing up\n    // again since the component isn't remounted and thus the .push method is not reinitalized\n    window._gatsbyEvents = []\n  }\n\n  const hasBuildError = state.buildError !== null\n  const hasRuntimeErrors = Boolean(state.errors.length)\n  const hasGetServerDataError = Boolean(state.getServerDataError)\n  const hasGraphqlErrors = Boolean(state.graphqlErrors.length)\n  const hasDevSsrError = state.devSsrError !== null\n  const hasErrors =\n    hasBuildError ||\n    hasRuntimeErrors ||\n    hasGraphqlErrors ||\n    hasDevSsrError ||\n    hasGetServerDataError\n\n  // This component has a deliberate order (priority)\n  const ErrorComponent = () => {\n    if (hasBuildError) {\n      return <BuildError error={state.buildError} />\n    }\n    if (hasGetServerDataError) {\n      return <GetServerDataError error={state.getServerDataError} />\n    }\n    if (hasRuntimeErrors) {\n      return <RuntimeErrors errors={state.errors} dismiss={dismiss} />\n    }\n    if (hasGraphqlErrors) {\n      return <GraphqlErrors errors={state.graphqlErrors} dismiss={dismiss} />\n    }\n    if (hasDevSsrError) {\n      return <DevSsrError error={state.devSsrError} />\n    }\n\n    return null\n  }\n\n  return (\n    <React.Fragment>\n      <ErrorBoundary hasErrors={hasErrors}>{children ?? null}</ErrorBoundary>\n      {hasErrors ? (\n        <ShadowPortal identifier=\"gatsby-fast-refresh\">\n          <Style />\n          <ErrorComponent />\n        </ShadowPortal>\n      ) : undefined}\n    </React.Fragment>\n  )\n}\n\nexport default DevOverlay\n"],"mappings":"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"}