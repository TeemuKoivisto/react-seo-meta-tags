{"version":3,"file":"find-path.js","names":["pathCache","Map","matchPaths","trimPathname","rawPathname","newRawPathname","queryIndex","indexOf","path","qs","split","encodeURIComponent","pathname","decodeURIComponent","trimmedPathname","stripPrefix","__BASE_PATH__","absolutify","startsWith","URL","window","location","href","endsWith","setMatchPaths","value","findMatchPath","cleanPath","pickPaths","map","matchPath","originalPath","pick","normalizePagePath","route","grabMatchParams","params","findPath","has","get","redirect","maybeGetBrowserRedirect","toPath","foundPath","set"],"sources":["../find-path.js"],"sourcesContent":["import { pick } from \"@gatsbyjs/reach-router\"\nimport stripPrefix from \"./strip-prefix\"\nimport normalizePagePath from \"./normalize-page-path\"\nimport { maybeGetBrowserRedirect } from \"./redirect-utils.js\"\n\nconst pathCache = new Map()\nlet matchPaths = []\n\nconst trimPathname = rawPathname => {\n  let newRawPathname = rawPathname\n  const queryIndex = rawPathname.indexOf(`?`)\n\n  if (queryIndex !== -1) {\n    const [path, qs] = rawPathname.split(`?`)\n    newRawPathname = `${path}?${encodeURIComponent(qs)}`\n  }\n\n  const pathname = decodeURIComponent(newRawPathname)\n\n  // Remove the pathPrefix from the pathname.\n  const trimmedPathname = stripPrefix(\n    pathname,\n    decodeURIComponent(__BASE_PATH__)\n  )\n    // Remove any hashfragment\n    .split(`#`)[0]\n\n  return trimmedPathname\n}\n\nfunction absolutify(path) {\n  // If it's already absolute, return as-is\n  if (\n    path.startsWith(`/`) ||\n    path.startsWith(`https://`) ||\n    path.startsWith(`http://`)\n  ) {\n    return path\n  }\n  // Calculate path relative to current location, adding a trailing slash to\n  // match behavior of @reach/router\n  return new URL(\n    path,\n    window.location.href + (window.location.href.endsWith(`/`) ? `` : `/`)\n  ).pathname\n}\n\n/**\n * Set list of matchPaths\n *\n * @param {Array<{path: string, matchPath: string}>} value collection of matchPaths\n */\nexport const setMatchPaths = value => {\n  matchPaths = value\n}\n\n/**\n * Return a matchpath url\n * if `match-paths.json` contains `{ \"/foo*\": \"/page1\", ...}`, then\n * `/foo?bar=far` => `/page1`\n *\n * @param {string} rawPathname A raw pathname\n * @return {string|null}\n */\nexport const findMatchPath = rawPathname => {\n  const trimmedPathname = cleanPath(rawPathname)\n\n  const pickPaths = matchPaths.map(({ path, matchPath }) => {\n    return {\n      path: matchPath,\n      originalPath: path,\n    }\n  })\n\n  const path = pick(pickPaths, trimmedPathname)\n\n  if (path) {\n    return normalizePagePath(path.route.originalPath)\n  }\n\n  return null\n}\n\n/**\n * Return a matchpath params from reach/router rules\n * if `match-paths.json` contains `{ \":bar/*foo\" }`, and the path is /baz/zaz/zoo\n * then it returns\n *  { bar: baz, foo: zaz/zoo }\n *\n * @param {string} rawPathname A raw pathname\n * @return {object}\n */\nexport const grabMatchParams = rawPathname => {\n  const trimmedPathname = cleanPath(rawPathname)\n\n  const pickPaths = matchPaths.map(({ path, matchPath }) => {\n    return {\n      path: matchPath,\n      originalPath: path,\n    }\n  })\n\n  const path = pick(pickPaths, trimmedPathname)\n\n  if (path) {\n    return path.params\n  }\n\n  return {}\n}\n\n// Given a raw URL path, returns the cleaned version of it (trim off\n// `#` and query params), or if it matches an entry in\n// `match-paths.json`, its matched path is returned\n//\n// E.g. `/foo?bar=far` => `/foo`\n//\n// Or if `match-paths.json` contains `{ \"/foo*\": \"/page1\", ...}`, then\n// `/foo?bar=far` => `/page1`\nexport const findPath = rawPathname => {\n  const trimmedPathname = trimPathname(absolutify(rawPathname))\n  if (pathCache.has(trimmedPathname)) {\n    return pathCache.get(trimmedPathname)\n  }\n\n  const redirect = maybeGetBrowserRedirect(rawPathname)\n  if (redirect) {\n    return findPath(redirect.toPath)\n  }\n\n  let foundPath = findMatchPath(trimmedPathname)\n\n  if (!foundPath) {\n    foundPath = cleanPath(rawPathname)\n  }\n\n  pathCache.set(trimmedPathname, foundPath)\n\n  return foundPath\n}\n\n/**\n * Clean a url and converts /index.html => /\n * E.g. `/foo?bar=far` => `/foo`\n *\n * @param {string} rawPathname A raw pathname\n * @return {string}\n */\nexport const cleanPath = rawPathname => {\n  const trimmedPathname = trimPathname(absolutify(rawPathname))\n\n  let foundPath = trimmedPathname\n  if (foundPath === `/index.html`) {\n    foundPath = `/`\n  }\n\n  foundPath = normalizePagePath(foundPath)\n\n  return foundPath\n}\n"],"mappings":"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"}