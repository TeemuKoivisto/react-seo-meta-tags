{"version":3,"file":"path.js","names":["withBasePath","basePath","paths","joinPath","withTrailingSlash","posixJoinWithLeadingSlash","path","posix","join","map","segment","index","getCommonDir","path1","path2","path1Segments","split","path2Segments","i","length","toLowerCase","joined","slice","MAX_PATH_SEGMENT_CHARS","MAX_PATH_SEGMENT_BYTES","SLICING_INDEX","pathSegmentRe","isMacOs","process","platform","isWindows","isNameTooLong","Buffer","from","tooLongSegmentsInPath","invalidFilenames","push","truncatePath","replace","match","createContentDigest"],"sources":["../../src/utils/path.ts"],"sourcesContent":["import path from \"path\"\nimport { joinPath, createContentDigest } from \"gatsby-core-utils\"\n\nexport const withBasePath =\n  (basePath: string) =>\n  (...paths: Array<string>): string =>\n    joinPath(basePath, ...paths)\n\nexport const withTrailingSlash = (basePath: string): string => `${basePath}/`\n\nconst posixJoinWithLeadingSlash = (paths: Array<string>): string =>\n  path.posix.join(\n    ...paths.map((segment, index) =>\n      segment === `` && index === 0 ? `/` : segment\n    )\n  )\n\nexport const getCommonDir = (path1: string, path2: string): string => {\n  const path1Segments = path1.split(/[/\\\\]/)\n  const path2Segments = path2.split(/[/\\\\]/)\n\n  for (let i = 0; i < path1Segments.length; i++) {\n    if (i >= path2Segments.length) {\n      return posixJoinWithLeadingSlash(path2Segments)\n    } else if (\n      path1Segments[i].toLowerCase() !== path2Segments[i].toLowerCase()\n    ) {\n      const joined = path1Segments.slice(0, i)\n      return posixJoinWithLeadingSlash(joined)\n    }\n  }\n\n  return posixJoinWithLeadingSlash(path1Segments)\n}\n\n// MacOS (APFS) and Windows (NTFS) filename length limit = 255 chars, Others = 255 bytes\nconst MAX_PATH_SEGMENT_CHARS = 255\nconst MAX_PATH_SEGMENT_BYTES = 255\nconst SLICING_INDEX = 50\nconst pathSegmentRe = /[^/]+/g\n\nconst isMacOs = process.platform === `darwin`\nconst isWindows = process.platform === `win32`\n\nconst isNameTooLong = (segment: string): boolean =>\n  isMacOs || isWindows\n    ? segment.length > MAX_PATH_SEGMENT_CHARS // MacOS (APFS) and Windows (NTFS) filename length limit (255 chars)\n    : Buffer.from(segment).length > MAX_PATH_SEGMENT_BYTES // Other (255 bytes)\n\nexport const tooLongSegmentsInPath = (path: string): Array<string> => {\n  const invalidFilenames: Array<string> = []\n  for (const segment of path.split(`/`)) {\n    if (isNameTooLong(segment)) {\n      invalidFilenames.push(segment)\n    }\n  }\n  return invalidFilenames\n}\n\nexport const truncatePath = (path: string): string =>\n  path.replace(pathSegmentRe, match => {\n    if (isNameTooLong(match)) {\n      return (\n        match.slice(0, SLICING_INDEX) +\n        createContentDigest(match.slice(SLICING_INDEX))\n      )\n    }\n    return match\n  })\n"],"mappings":";;;;;AAAA;AACA;AAEO,MAAMA,YAAY,GACtBC,QAAgB,IACjB,CAAC,GAAGC,KAAoB,KACtB,IAAAC,yBAAQ,EAACF,QAAQ,EAAE,GAAGC,KAAK,CAAC;AAAA;AAEzB,MAAME,iBAAiB,GAAIH,QAAgB,IAAc,GAAEA,QAAS,GAAE;AAAA;AAE7E,MAAMI,yBAAyB,GAAIH,KAAoB,IACrDI,aAAI,CAACC,KAAK,CAACC,IAAI,CACb,GAAGN,KAAK,CAACO,GAAG,CAAC,CAACC,OAAO,EAAEC,KAAK,KAC1BD,OAAO,KAAM,EAAC,IAAIC,KAAK,KAAK,CAAC,GAAI,GAAE,GAAGD,OAAO,CAC9C,CACF;AAEI,MAAME,YAAY,GAAG,CAACC,KAAa,EAAEC,KAAa,KAAa;EACpE,MAAMC,aAAa,GAAGF,KAAK,CAACG,KAAK,CAAC,OAAO,CAAC;EAC1C,MAAMC,aAAa,GAAGH,KAAK,CAACE,KAAK,CAAC,OAAO,CAAC;EAE1C,KAAK,IAAIE,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGH,aAAa,CAACI,MAAM,EAAED,CAAC,EAAE,EAAE;IAC7C,IAAIA,CAAC,IAAID,aAAa,CAACE,MAAM,EAAE;MAC7B,OAAOd,yBAAyB,CAACY,aAAa,CAAC;IACjD,CAAC,MAAM,IACLF,aAAa,CAACG,CAAC,CAAC,CAACE,WAAW,EAAE,KAAKH,aAAa,CAACC,CAAC,CAAC,CAACE,WAAW,EAAE,EACjE;MACA,MAAMC,MAAM,GAAGN,aAAa,CAACO,KAAK,CAAC,CAAC,EAAEJ,CAAC,CAAC;MACxC,OAAOb,yBAAyB,CAACgB,MAAM,CAAC;IAC1C;EACF;EAEA,OAAOhB,yBAAyB,CAACU,aAAa,CAAC;AACjD,CAAC;;AAED;AAAA;AACA,MAAMQ,sBAAsB,GAAG,GAAG;AAClC,MAAMC,sBAAsB,GAAG,GAAG;AAClC,MAAMC,aAAa,GAAG,EAAE;AACxB,MAAMC,aAAa,GAAG,QAAQ;AAE9B,MAAMC,OAAO,GAAGC,OAAO,CAACC,QAAQ,KAAM,QAAO;AAC7C,MAAMC,SAAS,GAAGF,OAAO,CAACC,QAAQ,KAAM,OAAM;AAE9C,MAAME,aAAa,GAAIrB,OAAe,IACpCiB,OAAO,IAAIG,SAAS,GAChBpB,OAAO,CAACS,MAAM,GAAGI,sBAAsB,CAAC;AAAA,EACxCS,MAAM,CAACC,IAAI,CAACvB,OAAO,CAAC,CAACS,MAAM,GAAGK,sBAAsB,EAAC;;AAEpD,MAAMU,qBAAqB,GAAI5B,IAAY,IAAoB;EACpE,MAAM6B,gBAA+B,GAAG,EAAE;EAC1C,KAAK,MAAMzB,OAAO,IAAIJ,IAAI,CAACU,KAAK,CAAE,GAAE,CAAC,EAAE;IACrC,IAAIe,aAAa,CAACrB,OAAO,CAAC,EAAE;MAC1ByB,gBAAgB,CAACC,IAAI,CAAC1B,OAAO,CAAC;IAChC;EACF;EACA,OAAOyB,gBAAgB;AACzB,CAAC;AAAA;AAEM,MAAME,YAAY,GAAI/B,IAAY,IACvCA,IAAI,CAACgC,OAAO,CAACZ,aAAa,EAAEa,KAAK,IAAI;EACnC,IAAIR,aAAa,CAACQ,KAAK,CAAC,EAAE;IACxB,OACEA,KAAK,CAACjB,KAAK,CAAC,CAAC,EAAEG,aAAa,CAAC,GAC7B,IAAAe,oCAAmB,EAACD,KAAK,CAACjB,KAAK,CAACG,aAAa,CAAC,CAAC;EAEnD;EACA,OAAOc,KAAK;AACd,CAAC,CAAC;AAAA"}