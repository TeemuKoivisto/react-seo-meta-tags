{"version":3,"file":"get-server-data.js","names":["getServerData","req","page","pagePath","mod","ensuredLeadingSlash","startsWith","params","match","matchPath","path","fsRouteParams","context","getServerDataArg","headers","Map","Object","entries","method","url","query","pageContext"],"sources":["../../src/utils/get-server-data.ts"],"sourcesContent":["import type { Request } from \"express\"\nimport type { IGatsbyPage } from \"../redux/types\"\nimport { match } from \"@gatsbyjs/reach-router\"\n\nexport interface IServerData {\n  headers?: Record<string, string>\n  props?: Record<string, unknown>\n  status?: number\n}\n\ninterface IModuleWithServerData {\n  getServerData?: (args: {\n    headers: Map<string, unknown>\n    method: string\n    url: string\n    query?: Record<string, unknown>\n    params?: Record<string, unknown>\n    pageContext: Record<string, unknown>\n  }) => Promise<IServerData>\n}\n\nexport async function getServerData(\n  req:\n    | Partial<Pick<Request, \"query\" | \"method\" | \"url\" | \"headers\">>\n    | undefined,\n  page: IGatsbyPage,\n  pagePath: string,\n  mod: IModuleWithServerData | undefined\n): Promise<IServerData> {\n  if (!mod?.getServerData) {\n    return {}\n  }\n\n  const ensuredLeadingSlash = pagePath.startsWith(`/`)\n    ? pagePath\n    : `/${pagePath}`\n\n  const { params } = match(page.matchPath || page.path, ensuredLeadingSlash)\n  const fsRouteParams =\n    typeof page.context[`__params`] === `object` ? page.context[`__params`] : {}\n\n  const getServerDataArg = {\n    headers: new Map(Object.entries(req?.headers ?? {})),\n    method: req?.method ?? `GET`,\n    url: req?.url ?? `\"req\" most likely wasn't passed in`,\n    query: req?.query ?? {},\n    pageContext: page.context,\n    params: {\n      ...params,\n      ...fsRouteParams,\n    },\n  }\n\n  return mod.getServerData(getServerDataArg)\n}\n"],"mappings":";;;;AAEA;AAmBO,eAAeA,aAAa,CACjCC,GAEa,EACbC,IAAiB,EACjBC,QAAgB,EAChBC,GAAsC,EAChB;EAAA;EACtB,IAAI,EAACA,GAAG,aAAHA,GAAG,eAAHA,GAAG,CAAEJ,aAAa,GAAE;IACvB,OAAO,CAAC,CAAC;EACX;EAEA,MAAMK,mBAAmB,GAAGF,QAAQ,CAACG,UAAU,CAAE,GAAE,CAAC,GAChDH,QAAQ,GACP,IAAGA,QAAS,EAAC;EAElB,MAAM;IAAEI;EAAO,CAAC,GAAG,IAAAC,kBAAK,EAACN,IAAI,CAACO,SAAS,IAAIP,IAAI,CAACQ,IAAI,EAAEL,mBAAmB,CAAC;EAC1E,MAAMM,aAAa,GACjB,OAAOT,IAAI,CAACU,OAAO,CAAE,UAAS,CAAC,KAAM,QAAO,GAAGV,IAAI,CAACU,OAAO,CAAE,UAAS,CAAC,GAAG,CAAC,CAAC;EAE9E,MAAMC,gBAAgB,GAAG;IACvBC,OAAO,EAAE,IAAIC,GAAG,CAACC,MAAM,CAACC,OAAO,iBAAChB,GAAG,aAAHA,GAAG,uBAAHA,GAAG,CAAEa,OAAO,uDAAI,CAAC,CAAC,CAAC,CAAC;IACpDI,MAAM,iBAAEjB,GAAG,aAAHA,GAAG,uBAAHA,GAAG,CAAEiB,MAAM,qDAAK,KAAI;IAC5BC,GAAG,cAAElB,GAAG,aAAHA,GAAG,uBAAHA,GAAG,CAAEkB,GAAG,+CAAK,oCAAmC;IACrDC,KAAK,gBAAEnB,GAAG,aAAHA,GAAG,uBAAHA,GAAG,CAAEmB,KAAK,mDAAI,CAAC,CAAC;IACvBC,WAAW,EAAEnB,IAAI,CAACU,OAAO;IACzBL,MAAM,EAAE;MACN,GAAGA,MAAM;MACT,GAAGI;IACL;EACF,CAAC;EAED,OAAOP,GAAG,CAACJ,aAAa,CAACa,gBAAgB,CAAC;AAC5C"}