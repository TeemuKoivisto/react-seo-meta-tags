{"version":3,"file":"navigation.js","names":["maybeRedirect","pathname","redirect","maybeGetBrowserRedirect","hash","search","window","location","___replace","toPath","nextRoute","addEventListener","event","test","reason","onPreRouteUpdate","prevLocation","apiRunner","onRouteUpdate","process","env","GATSBY_QUERY_ON_DEMAND","GATSBY_QUERY_ON_DEMAND_LOADING_INDICATOR","emitter","emit","navigate","to","options","globalHistory","parsePath","___swUpdated","timeoutId","setTimeout","loader","loadPage","then","pageResources","status","PageResourceStatus","Error","history","replaceState","href","clearTimeout","NODE_ENV","page","webpackCompilationHash","___webpackCompilationHash","navigator","serviceWorker","controller","state","postMessage","gatsbyApi","reachNavigate","shouldUpdateScroll","prevRouterProps","results","routerProps","getSavedScrollPosition","args","_stateStorage","read","key","length","oldPathname","decodeURI","slice","init","listen","action","___push","replace","___navigate","RouteAnnouncer","React","Component","constructor","props","announcementRef","createRef","componentDidUpdate","prevProps","nextProps","requestAnimationFrame","pageName","document","title","pageHeadings","querySelectorAll","textContent","newAnnouncement","current","oldAnnouncement","innerText","render","RouteAnnouncerProps","compareLocationProps","nextLocation","RouteUpdates","componentDidMount","shouldComponentUpdate","children","propTypes","PropTypes","object","isRequired"],"sources":["../navigation.js"],"sourcesContent":["import React from \"react\"\nimport PropTypes from \"prop-types\"\nimport loader, { PageResourceStatus } from \"./loader\"\nimport { maybeGetBrowserRedirect } from \"./redirect-utils.js\"\nimport { apiRunner } from \"./api-runner-browser\"\nimport emitter from \"./emitter\"\nimport { RouteAnnouncerProps } from \"./route-announcer-props\"\nimport {\n  navigate as reachNavigate,\n  globalHistory,\n} from \"@gatsbyjs/reach-router\"\nimport { parsePath } from \"gatsby-link\"\n\nfunction maybeRedirect(pathname) {\n  const redirect = maybeGetBrowserRedirect(pathname)\n  const { hash, search } = window.location\n\n  if (redirect != null) {\n    window.___replace(redirect.toPath + search + hash)\n    return true\n  } else {\n    return false\n  }\n}\n\n// Catch unhandled chunk loading errors and force a restart of the app.\nlet nextRoute = ``\n\nwindow.addEventListener(`unhandledrejection`, event => {\n  if (/loading chunk \\d* failed./i.test(event.reason)) {\n    if (nextRoute) {\n      window.location.pathname = nextRoute\n    }\n  }\n})\n\nconst onPreRouteUpdate = (location, prevLocation) => {\n  if (!maybeRedirect(location.pathname)) {\n    nextRoute = location.pathname\n    apiRunner(`onPreRouteUpdate`, { location, prevLocation })\n  }\n}\n\nconst onRouteUpdate = (location, prevLocation) => {\n  if (!maybeRedirect(location.pathname)) {\n    apiRunner(`onRouteUpdate`, { location, prevLocation })\n    if (\n      process.env.GATSBY_QUERY_ON_DEMAND &&\n      process.env.GATSBY_QUERY_ON_DEMAND_LOADING_INDICATOR === `true`\n    ) {\n      emitter.emit(`onRouteUpdate`, { location, prevLocation })\n    }\n  }\n}\n\nconst navigate = (to, options = {}) => {\n  // Support forward/backward navigation with numbers\n  // navigate(-2) (jumps back 2 history steps)\n  // navigate(2)  (jumps forward 2 history steps)\n  if (typeof to === `number`) {\n    globalHistory.navigate(to)\n    return\n  }\n\n  const { pathname, search, hash } = parsePath(to)\n  const redirect = maybeGetBrowserRedirect(pathname)\n\n  // If we're redirecting, just replace the passed in pathname\n  // to the one we want to redirect to.\n  if (redirect) {\n    to = redirect.toPath + search + hash\n  }\n\n  // If we had a service worker update, no matter the path, reload window and\n  // reset the pathname whitelist\n  if (window.___swUpdated) {\n    window.location = pathname + search + hash\n    return\n  }\n\n  // Start a timer to wait for a second before transitioning and showing a\n  // loader in case resources aren't around yet.\n  const timeoutId = setTimeout(() => {\n    emitter.emit(`onDelayedLoadPageResources`, { pathname })\n    apiRunner(`onRouteUpdateDelayed`, {\n      location: window.location,\n    })\n  }, 1000)\n\n  loader.loadPage(pathname + search).then(pageResources => {\n    // If no page resources, then refresh the page\n    // Do this, rather than simply `window.location.reload()`, so that\n    // pressing the back/forward buttons work - otherwise when pressing\n    // back, the browser will just change the URL and expect JS to handle\n    // the change, which won't always work since it might not be a Gatsby\n    // page.\n    if (!pageResources || pageResources.status === PageResourceStatus.Error) {\n      window.history.replaceState({}, ``, location.href)\n      window.location = pathname\n      clearTimeout(timeoutId)\n      return\n    }\n\n    // If the loaded page has a different compilation hash to the\n    // window, then a rebuild has occurred on the server. Reload.\n    if (process.env.NODE_ENV === `production` && pageResources) {\n      if (\n        pageResources.page.webpackCompilationHash !==\n        window.___webpackCompilationHash\n      ) {\n        // Purge plugin-offline cache\n        if (\n          `serviceWorker` in navigator &&\n          navigator.serviceWorker.controller !== null &&\n          navigator.serviceWorker.controller.state === `activated`\n        ) {\n          navigator.serviceWorker.controller.postMessage({\n            gatsbyApi: `clearPathResources`,\n          })\n        }\n\n        window.location = pathname + search + hash\n      }\n    }\n    reachNavigate(to, options)\n    clearTimeout(timeoutId)\n  })\n}\n\nfunction shouldUpdateScroll(prevRouterProps, { location }) {\n  const { pathname, hash } = location\n  const results = apiRunner(`shouldUpdateScroll`, {\n    prevRouterProps,\n    // `pathname` for backwards compatibility\n    pathname,\n    routerProps: { location },\n    getSavedScrollPosition: args => [\n      0,\n      // FIXME this is actually a big code smell, we should fix this\n      // eslint-disable-next-line @babel/no-invalid-this\n      this._stateStorage.read(args, args.key),\n    ],\n  })\n  if (results.length > 0) {\n    // Use the latest registered shouldUpdateScroll result, this allows users to override plugin's configuration\n    // @see https://github.com/gatsbyjs/gatsby/issues/12038\n    return results[results.length - 1]\n  }\n\n  if (prevRouterProps) {\n    const {\n      location: { pathname: oldPathname },\n    } = prevRouterProps\n    if (oldPathname === pathname) {\n      // Scroll to element if it exists, if it doesn't, or no hash is provided,\n      // scroll to top.\n      return hash ? decodeURI(hash.slice(1)) : [0, 0]\n    }\n  }\n  return true\n}\n\nfunction init() {\n  // The \"scroll-behavior\" package expects the \"action\" to be on the location\n  // object so let's copy it over.\n  globalHistory.listen(args => {\n    args.location.action = args.action\n  })\n\n  window.___push = to => navigate(to, { replace: false })\n  window.___replace = to => navigate(to, { replace: true })\n  window.___navigate = (to, options) => navigate(to, options)\n}\n\nclass RouteAnnouncer extends React.Component {\n  constructor(props) {\n    super(props)\n    this.announcementRef = React.createRef()\n  }\n\n  componentDidUpdate(prevProps, nextProps) {\n    requestAnimationFrame(() => {\n      let pageName = `new page at ${this.props.location.pathname}`\n      if (document.title) {\n        pageName = document.title\n      }\n      const pageHeadings = document.querySelectorAll(`#gatsby-focus-wrapper h1`)\n      if (pageHeadings && pageHeadings.length) {\n        pageName = pageHeadings[0].textContent\n      }\n      const newAnnouncement = `Navigated to ${pageName}`\n      if (this.announcementRef.current) {\n        const oldAnnouncement = this.announcementRef.current.innerText\n        if (oldAnnouncement !== newAnnouncement) {\n          this.announcementRef.current.innerText = newAnnouncement\n        }\n      }\n    })\n  }\n\n  render() {\n    return <div {...RouteAnnouncerProps} ref={this.announcementRef}></div>\n  }\n}\n\nconst compareLocationProps = (prevLocation, nextLocation) => {\n  if (prevLocation.href !== nextLocation.href) {\n    return true\n  }\n\n  if (prevLocation?.state?.key !== nextLocation?.state?.key) {\n    return true\n  }\n\n  return false\n}\n\n// Fire on(Pre)RouteUpdate APIs\nclass RouteUpdates extends React.Component {\n  constructor(props) {\n    super(props)\n    onPreRouteUpdate(props.location, null)\n  }\n\n  componentDidMount() {\n    onRouteUpdate(this.props.location, null)\n  }\n\n  shouldComponentUpdate(prevProps) {\n    if (compareLocationProps(prevProps.location, this.props.location)) {\n      onPreRouteUpdate(this.props.location, prevProps.location)\n      return true\n    }\n    return false\n  }\n\n  componentDidUpdate(prevProps) {\n    if (compareLocationProps(prevProps.location, this.props.location)) {\n      onRouteUpdate(this.props.location, prevProps.location)\n    }\n  }\n\n  render() {\n    return (\n      <React.Fragment>\n        {this.props.children}\n        <RouteAnnouncer location={location} />\n      </React.Fragment>\n    )\n  }\n}\n\nRouteUpdates.propTypes = {\n  location: PropTypes.object.isRequired,\n}\n\nexport { init, shouldUpdateScroll, RouteUpdates, maybeGetBrowserRedirect }\n"],"mappings":"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"}