{"version":3,"file":"wait-until-jobs-complete.js","names":["waitJobsV1","Promise","resolve","onEndJob","store","getState","jobs","active","length","emitter","off","on","waitUntilAllJobsComplete","all","waitUntilAllJobsV2Complete","then","waitJobsByRequest","requestId","jobsV2","jobDigests","Set","jobsByRequest","get","waitJobsV2"],"sources":["../../src/utils/wait-until-jobs-complete.ts"],"sourcesContent":["import { emitter, store } from \"../redux\"\n\nimport {\n  waitJobs as waitJobsV2,\n  waitUntilAllJobsComplete as waitUntilAllJobsV2Complete,\n} from \"./jobs/manager\"\n\nasync function waitJobsV1(): Promise<void> {\n  return new Promise<void>(resolve => {\n    const onEndJob = (): void => {\n      if (store.getState().jobs.active.length === 0) {\n        resolve()\n        emitter.off(`END_JOB`, onEndJob)\n      }\n    }\n\n    emitter.on(`END_JOB`, onEndJob)\n    onEndJob()\n  })\n}\n\nexport const waitUntilAllJobsComplete = (): Promise<void> =>\n  Promise.all([waitJobsV1(), waitUntilAllJobsV2Complete()]).then()\n\nexport async function waitJobsByRequest(requestId: string): Promise<void> {\n  const jobs = store.getState().jobsV2\n  const jobDigests = new Set([\n    ...(jobs.jobsByRequest.get(requestId) ?? []),\n    ...(jobs.jobsByRequest.get(``) ?? []), // wait for jobs without requestId just in case\n  ])\n  await Promise.all([waitJobsV1(), waitJobsV2(jobDigests)])\n}\n"],"mappings":";;;;;AAAA;AAEA;AAKA,eAAeA,UAAU,GAAkB;EACzC,OAAO,IAAIC,OAAO,CAAOC,OAAO,IAAI;IAClC,MAAMC,QAAQ,GAAG,MAAY;MAC3B,IAAIC,YAAK,CAACC,QAAQ,EAAE,CAACC,IAAI,CAACC,MAAM,CAACC,MAAM,KAAK,CAAC,EAAE;QAC7CN,OAAO,EAAE;QACTO,cAAO,CAACC,GAAG,CAAE,SAAQ,EAAEP,QAAQ,CAAC;MAClC;IACF,CAAC;IAEDM,cAAO,CAACE,EAAE,CAAE,SAAQ,EAAER,QAAQ,CAAC;IAC/BA,QAAQ,EAAE;EACZ,CAAC,CAAC;AACJ;AAEO,MAAMS,wBAAwB,GAAG,MACtCX,OAAO,CAACY,GAAG,CAAC,CAACb,UAAU,EAAE,EAAE,IAAAc,iCAA0B,GAAE,CAAC,CAAC,CAACC,IAAI,EAAE;AAAA;AAE3D,eAAeC,iBAAiB,CAACC,SAAiB,EAAiB;EAAA;EACxE,MAAMX,IAAI,GAAGF,YAAK,CAACC,QAAQ,EAAE,CAACa,MAAM;EACpC,MAAMC,UAAU,GAAG,IAAIC,GAAG,CAAC,CACzB,6BAAId,IAAI,CAACe,aAAa,CAACC,GAAG,CAACL,SAAS,CAAC,yEAAI,EAAE,CAAC,EAC5C,8BAAIX,IAAI,CAACe,aAAa,CAACC,GAAG,CAAE,EAAC,CAAC,2EAAI,EAAE,CAAC,CAAE;EAAA,CACxC,CAAC;;EACF,MAAMrB,OAAO,CAACY,GAAG,CAAC,CAACb,UAAU,EAAE,EAAE,IAAAuB,iBAAU,EAACJ,UAAU,CAAC,CAAC,CAAC;AAC3D"}