{"version":3,"file":"socketIo.js","names":["socket","socketIo","process","env","NODE_ENV","io","transports","GATSBY_SOCKET_IO_DEFAULT_TRANSPORT","on","opts","msg","type","payload","message","reportError","id","clearError","___emitter","emit","console","warn","err","error","registerPath","path","unregisterPath"],"sources":["../socketIo.js"],"sourcesContent":["import io from \"socket.io-client\"\nimport { reportError, clearError } from \"./error-overlay-handler\"\nlet socket = null\n\nexport default function socketIo() {\n  if (process.env.NODE_ENV !== `production`) {\n    if (!socket) {\n      // Try to initialize web socket if we didn't do it already\n      try {\n        // force websocket as transport\n        socket = io({\n          transports: [process.env.GATSBY_SOCKET_IO_DEFAULT_TRANSPORT],\n        })\n\n        // when websocket fails, we'll try polling\n        socket.on(`reconnect_attempt`, () => {\n          socket.io.opts.transports = [`polling`, `websocket`]\n        })\n\n        socket.on(`message`, msg => {\n          if (msg.type === `overlayError`) {\n            if (msg.payload.message) {\n              reportError(msg.payload.id, msg.payload.message)\n            } else {\n              clearError(msg.payload.id)\n            }\n            ___emitter.emit(msg.type, msg.payload)\n          }\n        })\n\n        // Prevents certain browsers spamming XHR 'ERR_CONNECTION_REFUSED'\n        // errors within the console, such as when exiting the develop process.\n        socket.on(`disconnect`, () => {\n          console.warn(`[socket.io] Disconnected from dev server.`)\n        })\n      } catch (err) {\n        console.error(`Could not connect to socket.io on dev server.`)\n      }\n    }\n    return socket\n  } else {\n    return null\n  }\n}\n\n// Tell websocket-manager.js the new path we're on.\n// This will help the backend prioritize queries for this\n// path.\nfunction registerPath(path) {\n  socket.emit(`registerPath`, path)\n}\n\n// Unregister the former path\nfunction unregisterPath(path) {\n  socket.emit(`unregisterPath`, path)\n}\n\nexport { registerPath, unregisterPath }\n"],"mappings":";;;;;;;AAAA;AACA;AACA,IAAIA,MAAM,GAAG,IAAI;AAEF,SAASC,QAAQ,GAAG;EACjC,IAAIC,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAM,YAAW,EAAE;IACzC,IAAI,CAACJ,MAAM,EAAE;MACX;MACA,IAAI;QACF;QACAA,MAAM,GAAG,IAAAK,eAAE,EAAC;UACVC,UAAU,EAAE,CAACJ,OAAO,CAACC,GAAG,CAACI,kCAAkC;QAC7D,CAAC,CAAC;;QAEF;QACAP,MAAM,CAACQ,EAAE,CAAE,mBAAkB,EAAE,MAAM;UACnCR,MAAM,CAACK,EAAE,CAACI,IAAI,CAACH,UAAU,GAAG,CAAE,SAAQ,EAAG,WAAU,CAAC;QACtD,CAAC,CAAC;QAEFN,MAAM,CAACQ,EAAE,CAAE,SAAQ,EAAEE,GAAG,IAAI;UAC1B,IAAIA,GAAG,CAACC,IAAI,KAAM,cAAa,EAAE;YAC/B,IAAID,GAAG,CAACE,OAAO,CAACC,OAAO,EAAE;cACvB,IAAAC,gCAAW,EAACJ,GAAG,CAACE,OAAO,CAACG,EAAE,EAAEL,GAAG,CAACE,OAAO,CAACC,OAAO,CAAC;YAClD,CAAC,MAAM;cACL,IAAAG,+BAAU,EAACN,GAAG,CAACE,OAAO,CAACG,EAAE,CAAC;YAC5B;YACAE,UAAU,CAACC,IAAI,CAACR,GAAG,CAACC,IAAI,EAAED,GAAG,CAACE,OAAO,CAAC;UACxC;QACF,CAAC,CAAC;;QAEF;QACA;QACAZ,MAAM,CAACQ,EAAE,CAAE,YAAW,EAAE,MAAM;UAC5BW,OAAO,CAACC,IAAI,CAAE,2CAA0C,CAAC;QAC3D,CAAC,CAAC;MACJ,CAAC,CAAC,OAAOC,GAAG,EAAE;QACZF,OAAO,CAACG,KAAK,CAAE,+CAA8C,CAAC;MAChE;IACF;IACA,OAAOtB,MAAM;EACf,CAAC,MAAM;IACL,OAAO,IAAI;EACb;AACF;;AAEA;AACA;AACA;AACA,SAASuB,YAAY,CAACC,IAAI,EAAE;EAC1BxB,MAAM,CAACkB,IAAI,CAAE,cAAa,EAAEM,IAAI,CAAC;AACnC;;AAEA;AACA,SAASC,cAAc,CAACD,IAAI,EAAE;EAC5BxB,MAAM,CAACkB,IAAI,CAAE,gBAAe,EAAEM,IAAI,CAAC;AACrC"}