{"version":3,"file":"babel-plugin-add-slice-placeholder-location.js","names":["addSlicePlaceholderLocation","types","t","name","visitor","JSXOpeningElement","nodePath","get","referencesImport","file","opts","filename","__renderedByLocationProperties","objectProperty","identifier","stringLiteral","relative","store","getState","program","directory","node","loc","start","line","push","numericLiteral","column","end","newProp","jsxAttribute","jsxIdentifier","jsxExpressionContainer","objectExpression","attributes"],"sources":["../../../src/utils/babel/babel-plugin-add-slice-placeholder-location.ts"],"sourcesContent":["import { relative } from \"path\"\nimport type { PluginObj, types as BabelTypes, PluginPass } from \"@babel/core\"\nimport { ObjectProperty } from \"@babel/types\"\nimport { store } from \"../../redux\"\n\n/**\n * This is a plugin that finds Slice placeholder components and injects the __renderedByLocation prop\n * with filename and location in the file where the placeholder was found. This is later used to provide\n * more useful error messages when the user props are invalid showing codeframe where user tries to render it\n * instead of codeframe of the Slice component itself (internals of gatsby) that is not useful for the user.\n */\n\nexport default function addSlicePlaceholderLocation(\n  this: PluginPass,\n  {\n    types: t,\n  }: {\n    types: typeof BabelTypes\n  }\n): PluginObj {\n  return {\n    name: `babel-plugin-add-slice-placeholder-location`,\n    visitor: {\n      JSXOpeningElement(nodePath): void {\n        if (!nodePath.get(`name`).referencesImport(`gatsby`, `Slice`)) {\n          return\n        }\n\n        if (this.file.opts.filename) {\n          const __renderedByLocationProperties: Array<ObjectProperty> = [\n            t.objectProperty(\n              t.identifier(`fileName`),\n              t.stringLiteral(\n                relative(\n                  store.getState().program.directory,\n                  this.file.opts.filename\n                )\n              )\n            ),\n          ]\n\n          if (nodePath.node.loc?.start.line) {\n            __renderedByLocationProperties.push(\n              t.objectProperty(\n                t.identifier(`lineNumber`),\n                t.numericLiteral(nodePath.node.loc.start.line)\n              )\n            )\n\n            if (nodePath.node.loc?.start.column) {\n              __renderedByLocationProperties.push(\n                t.objectProperty(\n                  t.identifier(`columnNumber`),\n                  t.numericLiteral(nodePath.node.loc.start.column + 1)\n                )\n              )\n            }\n\n            if (nodePath.node.loc?.end.line) {\n              __renderedByLocationProperties.push(\n                t.objectProperty(\n                  t.identifier(`endLineNumber`),\n                  t.numericLiteral(nodePath.node.loc.end.line)\n                )\n              )\n\n              if (nodePath.node.loc?.end.column) {\n                __renderedByLocationProperties.push(\n                  t.objectProperty(\n                    t.identifier(`endColumnNumber`),\n                    t.numericLiteral(nodePath.node.loc.end.column + 1)\n                  )\n                )\n              }\n            }\n          }\n\n          const newProp = t.jsxAttribute(\n            t.jsxIdentifier(`__renderedByLocation`),\n            t.jsxExpressionContainer(\n              t.objectExpression(__renderedByLocationProperties)\n            )\n          )\n\n          nodePath.node.attributes.push(newProp)\n        }\n      },\n    },\n  }\n}\n"],"mappings":";;;;AAAA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEe,SAASA,2BAA2B,CAEjD;EACEC,KAAK,EAAEC;AAGT,CAAC,EACU;EACX,OAAO;IACLC,IAAI,EAAG,6CAA4C;IACnDC,OAAO,EAAE;MACPC,iBAAiB,CAACC,QAAQ,EAAQ;QAChC,IAAI,CAACA,QAAQ,CAACC,GAAG,CAAE,MAAK,CAAC,CAACC,gBAAgB,CAAE,QAAO,EAAG,OAAM,CAAC,EAAE;UAC7D;QACF;QAEA,IAAI,IAAI,CAACC,IAAI,CAACC,IAAI,CAACC,QAAQ,EAAE;UAAA;UAC3B,MAAMC,8BAAqD,GAAG,CAC5DV,CAAC,CAACW,cAAc,CACdX,CAAC,CAACY,UAAU,CAAE,UAAS,CAAC,EACxBZ,CAAC,CAACa,aAAa,CACb,IAAAC,cAAQ,EACNC,YAAK,CAACC,QAAQ,EAAE,CAACC,OAAO,CAACC,SAAS,EAClC,IAAI,CAACX,IAAI,CAACC,IAAI,CAACC,QAAQ,CACxB,CACF,CACF,CACF;UAED,0BAAIL,QAAQ,CAACe,IAAI,CAACC,GAAG,+CAAjB,mBAAmBC,KAAK,CAACC,IAAI,EAAE;YAAA;YACjCZ,8BAA8B,CAACa,IAAI,CACjCvB,CAAC,CAACW,cAAc,CACdX,CAAC,CAACY,UAAU,CAAE,YAAW,CAAC,EAC1BZ,CAAC,CAACwB,cAAc,CAACpB,QAAQ,CAACe,IAAI,CAACC,GAAG,CAACC,KAAK,CAACC,IAAI,CAAC,CAC/C,CACF;YAED,2BAAIlB,QAAQ,CAACe,IAAI,CAACC,GAAG,gDAAjB,oBAAmBC,KAAK,CAACI,MAAM,EAAE;cACnCf,8BAA8B,CAACa,IAAI,CACjCvB,CAAC,CAACW,cAAc,CACdX,CAAC,CAACY,UAAU,CAAE,cAAa,CAAC,EAC5BZ,CAAC,CAACwB,cAAc,CAACpB,QAAQ,CAACe,IAAI,CAACC,GAAG,CAACC,KAAK,CAACI,MAAM,GAAG,CAAC,CAAC,CACrD,CACF;YACH;YAEA,2BAAIrB,QAAQ,CAACe,IAAI,CAACC,GAAG,gDAAjB,oBAAmBM,GAAG,CAACJ,IAAI,EAAE;cAAA;cAC/BZ,8BAA8B,CAACa,IAAI,CACjCvB,CAAC,CAACW,cAAc,CACdX,CAAC,CAACY,UAAU,CAAE,eAAc,CAAC,EAC7BZ,CAAC,CAACwB,cAAc,CAACpB,QAAQ,CAACe,IAAI,CAACC,GAAG,CAACM,GAAG,CAACJ,IAAI,CAAC,CAC7C,CACF;cAED,2BAAIlB,QAAQ,CAACe,IAAI,CAACC,GAAG,gDAAjB,oBAAmBM,GAAG,CAACD,MAAM,EAAE;gBACjCf,8BAA8B,CAACa,IAAI,CACjCvB,CAAC,CAACW,cAAc,CACdX,CAAC,CAACY,UAAU,CAAE,iBAAgB,CAAC,EAC/BZ,CAAC,CAACwB,cAAc,CAACpB,QAAQ,CAACe,IAAI,CAACC,GAAG,CAACM,GAAG,CAACD,MAAM,GAAG,CAAC,CAAC,CACnD,CACF;cACH;YACF;UACF;UAEA,MAAME,OAAO,GAAG3B,CAAC,CAAC4B,YAAY,CAC5B5B,CAAC,CAAC6B,aAAa,CAAE,sBAAqB,CAAC,EACvC7B,CAAC,CAAC8B,sBAAsB,CACtB9B,CAAC,CAAC+B,gBAAgB,CAACrB,8BAA8B,CAAC,CACnD,CACF;UAEDN,QAAQ,CAACe,IAAI,CAACa,UAAU,CAACT,IAAI,CAACI,OAAO,CAAC;QACxC;MACF;IACF;EACF,CAAC;AACH"}