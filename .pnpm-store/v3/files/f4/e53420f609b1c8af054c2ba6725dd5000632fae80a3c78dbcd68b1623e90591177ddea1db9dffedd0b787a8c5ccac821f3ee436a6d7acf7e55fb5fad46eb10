/*!
 * hash-wasm (https://www.npmjs.com/package/hash-wasm)
 * (c) Dani Biro
 * @license MIT
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).hashwasm=e.hashwasm||{})}(this,(function(e){"use strict";function t(e,t,A,n){return new(A||(A=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function a(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof A?t:new A((function(e){e(t)}))).then(o,a)}s((n=n.apply(e,t||[])).next())}))}class A{constructor(){this.mutex=Promise.resolve()}lock(){let e=()=>{};return this.mutex=this.mutex.then((()=>new Promise(e))),new Promise((t=>{e=t}))}dispatch(e){return t(this,void 0,void 0,(function*(){const t=yield this.lock();try{return yield Promise.resolve(e())}finally{t()}}))}}var n;const r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,i=null!==(n=r.Buffer)&&void 0!==n?n:null,o=r.TextEncoder?new r.TextEncoder:null;function a(e,t){return(15&e)+(e>>6|e>>3&8)<<4|(15&t)+(t>>6|t>>3&8)}const s="a".charCodeAt(0)-10,f="0".charCodeAt(0);function l(e,t,A){let n=0;for(let r=0;r<A;r++){let A=t[r]>>>4;e[n++]=A>9?A+s:A+f,A=15&t[r],e[n++]=A>9?A+s:A+f}return String.fromCharCode.apply(null,e)}const B=null!==i?e=>{if("string"==typeof e){const t=i.from(e,"utf8");return new Uint8Array(t.buffer,t.byteOffset,t.length)}if(i.isBuffer(e))return new Uint8Array(e.buffer,e.byteOffset,e.length);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Invalid data type!")}:e=>{if("string"==typeof e)return o.encode(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Invalid data type!")},c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",g=new Uint8Array(256);for(let e=0;e<c.length;e++)g[c.charCodeAt(e)]=e;function h(e){const t=function(e){let t=Math.floor(.75*e.length);const A=e.length;return"="===e[A-1]&&(t-=1,"="===e[A-2]&&(t-=1)),t}(e),A=e.length,n=new Uint8Array(t);let r=0;for(let t=0;t<A;t+=4){const A=g[e.charCodeAt(t)],i=g[e.charCodeAt(t+1)],o=g[e.charCodeAt(t+2)],a=g[e.charCodeAt(t+3)];n[r]=A<<2|i>>4,r+=1,n[r]=(15&i)<<4|o>>2,r+=1,n[r]=(3&o)<<6|63&a,r+=1}return n}const I=16384,u=new A,E=new Map;function d(e,A){return t(this,void 0,void 0,(function*(){let n=null,r=null,i=!1;if("undefined"==typeof WebAssembly)throw new Error("WebAssembly is not supported in this environment!");const o=()=>new DataView(n.exports.memory.buffer).getUint32(n.exports.STATE_SIZE,!0),s=u.dispatch((()=>t(this,void 0,void 0,(function*(){if(!E.has(e.name)){const t=h(e.data),A=WebAssembly.compile(t);E.set(e.name,A)}const t=yield E.get(e.name);n=yield WebAssembly.instantiate(t,{})})))),f=(e=null)=>{i=!0,n.exports.Hash_Init(e)},c=e=>{if(!i)throw new Error("update() called before init()");(e=>{let t=0;for(;t<e.length;){const A=e.subarray(t,t+I);t+=A.length,r.set(A),n.exports.Hash_Update(A.length)}})(B(e))},g=new Uint8Array(2*A),d=(e,t=null)=>{if(!i)throw new Error("digest() called before init()");return i=!1,n.exports.Hash_Final(t),"binary"===e?r.slice(0,A):l(g,r,A)},Q=e=>"string"==typeof e?e.length<4096:e.byteLength<I;let y=Q;switch(e.name){case"argon2":case"scrypt":y=()=>!0;break;case"blake2b":case"blake2s":y=(e,t)=>t<=512&&Q(e);break;case"blake3":y=(e,t)=>0===t&&Q(e);break;case"xxhash64":case"xxhash3":case"xxhash128":y=()=>!1}return yield(()=>t(this,void 0,void 0,(function*(){n||(yield s);const e=n.exports.Hash_GetBuffer(),t=n.exports.memory.buffer;r=new Uint8Array(t,e,I)})))(),{getMemory:()=>r,writeMemory:(e,t=0)=>{r.set(e,t)},getExports:()=>n.exports,setMemorySize:e=>{n.exports.Hash_SetMemorySize(e);const t=n.exports.Hash_GetBuffer(),A=n.exports.memory.buffer;r=new Uint8Array(A,t,e)},init:f,update:c,digest:d,save:()=>{if(!i)throw new Error("save() can only be called after init() and before digest()");const t=n.exports.Hash_GetState(),A=o(),r=n.exports.memory.buffer,s=new Uint8Array(r,t,A),f=new Uint8Array(4+A);return function(e,t){const A=t.length>>1;for(let n=0;n<A;n++){const A=n<<1;e[n]=a(t.charCodeAt(A),t.charCodeAt(A+1))}}(f,e.hash),f.set(s,4),f},load:t=>{if(!(t instanceof Uint8Array))throw new Error("load() expects an Uint8Array generated by save()");const A=n.exports.Hash_GetState(),r=o(),s=4+r,f=n.exports.memory.buffer;if(t.length!==s)throw new Error(`Bad state length (expected ${s} bytes, got ${t.length})`);if(!function(e,t){if(e.length!==2*t.length)return!1;for(let A=0;A<t.length;A++){const n=A<<1;if(t[A]!==a(e.charCodeAt(n),e.charCodeAt(n+1)))return!1}return!0}(e.hash,t.subarray(0,4)))throw new Error("This state was written by an incompatible hash implementation");const l=t.subarray(4);new Uint8Array(f,A,r).set(l),i=!0},calculate:(e,t=null,i=null)=>{if(!y(e,t))return f(t),c(e),d("hex",i);const o=B(e);return r.set(o),n.exports.Hash_Calculate(o.length,t,i),l(g,r,A)},hashLength:A}}))}var Q={name:"adler32",data:"AGFzbQEAAAABDANgAAF/YAAAYAF/AAMHBgABAgEAAgQFAXABAQEFBAEBAgIGDgJ/AUGAiQULfwBBgAgLB3AIBm1lbW9yeQIADkhhc2hfR2V0QnVmZmVyAAAJSGFzaF9Jbml0AAELSGFzaF9VcGRhdGUAAgpIYXNoX0ZpbmFsAAMNSGFzaF9HZXRTdGF0ZQAEDkhhc2hfQ2FsY3VsYXRlAAUKU1RBVEVfU0laRQMBCoAIBgUAQYAJCwoAQQBBATYChAgL9gYBBn9BACgChAgiAUH//wNxIQIgAUEQdiEDAkACQCAAQQFHDQAgAkEALQCACWoiAUGPgHxqIAEgAUHw/wNLGyIBIANqIgRBEHQiBUGAgDxqIAUgBEHw/wNLGyABciEBDAELAkACQAJAAkACQCAAQRBJDQBBgAkhBiAAQbArSQ0BQYAJIQYDQEEAIQUDQCAGIAVqIgEoAgAiBEH/AXEgAmoiAiADaiACIARBCHZB/wFxaiICaiACIARBEHZB/wFxaiICaiACIARBGHZqIgJqIAIgAUEEaigCACIEQf8BcWoiAmogAiAEQQh2Qf8BcWoiAmogAiAEQRB2Qf8BcWoiAmogAiAEQRh2aiICaiACIAFBCGooAgAiBEH/AXFqIgJqIAIgBEEIdkH/AXFqIgJqIAIgBEEQdkH/AXFqIgJqIAIgBEEYdmoiBGogBCABQQxqKAIAIgFB/wFxaiIEaiAEIAFBCHZB/wFxaiIEaiAEIAFBEHZB/wFxaiIEaiAEIAFBGHZqIgJqIQMgBUEQaiIFQbArRw0ACyADQfH/A3AhAyACQfH/A3AhAiAGQbAraiEGIABB0FRqIgBBrytLDQALIABFDQQgAEEPSw0BDAILAkAgAEUNAEEAIQEDQCACIAFBgAlqLQAAaiICIANqIQMgACABQQFqIgFHDQALCyACQY+AfGogAiACQfD/A0sbIANB8f8DcEEQdHIhAQwECwNAIAYoAgAiAUH/AXEgAmoiBCADaiAEIAFBCHZB/wFxaiIEaiAEIAFBEHZB/wFxaiIEaiAEIAFBGHZqIgRqIAQgBkEEaigCACIBQf8BcWoiBGogBCABQQh2Qf8BcWoiBGogBCABQRB2Qf8BcWoiBGogBCABQRh2aiIEaiAEIAZBCGooAgAiAUH/AXFqIgRqIAQgAUEIdkH/AXFqIgRqIAQgAUEQdkH/AXFqIgRqIAQgAUEYdmoiBGogBCAGQQxqKAIAIgFB/wFxaiIEaiAEIAFBCHZB/wFxaiIEaiAEIAFBEHZB/wFxaiIEaiAEIAFBGHZqIgJqIQMgBkEQaiEGIABBcGoiAEEPSw0ACyAARQ0BCwNAIAIgBi0AAGoiAiADaiEDIAZBAWohBiAAQX9qIgANAAsLIANB8f8DcCEDIAJB8f8DcCECCyACIANBEHRyIQELQQAgATYChAgLMgEBf0EAQQAoAoQIIgBBGHQgAEEIdEGAgPwHcXIgAEEIdkGA/gNxIABBGHZycjYCgAkLBQBBhAgLPABBAEEBNgKECCAAEAJBAEEAKAKECCIAQRh0IABBCHRBgID8B3FyIABBCHZBgP4DcSAAQRh2cnI2AoAJCwsVAgBBgAgLBAQAAAAAQYQICwQBAAAA",hash:"321174b4"};const y=new A;let w=null;e.adler32=function(e){if(null===w)return function(e,A,n){return t(this,void 0,void 0,(function*(){const t=yield e.lock(),r=yield d(A,n);return t(),r}))}(y,Q,4).then((t=>(w=t,w.calculate(e))));try{const t=w.calculate(e);return Promise.resolve(t)}catch(e){return Promise.reject(e)}},e.createAdler32=function(){return d(Q,4).then((e=>{e.init();const t={init:()=>(e.init(),t),update:A=>(e.update(A),t),digest:t=>e.digest(t),save:()=>e.save(),load:A=>(e.load(A),t),blockSize:4,digestSize:4};return t}))},Object.defineProperty(e,"__esModule",{value:!0})}));
