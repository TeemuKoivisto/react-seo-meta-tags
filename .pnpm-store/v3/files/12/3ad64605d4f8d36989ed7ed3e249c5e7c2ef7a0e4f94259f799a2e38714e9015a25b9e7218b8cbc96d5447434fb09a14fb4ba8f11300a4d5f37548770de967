{"version":3,"file":"query-result-store.js","names":["process","env","NODE_ENV","Error","getPathFromProps","props","pageResources","page","normalizePagePath","path","undefined","PageQueryStore","React","Component","constructor","state","pageData","handleMittEvent","setState","loader","loadPageSync","componentDidMount","socketRegisterPath","___emitter","on","window","_gatsbyEvents","push","action","payload","getServerDataError","componentDidUpdate","componentWillUnmount","socketUnregisterPath","off","getDerivedStateFromProps","newPath","shouldComponentUpdate","nextProps","nextState","location","render","json","StaticQueryStore","staticQueryData","getStaticQueryResults","children","SliceDataStore","slicesData","Map","getSliceResults"],"sources":["../query-result-store.js"],"sourcesContent":["import React from \"react\"\nimport { StaticQueryContext } from \"gatsby\"\nimport {\n  registerPath as socketRegisterPath,\n  unregisterPath as socketUnregisterPath,\n} from \"./socketIo\"\nimport PageRenderer from \"./page-renderer\"\nimport normalizePagePath from \"./normalize-page-path\"\nimport loader, { getStaticQueryResults, getSliceResults } from \"./loader\"\nimport { SlicesResultsContext } from \"./slice/context\"\n\nif (process.env.NODE_ENV === `production`) {\n  throw new Error(\n    `It appears like Gatsby is misconfigured. JSONStore is Gatsby internal ` +\n      `development-only component and should never be used in production.\\n\\n` +\n      `Unless your site has a complex or custom webpack/Gatsby ` +\n      `configuration this is likely a bug in Gatsby. ` +\n      `Please report this at https://github.com/gatsbyjs/gatsby/issues ` +\n      `with steps to reproduce this error.`\n  )\n}\n\nconst getPathFromProps = props =>\n  props.pageResources && props.pageResources.page\n    ? normalizePagePath(props.pageResources.page.path)\n    : undefined\n\nexport class PageQueryStore extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      pageData: null,\n      path: null,\n    }\n  }\n\n  handleMittEvent = () => {\n    this.setState(state => {\n      return {\n        page: state.path\n          ? loader.loadPageSync(normalizePagePath(state.path))\n          : null,\n      }\n    })\n  }\n\n  componentDidMount() {\n    socketRegisterPath(getPathFromProps(this.props))\n    ___emitter.on(`pageQueryResult`, this.handleMittEvent)\n    ___emitter.on(`serverDataResult`, this.handleMittEvent)\n    ___emitter.on(`onPostLoadPageResources`, this.handleMittEvent)\n\n    window._gatsbyEvents.push([\n      `FAST_REFRESH`,\n      {\n        action: `SHOW_GETSERVERDATA_ERROR`,\n        payload: this.state?.page?.page?.getServerDataError,\n      },\n    ])\n  }\n\n  componentDidUpdate() {\n    window._gatsbyEvents.push([\n      `FAST_REFRESH`,\n      {\n        action: `SHOW_GETSERVERDATA_ERROR`,\n        payload: this.state?.page?.page?.getServerDataError,\n      },\n    ])\n  }\n\n  componentWillUnmount() {\n    socketUnregisterPath(this.state.path)\n    ___emitter.off(`pageQueryResult`, this.handleMittEvent)\n    ___emitter.off(`serverDataResult`, this.handleMittEvent)\n    ___emitter.off(`onPostLoadPageResources`, this.handleMittEvent)\n  }\n\n  static getDerivedStateFromProps(props, state) {\n    const newPath = getPathFromProps(props)\n    if (newPath !== state.path) {\n      socketUnregisterPath(state.path)\n      socketRegisterPath(newPath)\n      return {\n        path: newPath,\n        page: newPath ? loader.loadPageSync(normalizePagePath(newPath)) : null,\n      }\n    }\n\n    return null\n  }\n\n  shouldComponentUpdate(nextProps, nextState) {\n    // We want to update this component when:\n    // - location changed\n    // - page data for path changed\n\n    return (\n      this.props.location !== nextProps.location ||\n      this.state.path !== nextState.path ||\n      this.state.page !== nextState.page\n    )\n  }\n\n  render() {\n    // eslint-disable-next-line\n    if (!this.state.page) {\n      return <div />\n    }\n\n    if (this.state.page.page.getServerDataError) {\n      return <div />\n    }\n\n    return <PageRenderer {...this.props} {...this.state.page.json} />\n  }\n}\n\nexport class StaticQueryStore extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      staticQueryData: { ...getStaticQueryResults() },\n    }\n  }\n\n  handleMittEvent = () => {\n    this.setState({\n      staticQueryData: { ...getStaticQueryResults() },\n    })\n  }\n\n  componentDidMount() {\n    ___emitter.on(`staticQueryResult`, this.handleMittEvent)\n    ___emitter.on(`onPostLoadPageResources`, this.handleMittEvent)\n  }\n\n  componentWillUnmount() {\n    ___emitter.off(`staticQueryResult`, this.handleMittEvent)\n    ___emitter.off(`onPostLoadPageResources`, this.handleMittEvent)\n  }\n\n  shouldComponentUpdate(nextProps, nextState) {\n    // We want to update this component when:\n    // - static query results changed\n\n    return this.state.staticQueryData !== nextState.staticQueryData\n  }\n\n  render() {\n    return (\n      <StaticQueryContext.Provider value={this.state.staticQueryData}>\n        {this.props.children}\n      </StaticQueryContext.Provider>\n    )\n  }\n}\n\nexport class SliceDataStore extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      slicesData: new Map(getSliceResults()),\n    }\n  }\n\n  handleMittEvent = () => {\n    this.setState({\n      slicesData: new Map(getSliceResults()),\n    })\n  }\n\n  componentDidMount() {\n    ___emitter.on(`sliceQueryResult`, this.handleMittEvent)\n    ___emitter.on(`onPostLoadPageResources`, this.handleMittEvent)\n  }\n\n  componentWillUnmount() {\n    ___emitter.off(`sliceQueryResult`, this.handleMittEvent)\n    ___emitter.off(`onPostLoadPageResources`, this.handleMittEvent)\n  }\n\n  shouldComponentUpdate(nextProps, nextState) {\n    // We want to update this component when:\n    // - slice results changed\n\n    return this.state.slicesData !== nextState.slicesData\n  }\n\n  render() {\n    return (\n      <SlicesResultsContext.Provider value={this.state.slicesData}>\n        {this.props.children}\n      </SlicesResultsContext.Provider>\n    )\n  }\n}\n"],"mappings":"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"}