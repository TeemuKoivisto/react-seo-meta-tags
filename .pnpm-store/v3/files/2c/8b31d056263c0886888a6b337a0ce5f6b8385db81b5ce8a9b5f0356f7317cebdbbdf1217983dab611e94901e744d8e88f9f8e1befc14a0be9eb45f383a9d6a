{"version":3,"file":"engine-context.js","names":["asyncLocalStorage","getAsyncLocalStorage","AsyncLocalStorage","getEngineContext","getStore","runWithEngineContext","context","fn","run"],"sources":["../../src/utils/engine-context.ts"],"sourcesContent":["import { AsyncLocalStorage } from \"async_hooks\"\n\nexport interface IEngineContext {\n  requestId: string\n}\n\nlet asyncLocalStorage\nfunction getAsyncLocalStorage(): AsyncLocalStorage<IEngineContext> {\n  return asyncLocalStorage ?? (asyncLocalStorage = new AsyncLocalStorage())\n}\n\nexport function getEngineContext(): IEngineContext | undefined {\n  return getAsyncLocalStorage().getStore()\n}\n\nexport function runWithEngineContext<T>(\n  context: IEngineContext,\n  fn: (...args: Array<any>) => T\n): T {\n  // @ts-ignore typings are incorrect, run() returns the result of fn()\n  return getAsyncLocalStorage().run(context, fn)\n}\n"],"mappings":";;;;;AAAA;AAMA,IAAIA,iBAAiB;AACrB,SAASC,oBAAoB,GAAsC;EAAA;EACjE,6BAAOD,iBAAiB,mEAAKA,iBAAiB,GAAG,IAAIE,8BAAiB,EAAE;AAC1E;AAEO,SAASC,gBAAgB,GAA+B;EAC7D,OAAOF,oBAAoB,EAAE,CAACG,QAAQ,EAAE;AAC1C;AAEO,SAASC,oBAAoB,CAClCC,OAAuB,EACvBC,EAA8B,EAC3B;EACH;EACA,OAAON,oBAAoB,EAAE,CAACO,GAAG,CAACF,OAAO,EAAEC,EAAE,CAAC;AAChD"}