{"version":3,"file":"add-page-dependency.js","names":["createPageDependencyBatcher","Batcher","bulkCall","createCalls","dependencyPayloads","map","call","store","dispatch","internalCreatePageDependencies","createPageDependency","path","nodeId","connection","queries","getState","nodeDependencyExists","connectionDependencyExists","byNode","has","get","byConnection","add"],"sources":["../../../src/redux/actions/add-page-dependency.ts"],"sourcesContent":["import { store } from \"../\"\nimport Batcher from \"../../utils/batcher\"\nimport {\n  createPageDependency as internalCreatePageDependency,\n  createPageDependencies as internalCreatePageDependencies,\n} from \"./internal\"\n\nexport const createPageDependencyBatcher = new Batcher<\n  typeof internalCreatePageDependency\n>(1000)\n\ncreatePageDependencyBatcher.bulkCall(createCalls => {\n  const dependencyPayloads = createCalls.map(call => call[0])\n  store.dispatch(internalCreatePageDependencies(dependencyPayloads))\n})\n\nexport const createPageDependency = ({\n  path,\n  nodeId,\n  connection,\n}: {\n  path: string\n  nodeId: string\n  connection?: string\n}): void => {\n  const { queries } = store.getState()\n\n  // Check that the dependencies aren't already recorded so we\n  // can avoid creating lots of very noisy actions.\n  let nodeDependencyExists = false\n  let connectionDependencyExists = false\n  if (!nodeId) {\n    nodeDependencyExists = true\n  }\n  if (\n    nodeId &&\n    queries.byNode.has(nodeId) &&\n    queries.byNode.get(nodeId)!.has(path)\n  ) {\n    nodeDependencyExists = true\n  }\n  if (!connection) {\n    connectionDependencyExists = true\n  }\n  if (\n    connection &&\n    queries.byConnection.has(connection) &&\n    queries.byConnection.get(connection)!.has(path)\n  ) {\n    connectionDependencyExists = true\n  }\n  if (nodeDependencyExists && connectionDependencyExists) {\n    return\n  }\n\n  // It's new, let's dispatch it\n  createPageDependencyBatcher.add({ path, nodeId, connection })\n}\n"],"mappings":";;;;;AAAA;AACA;AACA;AAKO,MAAMA,2BAA2B,GAAG,IAAIC,gBAAO,CAEpD,IAAI,CAAC;AAAA;AAEPD,2BAA2B,CAACE,QAAQ,CAACC,WAAW,IAAI;EAClD,MAAMC,kBAAkB,GAAGD,WAAW,CAACE,GAAG,CAACC,IAAI,IAAIA,IAAI,CAAC,CAAC,CAAC,CAAC;EAC3DC,OAAK,CAACC,QAAQ,CAAC,IAAAC,gCAA8B,EAACL,kBAAkB,CAAC,CAAC;AACpE,CAAC,CAAC;AAEK,MAAMM,oBAAoB,GAAG,CAAC;EACnCC,IAAI;EACJC,MAAM;EACNC;AAKF,CAAC,KAAW;EACV,MAAM;IAAEC;EAAQ,CAAC,GAAGP,OAAK,CAACQ,QAAQ,EAAE;;EAEpC;EACA;EACA,IAAIC,oBAAoB,GAAG,KAAK;EAChC,IAAIC,0BAA0B,GAAG,KAAK;EACtC,IAAI,CAACL,MAAM,EAAE;IACXI,oBAAoB,GAAG,IAAI;EAC7B;EACA,IACEJ,MAAM,IACNE,OAAO,CAACI,MAAM,CAACC,GAAG,CAACP,MAAM,CAAC,IAC1BE,OAAO,CAACI,MAAM,CAACE,GAAG,CAACR,MAAM,CAAC,CAAEO,GAAG,CAACR,IAAI,CAAC,EACrC;IACAK,oBAAoB,GAAG,IAAI;EAC7B;EACA,IAAI,CAACH,UAAU,EAAE;IACfI,0BAA0B,GAAG,IAAI;EACnC;EACA,IACEJ,UAAU,IACVC,OAAO,CAACO,YAAY,CAACF,GAAG,CAACN,UAAU,CAAC,IACpCC,OAAO,CAACO,YAAY,CAACD,GAAG,CAACP,UAAU,CAAC,CAAEM,GAAG,CAACR,IAAI,CAAC,EAC/C;IACAM,0BAA0B,GAAG,IAAI;EACnC;EACA,IAAID,oBAAoB,IAAIC,0BAA0B,EAAE;IACtD;EACF;;EAEA;EACAjB,2BAA2B,CAACsB,GAAG,CAAC;IAAEX,IAAI;IAAEC,MAAM;IAAEC;EAAW,CAAC,CAAC;AAC/D,CAAC;AAAA"}