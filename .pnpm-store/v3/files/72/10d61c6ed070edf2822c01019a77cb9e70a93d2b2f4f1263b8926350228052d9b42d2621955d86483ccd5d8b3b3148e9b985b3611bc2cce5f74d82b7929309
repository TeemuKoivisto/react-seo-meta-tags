{"version":3,"file":"api-runner-ssr.js","names":["apis","require","augmentErrorWithPlugin","plugin","err","name","message","apiRunner","api","args","defaultReturn","argTransform","console","log","results","plugins","forEach","apiFn","result","options","push","e","length","apiRunnerAsync"],"sources":["../api-runner-ssr.js"],"sourcesContent":["/* global plugins */\n// During bootstrap, we write requires at top of this file which looks like:\n// var plugins = [\n//   {\n//     plugin: require(\"/path/to/plugin1/gatsby-ssr.js\"),\n//     options: { ... },\n//   },\n//   {\n//     plugin: require(\"/path/to/plugin2/gatsby-ssr.js\"),\n//     options: { ... },\n//   },\n// ]\n\nconst apis = require(`./api-ssr-docs`)\n\nfunction augmentErrorWithPlugin(plugin, err) {\n  if (plugin.name !== `default-site-plugin`) {\n    // default-site-plugin is user code and will print proper stack trace,\n    // so no point in annotating error message pointing out which plugin is root of the problem\n    err.message += ` (from plugin: ${plugin.name})`\n  }\n\n  throw err\n}\n\nexport function apiRunner(api, args, defaultReturn, argTransform) {\n  if (!apis[api]) {\n    console.log(`This API doesn't exist`, api)\n  }\n\n  const results = []\n  plugins.forEach(plugin => {\n    const apiFn = plugin.plugin[api]\n    if (!apiFn) {\n      return\n    }\n\n    try {\n      const result = apiFn(args, plugin.options)\n\n      if (result && argTransform) {\n        args = argTransform({ args, result })\n      }\n\n      // This if case keeps behaviour as before, we should allow undefined here as the api is defined\n      // TODO V4\n      if (typeof result !== `undefined`) {\n        results.push(result)\n      }\n    } catch (e) {\n      augmentErrorWithPlugin(plugin, e)\n    }\n  })\n\n  return results.length ? results : [defaultReturn]\n}\n\nexport async function apiRunnerAsync(api, args, defaultReturn, argTransform) {\n  if (!apis[api]) {\n    console.log(`This API doesn't exist`, api)\n  }\n\n  const results = []\n  for (const plugin of plugins) {\n    const apiFn = plugin.plugin[api]\n    if (!apiFn) {\n      continue\n    }\n\n    try {\n      const result = await apiFn(args, plugin.options)\n\n      if (result && argTransform) {\n        args = argTransform({ args, result })\n      }\n\n      // This if case keeps behaviour as before, we should allow undefined here as the api is defined\n      // TODO V4\n      if (typeof result !== `undefined`) {\n        results.push(result)\n      }\n    } catch (e) {\n      augmentErrorWithPlugin(plugin, e)\n    }\n  }\n\n  return results.length ? results : [defaultReturn]\n}\n"],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,MAAMA,IAAI,GAAGC,OAAO,CAAE,gBAAe,CAAC;AAEtC,SAASC,sBAAsB,CAACC,MAAM,EAAEC,GAAG,EAAE;EAC3C,IAAID,MAAM,CAACE,IAAI,KAAM,qBAAoB,EAAE;IACzC;IACA;IACAD,GAAG,CAACE,OAAO,IAAK,kBAAiBH,MAAM,CAACE,IAAK,GAAE;EACjD;EAEA,MAAMD,GAAG;AACX;AAEO,SAASG,SAAS,CAACC,GAAG,EAAEC,IAAI,EAAEC,aAAa,EAAEC,YAAY,EAAE;EAChE,IAAI,CAACX,IAAI,CAACQ,GAAG,CAAC,EAAE;IACdI,OAAO,CAACC,GAAG,CAAE,wBAAuB,EAAEL,GAAG,CAAC;EAC5C;EAEA,MAAMM,OAAO,GAAG,EAAE;EAClBC,OAAO,CAACC,OAAO,CAACb,MAAM,IAAI;IACxB,MAAMc,KAAK,GAAGd,MAAM,CAACA,MAAM,CAACK,GAAG,CAAC;IAChC,IAAI,CAACS,KAAK,EAAE;MACV;IACF;IAEA,IAAI;MACF,MAAMC,MAAM,GAAGD,KAAK,CAACR,IAAI,EAAEN,MAAM,CAACgB,OAAO,CAAC;MAE1C,IAAID,MAAM,IAAIP,YAAY,EAAE;QAC1BF,IAAI,GAAGE,YAAY,CAAC;UAAEF,IAAI;UAAES;QAAO,CAAC,CAAC;MACvC;;MAEA;MACA;MACA,IAAI,OAAOA,MAAM,KAAM,WAAU,EAAE;QACjCJ,OAAO,CAACM,IAAI,CAACF,MAAM,CAAC;MACtB;IACF,CAAC,CAAC,OAAOG,CAAC,EAAE;MACVnB,sBAAsB,CAACC,MAAM,EAAEkB,CAAC,CAAC;IACnC;EACF,CAAC,CAAC;EAEF,OAAOP,OAAO,CAACQ,MAAM,GAAGR,OAAO,GAAG,CAACJ,aAAa,CAAC;AACnD;AAEO,eAAea,cAAc,CAACf,GAAG,EAAEC,IAAI,EAAEC,aAAa,EAAEC,YAAY,EAAE;EAC3E,IAAI,CAACX,IAAI,CAACQ,GAAG,CAAC,EAAE;IACdI,OAAO,CAACC,GAAG,CAAE,wBAAuB,EAAEL,GAAG,CAAC;EAC5C;EAEA,MAAMM,OAAO,GAAG,EAAE;EAClB,KAAK,MAAMX,MAAM,IAAIY,OAAO,EAAE;IAC5B,MAAME,KAAK,GAAGd,MAAM,CAACA,MAAM,CAACK,GAAG,CAAC;IAChC,IAAI,CAACS,KAAK,EAAE;MACV;IACF;IAEA,IAAI;MACF,MAAMC,MAAM,GAAG,MAAMD,KAAK,CAACR,IAAI,EAAEN,MAAM,CAACgB,OAAO,CAAC;MAEhD,IAAID,MAAM,IAAIP,YAAY,EAAE;QAC1BF,IAAI,GAAGE,YAAY,CAAC;UAAEF,IAAI;UAAES;QAAO,CAAC,CAAC;MACvC;;MAEA;MACA;MACA,IAAI,OAAOA,MAAM,KAAM,WAAU,EAAE;QACjCJ,OAAO,CAACM,IAAI,CAACF,MAAM,CAAC;MACtB;IACF,CAAC,CAAC,OAAOG,CAAC,EAAE;MACVnB,sBAAsB,CAACC,MAAM,EAAEkB,CAAC,CAAC;IACnC;EACF;EAEA,OAAOP,OAAO,CAACQ,MAAM,GAAGR,OAAO,GAAG,CAACJ,aAAa,CAAC;AACnD"}