{"version":3,"file":"index.js","names":["tracerProvider","initTracer","tracerFile","tracer","process","env","GATSBY_OPEN_TRACING_CONFIG_FILE","resolvedPath","slash","path","resolve","require","create","Tracer","initGlobalTracer","stopTracer","stop"],"sources":["../../../src/utils/tracer/index.ts"],"sourcesContent":["import { slash } from \"gatsby-core-utils\"\nimport path from \"path\"\nimport { Tracer, initGlobalTracer } from \"opentracing\"\n\ninterface ITracerProvider {\n  create(): Tracer\n  stop(): Promise<void>\n}\n\nlet tracerProvider: ITracerProvider | undefined\n\n/**\n * tracerFile should be a js file that exports two functions.\n *\n * `create` - Create and return an open-tracing compatible tracer. See\n * https://github.com/opentracing/opentracing-javascript/blob/master/src/tracer.ts\n *\n * `stop` - Run any tracer cleanup required before the node.js process\n * exits\n */\nexport const initTracer = async (tracerFile: string): Promise<Tracer> => {\n  let tracer: Tracer\n  if (tracerFile) {\n    process.env.GATSBY_OPEN_TRACING_CONFIG_FILE = tracerFile\n    const resolvedPath = slash(path.resolve(tracerFile))\n    tracerProvider = require(resolvedPath)\n    tracer = await tracerProvider!.create()\n  } else {\n    tracer = new Tracer() // Noop\n  }\n\n  initGlobalTracer(tracer)\n\n  return tracer\n}\n\nexport const stopTracer = async (): Promise<void> => {\n  if (tracerProvider?.stop) {\n    await tracerProvider.stop()\n  }\n}\n"],"mappings":";;;;;AAAA;AACA;AACA;AAOA,IAAIA,cAA2C;;AAE/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,MAAMC,UAAU,GAAG,MAAOC,UAAkB,IAAsB;EACvE,IAAIC,MAAc;EAClB,IAAID,UAAU,EAAE;IACdE,OAAO,CAACC,GAAG,CAACC,+BAA+B,GAAGJ,UAAU;IACxD,MAAMK,YAAY,GAAG,IAAAC,sBAAK,EAACC,aAAI,CAACC,OAAO,CAACR,UAAU,CAAC,CAAC;IACpDF,cAAc,GAAGW,OAAO,CAACJ,YAAY,CAAC;IACtCJ,MAAM,GAAG,MAAMH,cAAc,CAAEY,MAAM,EAAE;EACzC,CAAC,MAAM;IACLT,MAAM,GAAG,IAAIU,mBAAM,EAAE,EAAC;EACxB;;EAEA,IAAAC,6BAAgB,EAACX,MAAM,CAAC;EAExB,OAAOA,MAAM;AACf,CAAC;AAAA;AAEM,MAAMY,UAAU,GAAG,YAA2B;EAAA;EACnD,uBAAIf,cAAc,4CAAd,gBAAgBgB,IAAI,EAAE;IACxB,MAAMhB,cAAc,CAACgB,IAAI,EAAE;EAC7B;AACF,CAAC;AAAA"}