{"version":3,"file":"batcher.js","names":["Batcher","queue","callbacks","bulkCallbacks","constructor","threshold","add","args","push","length","flush","forEach","callback","call","bulkCall"],"sources":["../../src/utils/batcher.ts"],"sourcesContent":["export default class Batcher<Callback extends (...args: Array<any>) => any> {\n  private queue: Array<Parameters<Callback>> = []\n  private callbacks: Array<(...args: Parameters<Callback>) => void> = []\n  private bulkCallbacks: Array<(args: Array<Parameters<Callback>>) => void> = []\n\n  constructor(private threshold: number) {}\n\n  /** Add a call to the batcher */\n  add(...args: Parameters<Callback>): void {\n    this.queue.push(args)\n\n    if (this.queue.length >= this.threshold) {\n      this.flush()\n    }\n  }\n\n  /** Call all of our callbacks and clear out the queue */\n  flush(): void {\n    // call each callback for each item in the queue\n    this.queue.forEach(args =>\n      this.callbacks.forEach(callback => callback(...args))\n    )\n\n    // pass the entire queue to all bulk callbacks\n    this.bulkCallbacks.forEach(callback => {\n      callback(this.queue)\n    })\n\n    // clear out the queue\n    this.queue = []\n  }\n\n  /** Sets up a callback for each batcher item */\n  call(callback: (...args: Parameters<Callback>) => void): void {\n    this.callbacks.push(callback)\n  }\n\n  /** Sets up a bulk callback that takes the entire queue */\n  bulkCall(callback: (args: Array<Parameters<Callback>>) => void): void {\n    this.bulkCallbacks.push(callback)\n  }\n}\n"],"mappings":";;;;AAAe,MAAMA,OAAO,CAAgD;EAClEC,KAAK,GAAgC,EAAE;EACvCC,SAAS,GAAmD,EAAE;EAC9DC,aAAa,GAAuD,EAAE;EAE9EC,WAAW,CAASC,SAAiB,EAAE;IAAA,KAAnBA,SAAiB,GAAjBA,SAAiB;EAAG;;EAExC;EACAC,GAAG,CAAC,GAAGC,IAA0B,EAAQ;IACvC,IAAI,CAACN,KAAK,CAACO,IAAI,CAACD,IAAI,CAAC;IAErB,IAAI,IAAI,CAACN,KAAK,CAACQ,MAAM,IAAI,IAAI,CAACJ,SAAS,EAAE;MACvC,IAAI,CAACK,KAAK,EAAE;IACd;EACF;;EAEA;EACAA,KAAK,GAAS;IACZ;IACA,IAAI,CAACT,KAAK,CAACU,OAAO,CAACJ,IAAI,IACrB,IAAI,CAACL,SAAS,CAACS,OAAO,CAACC,QAAQ,IAAIA,QAAQ,CAAC,GAAGL,IAAI,CAAC,CAAC,CACtD;;IAED;IACA,IAAI,CAACJ,aAAa,CAACQ,OAAO,CAACC,QAAQ,IAAI;MACrCA,QAAQ,CAAC,IAAI,CAACX,KAAK,CAAC;IACtB,CAAC,CAAC;;IAEF;IACA,IAAI,CAACA,KAAK,GAAG,EAAE;EACjB;;EAEA;EACAY,IAAI,CAACD,QAAiD,EAAQ;IAC5D,IAAI,CAACV,SAAS,CAACM,IAAI,CAACI,QAAQ,CAAC;EAC/B;;EAEA;EACAE,QAAQ,CAACF,QAAqD,EAAQ;IACpE,IAAI,CAACT,aAAa,CAACK,IAAI,CAACI,QAAQ,CAAC;EACnC;AACF;AAAC"}